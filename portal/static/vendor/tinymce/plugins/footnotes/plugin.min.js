/*!
 * Tiny Footnotes plugin
 *
 * Copyright (c) 2022 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 1.0.0-23
 */

!function(){"use strict";const e=e=>parseInt(e,10),t=(e,t)=>{const o=e-t;return 0===o?0:o>0?1:-1},o=(e,t,o)=>({major:e,minor:t,patch:o}),n=t=>{const n=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t);return n?o(e(n[1]),e(n[2]),e(n[3])):o(0,0,0)},r=e=>t=>typeof t===e,s=e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(o=n=e,(r=String).prototype.isPrototypeOf(o)||(null===(s=n.constructor)||void 0===s?void 0:s.name)===r.name)?"string":t;var o,n,r,s})(e),i=r("boolean"),a=e=>!(e=>null==e)(e),d=r("function"),l=r("number"),c=()=>{},m=e=>()=>e,f=(e,t)=>e===t,u=m(!1);class h{constructor(e,t){this.tag=e,this.value=t}static some(e){return new h(!0,e)}static none(){return h.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?h.some(e(this.value)):h.none()}bind(e){return this.tag?e(this.value):h.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:h.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return a(e)?h.some(e):h.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}h.singletonNone=new h(!1);const g=Array.prototype.indexOf,p=(e,t)=>{return o=e,n=t,g.call(o,n)>-1;var o,n},y=(e,t)=>{for(let o=0,n=e.length;o<n;o++)if(t(e[o],o))return!0;return!1},v=(e,t)=>{const o=e.length,n=new Array(o);for(let r=0;r<o;r++){const o=e[r];n[r]=t(o,r)}return n},b=(e,t)=>{for(let o=0,n=e.length;o<n;o++)t(e[o],o)},x=(e,t)=>{const o=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t(r,n)&&o.push(r)}return o},w=(e,t,o)=>(b(e,((e,n)=>{o=t(o,e,n)})),o),T=e=>{const t=[],o=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(o);return t},k=(e,t)=>I(e,t)?((e,t)=>e.substring(t))(e,t.length):e,I=(e,t)=>((e,t,o)=>""===t||e.length>=t.length&&e.substr(0,0+t.length)===t)(e,t),P=(D=/^\s+|\s+$/g,e=>e.replace(D,""));var D;const S=Object.keys,C=Object.hasOwnProperty,N=(e,t)=>C.call(e,t);"undefined"!=typeof window?window:Function("return this;")();const W=e=>e.dom.nodeName.toLowerCase(),E=e=>e.dom.nodeType,_=e=>t=>E(t)===e,A=_(1),B=_(3),F=_(9),M=_(11),O=(e,t,o)=>{if(!(s(o)||i(o)||l(o)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",o,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,o+"")},U=(e,t,o)=>{O(e.dom,t,o)},$=(e,t)=>{const o=e.dom;((e,t)=>{const o=S(e);for(let n=0,r=o.length;n<r;n++){const r=o[n];t(e[r],r)}})(t,((e,t)=>{O(o,t,e)}))},j=(e,t)=>{const o=e.dom.getAttribute(t);return null===o?void 0:o},L=(e,t)=>h.from(j(e,t)),V=(e,t)=>{e.dom.removeAttribute(t)},R=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},q={fromHtml:(e,t)=>{const o=(t||document).createElement("div");if(o.innerHTML=e,!o.hasChildNodes()||o.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return R(o.childNodes[0])},fromTag:(e,t)=>{const o=(t||document).createElement(e);return R(o)},fromText:(e,t)=>{const o=(t||document).createTextNode(e);return R(o)},fromDom:R,fromPoint:(e,t,o)=>h.from(e.dom.elementFromPoint(t,o)).map(R)},H=(e,t)=>{const o=e.dom;if(1!==o.nodeType)return!1;{const e=o;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},z=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,K=(e,t)=>e.dom===t.dom,G=H,J=e=>void 0!==e.style&&d(e.style.getPropertyValue),Q=e=>q.fromDom(e.dom.ownerDocument),X=e=>F(e)?e:Q(e),Y=e=>h.from(e.dom.parentNode).map(q.fromDom),Z=e=>h.from(e.dom.nextSibling).map(q.fromDom),ee=e=>v(e.dom.childNodes,q.fromDom),te=d(Element.prototype.attachShadow)&&d(Node.prototype.getRootNode)?e=>q.fromDom(e.dom.getRootNode()):X,oe=e=>q.fromDom(e.dom.host),ne=e=>{const t=B(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const o=t.ownerDocument;return(e=>{const t=te(e);return M(o=t)&&a(o.dom.host)?h.some(t):h.none();var o})(q.fromDom(t)).fold((()=>o.body.contains(t)),(n=ne,r=oe,e=>n(r(e))));var n,r},re=(e,t)=>J(e)?e.style.getPropertyValue(t):"",se=(e,t)=>{Y(e).each((o=>{o.dom.insertBefore(t.dom,e.dom)}))},ie=(e,t)=>{Z(e).fold((()=>{Y(e).each((e=>{ae(e,t)}))}),(e=>{se(e,t)}))},ae=(e,t)=>{e.dom.appendChild(t.dom)},de=(e,t)=>{b(t,((o,n)=>{const r=0===n?e:t[n-1];ie(r,o)}))},le=(e,t)=>{b(t,(t=>{ae(e,t)}))},ce=(e,t)=>{let o=[];return b(ee(e),(e=>{t(e)&&(o=o.concat([e])),o=o.concat(ce(e,t))})),o},me=(e,t,o)=>{let n=e.dom;const r=d(o)?o:u;for(;n.parentNode;){n=n.parentNode;const e=q.fromDom(n);if(t(e))return h.some(e);if(r(e))break}return h.none()},fe=e=>{e.dom.textContent="",b(ee(e),(e=>{ue(e)}))},ue=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},he=(e,t)=>((e,o)=>x(ee(e),(e=>H(e,t))))(e),ge=(e,t)=>((e,t)=>{const o=void 0===t?document:t.dom;return z(o)?[]:v(o.querySelectorAll(e),q.fromDom)})(t,e),pe=(e,t,o)=>me(e,(e=>H(e,t)),o),ye=(e,t)=>((e,o)=>{return(n=e.dom.childNodes,r=e=>{return o=q.fromDom(e),H(o,t);var o},((e,t,o)=>{for(let n=0,r=e.length;n<r;n++){const r=e[n];if(t(r,n))return h.some(r);if(o(r,n))break}return h.none()})(n,r,u)).map(q.fromDom);var n,r})(e),ve=(e,t)=>((e,t)=>{const o=void 0===t?document:t.dom;return z(o)?h.none():h.from(o.querySelector(e)).map(q.fromDom)})(t,e),be=((e,t)=>{const o=t=>e(t)?h.from(t.dom.nodeValue):h.none();return{get:t=>{if(!e(t))throw new Error("Can only get text value of a text node");return o(t).getOr("")},getOption:o,set:(t,o)=>{if(!e(t))throw new Error("Can only set raw text value of a text node");t.dom.nodeValue=o}}})(B);var xe=["body","p","div","article","aside","figcaption","figure","footer","header","nav","section","ol","ul","li","table","thead","tbody","tfoot","caption","tr","td","th","h1","h2","h3","h4","h5","h6","blockquote","pre","address"];const we=(e,t)=>({element:e,offset:t}),Te=(e,t,o)=>e.property().isText(t)&&0===e.property().getText(t).trim().length||e.property().isComment(t)?o(t).bind((t=>Te(e,t,o).orThunk((()=>h.some(t))))):h.none(),ke=(e,t)=>e.property().isText(t)?e.property().getText(t).length:e.property().children(t).length,Ie=(e,t)=>{const o=Te(e,t,e.query().prevSibling).getOr(t);if(e.property().isText(o))return we(o,ke(e,o));const n=e.property().children(o);return n.length>0?Ie(e,n[n.length-1]):we(o,ke(e,o))},Pe=Ie,De={up:m({selector:pe,closest:(e,t,o)=>((e,t,o,n,r)=>((e,t)=>H(e,t))(o,n)?h.some(o):d(r)&&r(o)?h.none():t(o,n,r))(0,pe,e,t,o),predicate:me,all:(e,t)=>{const o=d(t)?t:u;let n=e.dom;const r=[];for(;null!==n.parentNode&&void 0!==n.parentNode;){const e=n.parentNode,t=q.fromDom(e);if(r.push(t),!0===o(t))break;n=e}return r}}),down:m({selector:ge,predicate:ce}),styles:m({get:(e,t)=>{const o=e.dom,n=window.getComputedStyle(o).getPropertyValue(t);return""!==n||ne(e)?n:re(o,t)},getRaw:(e,t)=>{const o=e.dom,n=re(o,t);return h.from(n).filter((e=>e.length>0))},set:(e,t,o)=>{((e,t,o)=>{if(!s(o))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",o,":: Element ",e),new Error("CSS value must be a string: "+o);J(e)&&e.style.setProperty(t,o)})(e.dom,t,o)},remove:(e,t)=>{((e,t)=>{J(e)&&e.style.removeProperty(t)})(e.dom,t),((e,t,o=f)=>e.exists((e=>o(e,t))))(L(e,"style").map(P),"")&&V(e,"style")}}),attrs:m({get:j,set:U,remove:V,copyTo:(e,t)=>{const o=w(e.dom.attributes,((e,t)=>(e[t.name]=t.value,e)),{});$(t,o)}}),insert:m({before:se,after:ie,afterAll:de,append:ae,appendAll:le,prepend:(e,t)=>{(e=>((e,t)=>{const o=e.dom.childNodes;return h.from(o[0]).map(q.fromDom)})(e))(e).fold((()=>{ae(e,t)}),(o=>{e.dom.insertBefore(t.dom,o.dom)}))},wrap:(e,t)=>{se(e,t),ae(t,e)}}),remove:m({unwrap:e=>{const t=ee(e);t.length>0&&de(e,t),ue(e)},remove:ue}),create:m({nu:q.fromTag,clone:e=>q.fromDom(e.dom.cloneNode(!1)),text:q.fromText}),query:m({comparePosition:(e,t)=>e.dom.compareDocumentPosition(t.dom),prevSibling:e=>h.from(e.dom.previousSibling).map(q.fromDom),nextSibling:Z}),property:m({children:ee,name:W,parent:Y,document:e=>X(e).dom,isText:B,isComment:e=>8===E(e)||"#comment"===W(e),isElement:A,isSpecial:e=>{const t=W(e);return p(["script","noscript","iframe","noframes","noembed","title","style","textarea","xmp"],t)},getLanguage:e=>A(e)?L(e,"lang"):h.none(),getText:e=>be.get(e),setText:(e,t)=>be.set(e,t),isBoundary:e=>!!A(e)&&("body"===W(e)||p(xe,W(e))),isEmptyTag:e=>!!A(e)&&p(["br","img","hr","input"],W(e)),isNonEditable:e=>A(e)&&"false"===j(e,"contenteditable")}),eq:K,is:G},Se=(e,t)=>{(e=>void 0!==e.dom.classList)(e)?e.dom.classList.add(t):((e,t)=>{((e,t,o)=>{const n=((e,t)=>{const o=j(e,t);return void 0===o||""===o?[]:o.split(" ")})(e,t),r=n.concat([o]);U(e,t,r.join(" "))})(e,"class",t)})(e,t)},Ce=e=>e.dom.innerHTML,Ne=(e,t,o)=>pe(e,t,o).isSome(),We=(e,t)=>{e.dom.textContent=t},Ee="footnote",_e="mce-footnotes",Ae="mce-footnotes-note",Be="li",Fe="span",Me=e=>`sup.mce-footnote${s(e)?`#${e}`:""}[contenteditable="false"]`,Oe='div.mce-footnotes[contenteditable="false"]',Ue=e=>`li#${e}`,$e='span.mce-footnotes-note[contenteditable="true"]',je=e=>`footnote_${e}`,Le=e=>`footnotes_entry_${e}`,Ve=e=>t=>k(t,e+"_"),Re=Ve(Ee),qe=Ve("footnotes_entry"),He=e=>e.startsWith("footnote_"),ze=e=>e.startsWith("footnotes_entry_"),Ke=e=>{const t=e.getBody(),o=e.selection.getStart(),n=`${Oe} li`;return h.from(e.dom.getParent(o,n,t)).bind((o=>h.from(e.dom.getParent(o,Oe,t)).map((e=>({section:q.fromDom(e),entry:q.fromDom(o)})))))},Ge=(Je=e=>a(e.dom.getParent(e.selection.getStart(),Oe,e.getBody())),e=>!Je(e));var Je;const Qe=e=>q.fromDom(e.getBody()),Xe=(Be,e=>A(e)&&"li"===W(e));const Ye=e=>ve(e,Oe),Ze=e=>ye(e,"ol"),et=e=>ye(e,$e),tt=e=>L(e,"id").filter(ze),ot=e=>Xe(e)&&tt(e).isSome()&&Ne(e,Oe),nt=(e,t)=>Ye(Qe(e)).bind(Ze).bind((e=>((e,t)=>ye(e,Ue(t)))(e,t))).bind(et).each((t=>{rt(e,t),e.selection.scrollIntoView(void 0,!0)})),rt=(e,t)=>{const o=e.dom.createRng(),n=Pe(De,t);o.setStart(n.element.dom,n.offset),o.setEnd(n.element.dom,n.offset),e.selection.setRng(o)},st=e=>tt(e).bind((t=>et(e).map(Ce).bind((o=>{return(n=e,ye(n,"a.mce-footnotes-backlink")).bind((e=>L(e,"href"))).map((e=>({entryIdWithPrefix:t,note:o,backlinkIdWithPrefix:e})));var n})))),it=e=>{const t=q.fromTag(Be),o=q.fromTag("a");Se(o,"mce-footnotes-backlink"),We(o,"^\xa0");const n=q.fromTag(Fe);Se(n,Ae),U(n,"contenteditable",!0);return((e,t)=>{const o=Q(e).dom,n=q.fromDom(o.createDocumentFragment()),r=((e,t)=>{const o=(t||document).createElement("div");return o.innerHTML=e,ee(q.fromDom(o))})(t,o);le(n,r),fe(e),ae(e,n)})(n,e.note.length>0?e.note:'<br data-mce-bogus="1">'),ae(t,o),ae(t,n),U(t,"id",e.entryIdWithPrefix),U(o,"href",e.backlinkIdWithPrefix),t};let at=0;const dt=e=>{const t=ge(e,Me());return x(t,(t=>{return n=e,!(((e,t)=>{const o=e.dom;return!(!o||!o.hasAttribute)&&o.hasAttribute("data-mce-bogus")})(o=t)||Ne(o,'[data-mce-bogus="all"]',(e=>t=>K(t,e))(n)));var o,n}))},lt=e=>ve(e,"a"),ct=()=>(e=>{const t=(new Date).getTime(),o=Math.floor(1e9*Math.random());return at++,"footnote_"+o+at+String(t)})(),mt=e=>{return(t=e,L(t,"id").filter(He)).bind((t=>lt(e).bind((e=>(e=>L(e,"data-mce-href").orThunk((()=>L(e,"href"))).bind((e=>{return t=e,I(e,"#")?h.some(t):h.none();var t})))(e).map((o=>{var n,r;return{footnoteIdWithPrefix:t,symbol:null!==(r=e,n=r.dom.textContent)&&void 0!==n?n:"",forwardlinkIdWithPrefix:o}}))))));var t},ft=(e,t,o)=>{U(e,"id",o.footnoteIdWithPrefix),We(t,o.symbol),U(t,"href",o.forwardlinkIdWithPrefix),U(t,"data-mce-href",o.forwardlinkIdWithPrefix)},ut=(e,t)=>{const o=dt(e),n=x(o,(e=>mt(e).isSome()));b(n,((e,o)=>{var n,r;n=e,r=t[o],lt(n).each((e=>{ft(n,e,r)}))}))},ht=(e,t,o)=>{const n=w(t,((e,t)=>({...e,[qe(t.entryIdWithPrefix)]:t})),{}),r=w(e,((e,t,r)=>{const s=Re(t.footnoteIdWithPrefix),i={newBaseId:N(e.existingIds,s)?Re(o(s)):s,note:(a=n,d=s,N(a,d)?h.from(a[d]):h.none()).map((e=>e.note)).getOr(""),symbol:String(r+1)};var a,d;return{intexts:e.intexts.concat([i]),existingIds:{...e.existingIds,[s]:!0}}}),{existingIds:{},intexts:[]}),s=v(r.intexts,(e=>({note:e.note,entryIdWithPrefix:Le(e.newBaseId),backlinkIdWithPrefix:`#${je(e.newBaseId)}`})));return{intext:v(r.intexts,(e=>({footnoteIdWithPrefix:je(e.newBaseId),forwardlinkIdWithPrefix:`#${Le(e.newBaseId)}`,symbol:e.symbol}))),entries:s}},gt=(e,t)=>{(e=>{b(dt(e),ue)})(t);const o=(e=>{const t=e.getBody();return Ye(q.fromDom(t)).bind((t=>{if("1"===j(t,"data-mce-selected")||((e,t)=>Ke(e).filter((({section:e})=>K(t,e))).isSome())(e,t)){const o=e.dom.createRng();return o.setStartBefore(t.dom),o.setEndBefore(t.dom),ue(t),h.some(o)}return ue(t),h.none()}))})(e);e.dom.isEmpty(e.getBody())?(e.setContent(""),e.selection.setCursorLocation()):o.each(e.selection.setRng)},pt=(e,t)=>{const o=Qe(e),{addUndo:n,isDeleteTrigger:r}=t,s=(e=>{const t=dt(e);return T(v(t,mt))})(o),i=(e=>{const t=Ye(e),o=(e=>Ye(e).bind(Ze).map((e=>he(e,Be))).getOr([]))(e);return t.map((e=>({entries:T(v(o,st))})))})(o),a=((e,t,o)=>e.section.fold((()=>e.intext.length>0?o?{kind:"remove-footnotes"}:((e,t)=>{const{intext:o,entries:n}=ht(e,[],t);return{kind:"insert-footnotes",newFootnotes:{intext:o,entries:n}}})(e.intext,t):{kind:"noop-footnotes"}),(o=>e.intext.length>0?((e,t,o)=>{const{intext:n,entries:r}=ht(e,t,o);return n.length!==e.length||y(n,((t,o)=>t.footnoteIdWithPrefix!==e[o].footnoteIdWithPrefix||t.symbol!==e[o].symbol||t.forwardlinkIdWithPrefix!==e[o].forwardlinkIdWithPrefix))||r.length!==t.length||y(r,((e,o)=>e.entryIdWithPrefix!==t[o].entryIdWithPrefix||e.backlinkIdWithPrefix!==t[o].backlinkIdWithPrefix||e.note!==t[o].note))?{kind:"update-footnotes",newFootnotes:{intext:n,entries:r}}:{kind:"noop-footnotes"}})(e.intext,o.entries,t):{kind:"remove-footnotes"})))({intext:s,section:i},ct,r),d=n?e.undoManager.transact:e.undoManager.ignore;switch(a.kind){case"noop-footnotes":return;case"remove-footnotes":return void d((()=>{gt(e,o)}));case"insert-footnotes":return void d((()=>{ut(o,a.newFootnotes.intext),((e,t)=>{const o=(e=>{const t=(()=>{const e=q.fromTag("div");return $(e,{contentEditable:!1}),Se(e,_e),e})(),o=q.fromTag("hr"),n=q.fromTag("ol");return le(n,e),ae(t,o),ae(t,n),t})(v(t,it));ae(e,o)})(o,a.newFootnotes.entries)}));case"update-footnotes":return void d((()=>{ut(o,a.newFootnotes.intext),((e,t)=>{Ke(e).bind((({entry:e,section:t})=>tt(e).map((e=>({entryId:e,section:t}))))).filter((({section:t})=>Ye(Qe(e)).exists((e=>K(e,t))))).fold((()=>t()),(o=>{const n=t(),r=`${Ue(o.entryId)} ${$e}`;return ve(o.section,r).orThunk((()=>{const e=`li ${$e}`;return ve(o.section,e)})).each((t=>rt(e,t))),n}))})(e,(()=>{((e,t)=>{const o=v(t,it);Ye(e).bind(Ze).each((e=>{fe(e),le(e,o)}))})(o,a.newFootnotes.entries)}))}))}},yt=e=>{e.addCommand("mceInsertFootnote",((t,o)=>{(e=>{Ge(e)&&e.undoManager.transact((()=>{const t=(e=>{const t=ct(),o=Re(t);return e.undoManager.ignore((()=>{const o=((e,t)=>{const o=q.fromTag("sup");U(o,"contenteditable","false"),Se(o,"mce-footnote");const n=q.fromTag("a");return ae(o,n),ft(o,n,{footnoteIdWithPrefix:e,symbol:"\xa0",forwardlinkIdWithPrefix:`#${Le(Re(e))}`}),o})(t),n=(e=>{const t=q.fromTag("div"),o=q.fromDom(e.dom.cloneNode(!0));return ae(t,o),Ce(t)})(o);e.selection.collapse(!1),e.insertContent(n,{no_events:!0})})),o})(e);pt(e,{addUndo:!1,isDeleteTrigger:!1}),nt(e,Le(t))}))})(e)})),e.addCommand("mceUpdateFootnotes",((t,o)=>{pt(e,{addUndo:!0,isDeleteTrigger:!1})}))},vt=tinymce.util.VK,bt=e=>l(null==e?void 0:e.nodeType),xt=e=>{e.on("init",(()=>{e.on("click",(t=>{h.from(t.target).filter(bt).bind((t=>((e,t)=>h.from(e.dom.getParent(t,"a[href]")).map(q.fromDom))(e,t))).each((o=>{const n=((e,t,o)=>L(t,"href").filter((e=>/^#/.test(e))).map((e=>k(e,"#"))).exists((t=>He(t)?(((e,t)=>{((e,t)=>ve(e,Me(t)))(Qe(e),t).each((t=>e.selection.scrollIntoView(t.dom,!0)))})(e,t),!0):!(!ze(t)||!o||(nt(e,t),0)))))(e,o,vt.metaKeyPressed(t));n&&t.preventDefault()}))}))}))},wt=tinymce.html.Node,Tt=e=>{var t,o;return null!==(o=null===(t=e.attr("class"))||void 0===t?void 0:t.split(" "))&&void 0!==o?o:[]},kt=(e,t)=>{const o=Tt(e).concat(t);e.attr("class",o.join(" "))},It=e=>{const t=new wt("br",1);t.attr("data-mce-bogus","1"),e.empty(),e.append(t)},Pt=e=>{const t=new wt("#text",3);t.value="\xa0",e.empty(),e.append(t)},Dt=e=>"div"===e.name&&p(Tt(e),_e),St=e=>{const t=e.attr("id");return e.name===Be&&a(t)&&ze(t)},Ct=e=>{const t=e.attr("id");return"sup"===e.name&&a(t)&&He(t)},Nt=e=>{let t=e.parent;for(;a(t);){if(Dt(t))return t;t=t.parent}},Wt=e=>{const t=e.children();for(let e=t.length-1;e>=0;e--){const n=t[e];if((o=n).name===Fe&&p(Tt(o),Ae))return n}var o},Et=e=>{const t=[],o=[];for(let n=0;n<e.length;n++){const r=e[n];if(St(r)){const e=Nt(r);if(a(e)){const t=o.find((t=>t.node===e));a(t)?t.entries.push(r):o.push({node:e,entries:[r]})}}else Ct(r)&&t.push(r)}return{intextFootnotes:t,footnotesSections:o}},_t=e=>l(null==e?void 0:e.nodeType);tinymce.PluginManager.requireLangPack("footnotes","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_BR,pt_PT,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("footnotes",(e=>{((e,o)=>!!e&&-1===((e,o)=>{const n=t(e.major,o.major);if(0!==n)return n;const r=t(e.minor,o.minor);if(0!==r)return r;const s=t(e.patch,o.patch);return 0!==s?s:0})((e=>n((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),n(o)))(tinymce,"6.2.0")?console.error("The footnotes plugin requires at least version 6.2.0 of TinyMCE."):(yt(e),(e=>{const t=()=>e.execCommand("mceInsertFootnote"),o=()=>e.execCommand("mceUpdateFootnotes"),n=t=>{const o=()=>t.setEnabled(Ge(e));return o(),e.on("NodeChange",o),()=>e.off("NodeChange",o)};e.ui.registry.addButton("footnotes",{icon:"footnote",tooltip:"Insert footnote",onAction:t,onSetup:n}),e.ui.registry.addMenuItem("footnotes",{icon:"footnote",text:"Insert footnote",onAction:t,onSetup:n}),e.ui.registry.addButton("footnotesupdate",{icon:"reload",tooltip:"Update footnotes",onAction:o}),e.ui.registry.addMenuItem("footnotesupdate",{icon:"reload",text:"Update footnotes",onAction:o})})(e),(e=>{e.on("PreInit",(()=>{e.serializer.addAttributeFilter("id",(e=>{const t=Et(e);for(const e of t.intextFootnotes)e.attr("contenteditable",null);for(const e of t.footnotesSections){const t=e.node,o=e.entries;t.attr("contenteditable",null);for(const e of o){const t=Wt(e);if(a(t))t.attr("contenteditable",null);else{const t=new wt(Fe,1);kt(t,[Ae]),Pt(t),e.append(t)}}}})),e.parser.addAttributeFilter("id",(e=>{var t;const o=Et(e);for(const e of o.intextFootnotes)e.attr("contenteditable","false");for(const e of o.footnotesSections){const o=e.node,n=e.entries;o.attr("contenteditable","false");for(const e of n){const o=Wt(e);a(o)&&(o.firstChild===o.lastChild&&"\xa0"===(null===(t=o.firstChild)||void 0===t?void 0:t.value)&&It(o),o.attr("contenteditable","true"))}}}))}))})(e),xt(e),(e=>{e.on("PreInit",(()=>{e.on("mousedown tap",(t=>{h.from(t.target).filter(_t).map(q.fromDom).filter(ot).filter((t=>et(t).exists((t=>e.dom.isEmpty(t.dom))))).bind(tt).each((o=>{t.preventDefault(),nt(e,o)}))}))}))})(e),(e=>{const t=(()=>{const e=(e=>{const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(h.none()),o=()=>t.get().each(e);return{clear:()=>{o(),t.set(h.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{o(),t.set(h.some(e))}}})(c);return{...e,on:t=>e.get().each(t)}})();e.on("ExecCommand",(t=>{const o=t.command.toLowerCase();"delete"!==o&&"forwarddelete"!==o||pt(e,{addUndo:!1,isDeleteTrigger:!0})}),!0),e.on("input",(o=>{var n;("insertParagraph"===(n=o.inputType)||"insertLineBreak"===n||"insertFromPaste"===n||"insertFromDrop"===n||"insertReplacementText"===n)&&(pt(e,{addUndo:!1,isDeleteTrigger:!0}),t.clear())})),e.on("keydown",(()=>{t.set(!e.selection.isCollapsed())}),!0),e.on("keyup",(o=>{const n=o.keyCode,r=8===n||46===n;(t.get().getOr(!1)||r)&&pt(e,{addUndo:!1,isDeleteTrigger:!0}),t.clear()})),e.on("dragend",(()=>{pt(e,{addUndo:!1,isDeleteTrigger:!1})})),e.on("SetContent",(t=>{"raw"!==t.format&&pt(e,{addUndo:!1,isDeleteTrigger:!t.set})}))})(e))}))}();