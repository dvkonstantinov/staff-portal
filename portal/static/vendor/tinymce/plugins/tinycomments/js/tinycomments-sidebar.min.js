/*!
 * Tiny Comments plugin
 *
 * Copyright (c) 2022 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 3.2.0-84
 */

!function(){"use strict";const e=Object.getPrototypeOf,t=(e,t,n)=>{var o;return!!n(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},n=e=>n=>(e=>{const n=typeof e;return null===e?"null":"object"===n&&Array.isArray(e)?"array":"object"===n&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":n})(n)===e,o=e=>t=>typeof t===e,r=n("string"),s=n("object"),a=n=>((n,o)=>s(n)&&t(n,o,((t,n)=>e(t)===n)))(n,Object),i=n("array"),c=o("boolean"),l=(void 0,e=>undefined===e);const u=e=>null==e,d=e=>!u(e),m=o("function"),g=o("number"),p=()=>{},h=(e,t)=>(...n)=>e(t.apply(null,n)),v=e=>()=>e,f=e=>e,b=(e,t)=>e===t;function y(e,...t){return(...n)=>{const o=t.concat(n);return e.apply(null,o)}}const _=e=>()=>{throw new Error(e)},x=e=>e(),w=v(!1),O=v(!0),S=v("dismiss.popups"),C=v("reposition.popups");class E{constructor(e,t){this.tag=e,this.value=t}static some(e){return new E(!0,e)}static none(){return E.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?E.some(e(this.value)):E.none()}bind(e){return this.tag?e(this.value):E.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:E.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return d(e)?E.some(e):E.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}E.singletonNone=new E(!1);const k=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},T=(e,t)=>{const n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return k(n.childNodes[0])},A=(e,t)=>{const n=(t||document).createElement(e);return k(n)},M=(e,t)=>{const n=(t||document).createTextNode(e);return k(n)},R=k;var N=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t},F=function(e){return{eq:e}},B=F((function(e,t){return e===t})),D=function(e){return F((function(t,n){if(t.length!==n.length)return!1;for(var o=t.length,r=0;r<o;r++)if(!e.eq(t[r],n[r]))return!1;return!0}))},H=F((function(e,t){if(e===t)return!0;var n,o=N(e);return o===N(t)&&(function(e){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(e)}(o)?e===t:"array"===o?D(H).eq(e,t):"object"===o&&(n=H,F((function(e,t){var o=Object.keys(e),r=Object.keys(t);if(!function(e,t){return function(e,t){return F((function(n,o){return e.eq(t(n),t(o))}))}(D(e),(function(e){return function(e,t){return Array.prototype.slice.call(e).sort(t)}(e,t)}))}(B).eq(o,r))return!1;for(var s=o.length,a=0;a<s;a++){var i=o[a];if(!n.eq(e[i],t[i]))return!1}return!0}))).eq(e,t))}));const P=Array.prototype.slice,I=Array.prototype.indexOf,V=Array.prototype.push,W=(e,t)=>((e,t)=>I.call(e,t))(e,t)>-1,L=(e,t)=>{for(let n=0,o=e.length;n<o;n++)if(t(e[n],n))return!0;return!1},U=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},j=(e,t)=>{for(let n=0,o=e.length;n<o;n++)t(e[n],n)},z=(e,t)=>{const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];t(r,o)&&n.push(r)}return n},$=(e,t,n)=>(((e,t)=>{for(let n=e.length-1;n>=0;n--)t(e[n],n)})(e,((e,o)=>{n=t(n,e,o)})),n),q=(e,t,n)=>(j(e,((e,o)=>{n=t(n,e,o)})),n),G=(e,t)=>((e,t,n)=>{for(let o=0,r=e.length;o<r;o++){const r=e[o];if(t(r,o))return E.some(r);if(n(r,o))break}return E.none()})(e,t,w),K=(e,t)=>{for(let n=0,o=e.length;n<o;n++)if(t(e[n],n))return E.some(n);return E.none()},Y=e=>{const t=[];for(let n=0,o=e.length;n<o;++n){if(!i(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);V.apply(t,e[n])}return t},Q=(e,t)=>Y(U(e,t)),J=(e,t)=>{for(let n=0,o=e.length;n<o;++n)if(!0!==t(e[n],n))return!1;return!0},X=e=>{const t=P.call(e,0);return t.reverse(),t},Z=(e,t)=>z(e,(e=>!W(t,e))),ee=(e,t)=>{const n={};for(let o=0,r=e.length;o<r;o++){const r=e[o];n[String(r)]=t(r,o)}return n},te=e=>[e],ne=(e,t)=>t>=0&&t<e.length?E.some(e[t]):E.none(),oe=e=>ne(e,0),re=(e,t)=>{for(let n=0;n<e.length;n++){const o=t(e[n],n);if(o.isSome())return o}return E.none()},se=(e,t)=>{const n=e.dom;if(1!==n.nodeType)return!1;{const e=n;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},ae=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,ie=(e,t)=>e.dom===t.dom;"undefined"!=typeof window?window:Function("return this;")();const ce=e=>e.dom.nodeName.toLowerCase(),le=e=>t=>(e=>e.dom.nodeType)(t)===e,ue=le(1),de=le(3),me=le(9),ge=le(11),pe=e=>t=>ue(t)&&ce(t)===e,he=e=>R(e.dom.ownerDocument),ve=e=>me(e)?e:he(e),fe=e=>R(ve(e).dom.defaultView),be=e=>E.from(e.dom.parentNode).map(R),ye=e=>U(e.dom.childNodes,R),_e=(e,t)=>{const n=e.dom.childNodes;return E.from(n[t]).map(R)},xe=e=>_e(e,0),we=e=>ge(e)&&d(e.dom.host),Oe=m(Element.prototype.attachShadow)&&m(Node.prototype.getRootNode),Se=v(Oe),Ce=Oe?e=>R(e.dom.getRootNode()):ve,Ee=e=>R(e.dom.host),ke=e=>{const t=R((e=>{if(Se()&&d(e.target)){const t=R(e.target);if(ue(t)&&(e=>d(e.dom.shadowRoot))(t)&&e.composed&&e.composedPath){const t=e.composedPath();if(t)return oe(t)}}return E.from(e.target)})(e).getOr(e.target)),n=()=>e.stopPropagation(),o=()=>e.preventDefault(),r=h(o,n);return((e,t,n,o,r,s,a)=>({target:e,x:t,y:n,stop:o,prevent:r,kill:s,raw:a}))(t,e.clientX,e.clientY,n,o,r,e)},Te=(e,t,n,o)=>{e.dom.removeEventListener(t,n,o)},Ae=O,Me=(e,t,n)=>((e,t,n,o)=>((e,t,n,o,r)=>{const s=((e,t)=>n=>{e(n)&&t(ke(n))})(n,o);return e.dom.addEventListener(t,s,r),{unbind:y(Te,e,t,s,r)}})(e,t,n,o,!1))(e,t,Ae,n),Re=(e,t)=>{be(e).each((n=>{n.dom.insertBefore(t.dom,e.dom)}))},Ne=(e,t)=>{xe(e).fold((()=>{Fe(e,t)}),(n=>{e.dom.insertBefore(t.dom,n.dom)}))},Fe=(e,t)=>{e.dom.appendChild(t.dom)},Be=Object.keys,De=Object.hasOwnProperty,He=(e,t)=>{const n=Be(e);for(let o=0,r=n.length;o<r;o++){const r=n[o];t(e[r],r)}},Pe=(e,t)=>Ie(e,((e,n)=>({k:n,v:t(e,n)}))),Ie=(e,t)=>{const n={};return He(e,((e,o)=>{const r=t(e,o);n[r.k]=r.v})),n},Ve=e=>(t,n)=>{e[n]=t},We=(e,t,n,o)=>{He(e,((e,r)=>{(t(e,r)?n:o)(e,r)}))},Le=(e,t)=>{const n={};return We(e,t,Ve(n),p),n},Ue=(e,t)=>{const n=[];return He(e,((e,o)=>{n.push(t(e,o))})),n},je=(e,t)=>{const n=Be(e);for(let o=0,r=n.length;o<r;o++){const r=n[o],s=e[r];if(t(s,r,e))return E.some(s)}return E.none()},ze=(e,t)=>$e(e,t)?E.from(e[t]):E.none(),$e=(e,t)=>De.call(e,t),qe=(e,t)=>$e(e,t)&&void 0!==e[t]&&null!==e[t],Ge=v("tinycomments"),Ke=v("data-mce-annotation"),Ye=e=>{let t=E.none(),n=[];const o=e=>{r()?s(e):n.push(e)},r=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{r()||(t=E.some(e),j(n,s),n=[])})),{get:o,map:e=>Ye((t=>{o((n=>{t(e(n))}))})),isReady:r}},Qe={nu:Ye,pure:e=>Ye((t=>{t(e)}))},Je=e=>{setTimeout((()=>{throw e}),0)},Xe=e=>{const t=t=>{e().then(t,Je)};return{map:t=>Xe((()=>e().then(t))),bind:t=>Xe((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>Xe((()=>e().then((()=>t.toPromise())))),toLazy:()=>Qe.nu(t),toCached:()=>{let t=null;return Xe((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},Ze=e=>Xe((()=>new Promise(e))),et=e=>Xe((()=>Promise.resolve(e))),tt=e=>{const t=t=>t(e),n=v(e),o=()=>r,r={tag:!0,inner:e,fold:(t,n)=>n(e),isValue:O,isError:w,map:t=>ot.value(t(e)),mapError:o,bind:t,exists:t,forall:t,getOr:n,or:o,getOrThunk:n,orThunk:o,getOrDie:n,each:t=>{t(e)},toOptional:()=>E.some(e)};return r},nt=e=>{const t=()=>n,n={tag:!1,inner:e,fold:(t,n)=>t(e),isValue:w,isError:O,map:t,mapError:t=>ot.error(t(e)),bind:t,exists:w,forall:O,getOr:f,or:f,getOrThunk:x,orThunk:x,getOrDie:_(String(e)),each:p,toOptional:E.none};return n},ot={value:tt,error:nt,fromOption:(e,t)=>e.fold((()=>nt(t)),tt)},rt=e=>({...e,toCached:()=>rt(e.toCached()),bindFuture:t=>rt(e.bind((e=>e.fold((e=>et(ot.error(e))),(e=>t(e)))))),bindResult:t=>rt(e.map((e=>e.bind(t)))),mapResult:t=>rt(e.map((e=>e.map(t)))),mapError:t=>rt(e.map((e=>e.mapError(t)))),foldResult:(t,n)=>e.map((e=>e.fold(t,n))),withTimeout:(t,n)=>rt(Ze((o=>{let r=!1;const s=setTimeout((()=>{r=!0,o(ot.error(n()))}),t);e.get((e=>{r||(clearTimeout(s),o(e))}))})))}),st=e=>rt(Ze(e)),at=e=>rt(et(ot.value(e))),it={nu:st,wrap:rt,pure:at,value:at,error:e=>rt(et(ot.error(e))),fromResult:e=>rt(et(e)),fromFuture:e=>rt(e.map(ot.value)),fromPromise:e=>st((t=>{e.then((e=>{t(ot.value(e))}),(e=>{t(ot.error(e))}))}))},ct=e=>{const t=de(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const n=t.ownerDocument;return(e=>{const t=Ce(e);return we(t)?E.some(t):E.none()})(R(t)).fold((()=>n.body.contains(t)),(o=ct,r=Ee,e=>o(r(e))));var o,r},lt=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return ae(n)?[]:U(n.querySelectorAll(e),R)})(t,e);var ut;!function(e){e[e.Error=0]="Error",e[e.Value=1]="Value"}(ut||(ut={}));const dt=(e,t,n)=>e.stype===ut.Error?t(e.serror):n(e.svalue),mt=e=>({stype:ut.Value,svalue:e}),gt=e=>({stype:ut.Error,serror:e}),pt=mt,ht=gt,vt=dt,ft=(e,t,n,o)=>({tag:"field",key:e,newKey:t,presence:n,prop:o}),bt=(e,t,n)=>{switch(e.tag){case"field":return t(e.key,e.newKey,e.presence,e.prop);case"custom":return n(e.newKey,e.instantiator)}},yt=e=>(...t)=>{if(0===t.length)throw new Error("Can't merge zero objects");const n={};for(let o=0;o<t.length;o++){const r=t[o];for(const t in r)$e(r,t)&&(n[t]=e(n[t],r[t]))}return n},_t=yt(((e,t)=>a(e)&&a(t)?_t(e,t):t)),xt=yt(((e,t)=>t)),wt=e=>{let t,n=!1;return(...o)=>(n||(n=!0,t=e.apply(null,o)),t)},Ot=e=>({tag:"defaultedThunk",process:e}),St=e=>Ot(v(e)),Ct=e=>({tag:"mergeWithThunk",process:e}),Et=e=>{const t=(e=>{const t=[],n=[];return j(e,(e=>{dt(e,(e=>n.push(e)),(e=>t.push(e)))})),{values:t,errors:n}})(e);return t.errors.length>0?(n=t.errors,h(ht,Y)(n)):pt(t.values);var n},kt=e=>s(e)&&Be(e).length>100?" removed due to size":JSON.stringify(e,null,2),Tt=(e,t)=>ht([{path:e,getErrorInfo:t}]),At=e=>({extract:(t,n)=>((e,t)=>e.stype===ut.Error?t(e.serror):e)(e(n),(e=>((e,t)=>Tt(e,v(t)))(t,e))),toString:v("val")}),Mt=At(pt),Rt=(e,t,n,o)=>o(ze(e,t).getOrThunk((()=>n(e)))),Nt=(e,t,n,o,r)=>{const s=e=>r.extract(t.concat([o]),e),a=e=>e.fold((()=>pt(E.none())),(e=>((e,t)=>e.stype===ut.Value?{stype:ut.Value,svalue:t(e.svalue)}:e)(r.extract(t.concat([o]),e),E.some)));switch(e.tag){case"required":return((e,t,n,o)=>ze(t,n).fold((()=>((e,t,n)=>Tt(e,(()=>'Could not find valid *required* value for "'+t+'" in '+kt(n))))(e,n,t)),o))(t,n,o,s);case"defaultedThunk":return Rt(n,o,e.process,s);case"option":return((e,t,n)=>n(ze(e,t)))(n,o,a);case"defaultedOptionThunk":return((e,t,n,o)=>o(ze(e,t).map((t=>!0===t?n(e):t))))(n,o,e.process,a);case"mergeWithThunk":return Rt(n,o,v({}),(t=>{const o=_t(e.process(n),t);return s(o)}))}},Ft=e=>Be(Le(e,d)),Bt=e=>{const t=Dt(e),n=$(e,((e,t)=>bt(t,(t=>_t(e,{[t]:!0})),v(e))),{});return{extract:(e,o)=>{const r=c(o)?[]:Ft(o),s=z(r,(e=>!qe(n,e)));return 0===s.length?t.extract(e,o):((e,t)=>Tt(e,(()=>"There are unsupported fields: ["+t.join(", ")+"] specified")))(e,s)},toString:t.toString}},Dt=e=>({extract:(t,n)=>((e,t,n)=>{const o={},r=[];for(const s of n)bt(s,((n,s,a,i)=>{const c=Nt(a,e,t,n,i);vt(c,(e=>{r.push(...e)}),(e=>{o[s]=e}))}),((e,n)=>{o[e]=n(t)}));return r.length>0?ht(r):pt(o)})(t,n,e),toString:()=>{const t=U(e,(e=>bt(e,((e,t,n,o)=>e+" -> "+o.toString()),((e,t)=>"state("+e+")"))));return"obj{\n"+t.join("\n")+"}"}}),Ht=e=>({extract:(t,n)=>{const o=U(n,((n,o)=>e.extract(t.concat(["["+o+"]"]),n)));return Et(o)},toString:()=>"array("+e.toString()+")"}),Pt=(e,t)=>({extract:(n,o)=>{const r=Be(o),s=((t,n)=>Ht(At(e)).extract(t,n))(n,r);return((e,t)=>e.stype===ut.Value?t(e.svalue):e)(s,(e=>{const r=U(e,(e=>ft(e,e,{tag:"required",process:{}},t)));return Dt(r).extract(n,o)}))},toString:()=>"setOf("+t.toString()+")"}),It=v(Mt),Vt=(e,t)=>At((n=>{const o=typeof n;return e(n)?pt(n):ht(`Expected type: ${t} but got: ${o}`)})),Wt=Vt(r,"string"),Lt=Vt(c,"boolean"),Ut=Vt(m,"function"),jt=(e,t)=>({extract:(n,o)=>ze(o,e).fold((()=>((e,t)=>Tt(e,(()=>'Choice schema did not contain choice key: "'+t+'"')))(n,e)),(e=>((e,t,n,o)=>ze(n,o).fold((()=>((e,t,n)=>Tt(e,(()=>'The chosen schema: "'+n+'" did not exist in branches: '+kt(t))))(e,n,o)),(n=>n.extract(e.concat(["branch: "+o]),t))))(n,o,t,e))),toString:()=>"chooseOn("+e+"). Possible values: "+Be(t)}),zt=e=>At((t=>e(t).fold(ht,pt))),$t=(e,t)=>Pt((t=>e(t).fold(gt,mt)),t),qt=(e,t,n)=>{return o=((e,t,n)=>((e,t)=>e.stype===ut.Error?{stype:ut.Error,serror:t(e.serror)}:e)(t.extract([e],n),(e=>({input:n,errors:e}))))(e,t,n),dt(o,ot.error,ot.value);var o},Gt=e=>e.fold((e=>{throw new Error(Yt(e))}),f),Kt=(e,t,n)=>Gt(qt(e,t,n)),Yt=e=>"Errors: \n"+(e=>{const t=e.length>10?e.slice(0,10).concat([{path:[],getErrorInfo:v("... (only showing first ten failures)")}]):e;return U(t,(e=>"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()))})(e.errors).join("\n")+"\n\nInput object: "+kt(e.input),Qt=(e,t)=>jt(e,Pe(t,Dt)),Jt=ft,Xt=(e,t)=>({tag:"custom",newKey:e,instantiator:t}),Zt=e=>Jt(e,e,{tag:"required",process:{}},It()),en=(e,t)=>Jt(e,e,{tag:"required",process:{}},t),tn=e=>en(e,Lt),nn=(e,t)=>Jt(e,e,{tag:"required",process:{}},Dt(t)),on=e=>Jt(e,e,{tag:"option",process:{}},It()),rn=(e,t)=>Jt(e,e,{tag:"option",process:{}},t),sn=(e,t)=>rn(e,Dt(t)),an=(e,t)=>rn(e,Bt(t)),cn=(e,t)=>Jt(e,e,St(t),It()),ln=(e,t,n)=>Jt(e,e,St(t),n),un=Bt([tn("readonly"),tn("invalidSelection"),tn("saving")]),dn=e=>e.readonly||e.invalidSelection,mn=e=>dn(e)||e.saving,gn=pe("hr");var pn;!function(e){e[e.Change=0]="Change",e[e.NoChange=1]="NoChange"}(pn||(pn={}));const hn=(e,t,n,o)=>{let r={readonly:!1,saving:!1,invalidSelection:!1};const s=(e,t)=>{n.notificationManager.open({text:e,type:"error"}),t&&console.error(e,t)},a=(e,t)=>({view:{type:"splash"},grabFocus:()=>1===e||t}),i=(e,t,n)=>({view:{type:"comments",conversation:n},grabFocus:()=>t||W([1,3,4],e)}),c=(n,r)=>{t.set(n),t.get().fold((()=>it.pure({response:pn.Change,update:a(r,o.hasFocus())})),(n=>e.lookup({conversationUid:n}).foldResult((()=>ot.value({response:pn.Change,update:a(r,o.hasFocus())})),(e=>{const n=t.get().forall((t=>t!==e.conversation.uid));return ot.value(n?{response:pn.NoChange}:{response:pn.Change,update:i(r,o.hasFocus(),e.conversation)})})))).get((e=>e.fold((e=>{s("An error occurred reading the conversation. See the Console for details.",e)}),(e=>{e.response===pn.Change&&(o.update(e.update),g())}))))},l=e=>{r={...r,readonly:e},m()},m=()=>{o.sendGlobalUiState(r),(e=>{e.dispatch("mce-tinycomments-uistate-updated")})(n)},g=()=>{var e;return t.get().isSome()||u(n.selection)?l(!1):(e=(e=>{const t=R(e.selection.getNode()),n=R(e.selection.getStart());return(e=>{let t=e.selection.getRng().commonAncestorContainer;return 3===t.nodeType&&(t=t.parentNode),!!d(t)&&e.dom.isEmpty(t)})(e)||gn(t)||gn(n)})(n)||(()=>{const e=(e,t,n)=>{const o=t.createRange();return o.selectNode(n.dom),o.compareBoundaryPoints(window.Range.END_TO_START,e)<0&&o.compareBoundaryPoints(window.Range.START_TO_END,e)>0};if(n.selection){const t=n.selection.getRng(),o=lt(R(t.commonAncestorContainer),`[${Ke()}="${Ge()}"]`);return L(o,y(e,t,n.getDoc()))}return!1})(),r={...r,invalidSelection:e},m()),dn(r)};return{refreshSidebar:c,refreshView:e=>{e.fold((()=>{c(E.none(),0)}),(({uid:e})=>{c(E.some(e),0)}))},setReadonly:l,isReadonly:()=>dn(r),setSaving:e=>{r={...r,saving:e},m()},showError:s,refreshReadonly:g}},vn=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},fn=()=>(new Date).toISOString(),bn=36e5,yn=864e5,_n=6048e5,xn=24192e5,wn=290304e5;var On;!function(e){e[e.LessThanMinute=0]="LessThanMinute",e[e.Minute=1]="Minute",e[e.Hour=2]="Hour",e[e.Day=3]="Day",e[e.Week=4]="Week",e[e.Month=5]="Month",e[e.Year=6]="Year"}(On||(On={}));const Sn=y(((e,t)=>{const n=e()-Date.parse(t);return n<6e4?{interval:On.LessThanMinute,intervalUnits:n,intervalMs:n}:n<bn?{interval:On.Minute,intervalUnits:Math.floor(n/6e4),intervalMs:n}:n<yn?{interval:On.Hour,intervalUnits:Math.floor(n/bn),intervalMs:n}:n<_n?{interval:On.Day,intervalUnits:Math.floor(n/yn),intervalMs:n}:n<xn?{interval:On.Week,intervalUnits:Math.floor(n/_n),intervalMs:n}:n<wn?{interval:On.Month,intervalUnits:Math.floor(n/xn),intervalMs:n}:{interval:On.Year,intervalUnits:Math.floor(n/wn),intervalMs:n}}),(()=>Date.now())),Cn=(e,t="")=>{const n=e.get(),o=""===t?0:Date.parse(t);return{timestamp:fn(),events:o>0?z(n,(e=>Date.parse(e.timestamp)>o)):n}},En="comments.globalUiState",kn="comments.resize",Tn={init:()=>An({readState:v("No State required")})},An=e=>e,Mn=e=>{if(!i(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");const t=[],n={};return j(e,((o,r)=>{const s=Be(o);if(1!==s.length)throw new Error("one and only one name per case");const a=s[0],c=o[a];if(void 0!==n[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!i(c))throw new Error("case arguments must be an array");t.push(a),n[a]=(...n)=>{const o=n.length;if(o!==c.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+c.length+" ("+c+"), got "+o);return{fold:(...t)=>{if(t.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+t.length);return t[r].apply(null,n)},match:e=>{const o=Be(e);if(t.length!==o.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+o.join(","));if(!J(t,(e=>W(o,e))))throw new Error("Not all branches were specified when using match. Specified: "+o.join(", ")+"\nRequired: "+t.join(", "));return e[a].apply(null,n)},log:e=>{console.log(e,{constructors:t,constructor:a,params:n})}}}})),n};Mn([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const Rn=(e,t)=>((e,t)=>({[e]:t}))(e,t),Nn=e=>(e=>{const t={};return j(e,(e=>{t[e.key]=e.value})),t})(e),Fn=e=>m(e)?e:w,Bn=(e,t)=>ie(e.element,t.event.target),Dn={can:O,abort:w,run:p},Hn=e=>{if(!qe(e,"can")&&!qe(e,"abort")&&!qe(e,"run"))throw new Error("EventHandler defined by: "+JSON.stringify(e,null,2)+" does not have can, abort, or run!");return{...Dn,...e}},Pn=()=>In(0,0),In=(e,t)=>({major:e,minor:t}),Vn={nu:In,detect:(e,t)=>{const n=String(t).toLowerCase();return 0===e.length?Pn():((e,t)=>{const n=((e,t)=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.test(t))return o}})(e,t);if(!n)return{major:0,minor:0};const o=e=>Number(t.replace(n,"$"+e));return In(o(1),o(2))})(e,n)},unknown:Pn},Wn=(e,t)=>{const n=String(t).toLowerCase();return G(e,(e=>e.search(n)))},Ln=(e,t,n=0,o)=>{const r=e.indexOf(t,n);return-1!==r&&(!!l(o)||r+t.length<=o)},Un=(e,t)=>((e,t,n)=>""===t||e.length>=t.length&&e.substr(n,n+t.length)===t)(e,t,e.length-t.length),jn=(e=>t=>t.replace(e,""))(/^\s+|\s+$/g),zn=e=>e.length>0,$n=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,qn=e=>t=>Ln(t,e),Gn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:e=>Ln(e,"edge/")&&Ln(e,"chrome")&&Ln(e,"safari")&&Ln(e,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,$n],search:e=>Ln(e,"chrome")&&!Ln(e,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:e=>Ln(e,"msie")||Ln(e,"trident")},{name:"Opera",versionRegexes:[$n,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:qn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:qn("firefox")},{name:"Safari",versionRegexes:[$n,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:e=>(Ln(e,"safari")||Ln(e,"mobile/"))&&Ln(e,"applewebkit")}],Kn=[{name:"Windows",search:qn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:e=>Ln(e,"iphone")||Ln(e,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:qn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:qn("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:qn("linux"),versionRegexes:[]},{name:"Solaris",search:qn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:qn("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:qn("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Yn={browsers:v(Gn),oses:v(Kn)},Qn="Edge",Jn="Chromium",Xn="Opera",Zn="Firefox",eo="Safari",to=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isEdge:o(Qn),isChromium:o(Jn),isIE:o("IE"),isOpera:o(Xn),isFirefox:o(Zn),isSafari:o(eo)}},no=()=>to({current:void 0,version:Vn.unknown()}),oo=to,ro=(v(Qn),v(Jn),v("IE"),v(Xn),v(Zn),v(eo),"Windows"),so="Android",ao="Linux",io="macOS",co="Solaris",lo="FreeBSD",uo="ChromeOS",mo=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isWindows:o(ro),isiOS:o("iOS"),isAndroid:o(so),isMacOS:o(io),isLinux:o(ao),isSolaris:o(co),isFreeBSD:o(lo),isChromeOS:o(uo)}},go=()=>mo({current:void 0,version:Vn.unknown()}),po=mo,ho=(v(ro),v("iOS"),v(so),v(ao),v(io),v(co),v(lo),v(uo),e=>window.matchMedia(e).matches);let vo=wt((()=>((e,t,n)=>{const o=Yn.browsers(),r=Yn.oses(),s=t.bind((e=>((e,t)=>re(t.brands,(t=>{const n=t.brand.toLowerCase();return G(e,(e=>{var t;return n===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())})).map((e=>({current:e.name,version:Vn.nu(parseInt(t.version,10),0)})))})))(o,e))).orThunk((()=>((e,t)=>Wn(e,t).map((e=>{const n=Vn.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(o,e))).fold(no,oo),a=((e,t)=>Wn(e,t).map((e=>{const n=Vn.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(r,e).fold(go,po),i=((e,t,n,o)=>{const r=e.isiOS()&&!0===/ipad/i.test(n),s=e.isiOS()&&!r,a=e.isiOS()||e.isAndroid(),i=a||o("(pointer:coarse)"),c=r||!s&&a&&o("(min-device-width:768px)"),l=s||a&&!c,u=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n),d=!l&&!c&&!u;return{isiPad:v(r),isiPhone:v(s),isTablet:v(c),isPhone:v(l),isTouch:v(i),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:v(u),isDesktop:v(d)}})(a,s,e,n);return{browser:s,os:a,deviceType:i}})(navigator.userAgent,E.from(navigator.userAgentData),ho)));const fo=()=>vo(),bo=v,yo=bo("touchstart"),_o=bo("touchmove"),xo=bo("touchend"),wo=bo("mousedown"),Oo=bo("mouseover"),So=bo("keydown"),Co=bo("keyup"),Eo=bo("input"),ko=bo("click"),To=bo("transitioncancel"),Ao=bo("transitionend"),Mo=bo("transitionstart"),Ro=e=>v("alloy."+e),No={tap:Ro("tap")},Fo=Ro("focus"),Bo=Ro("blur.post"),Do=Ro("paste.post"),Ho=Ro("receive"),Po=Ro("execute"),Io=Ro("focus.item"),Vo=No.tap,Wo=Ro("longpress"),Lo=Ro("sandbox.close"),Uo=Ro("system.init"),jo=Ro("system.attached"),zo=Ro("system.detached"),$o=Ro("system.dismissRequested"),qo=Ro("system.repositionRequested"),Go=Ro("focusmanager.shifted"),Ko=Ro("highlight"),Yo=Ro("dehighlight"),Qo=(e,t)=>{er(e,e.element,t,{})},Jo=(e,t,n)=>{er(e,e.element,t,n)},Xo=e=>{Qo(e,Po())},Zo=(e,t,n)=>{er(e,t,n,{})},er=(e,t,n,o)=>{const r={target:t,...o};e.getSystem().triggerEvent(n,t,r)},tr=e=>Nn(e),nr=(e,t)=>({key:e,value:Hn({abort:t})}),or=(e,t)=>({key:e,value:Hn({run:t})}),rr=e=>t=>({key:e,value:Hn({run:(e,n)=>{Bn(e,n)&&t(e,n)}})}),sr=e=>or(e,((e,t)=>{t.cut()})),ar=e=>or(e,((e,t)=>{t.stop()})),ir=(e,t)=>rr(e)(t),cr=rr(jo()),lr=rr(zo()),ur=rr(Uo()),dr=(e=>t=>or(e,t))(Po()),mr=(e,t,n=b)=>e.exists((e=>n(e,t))),gr=e=>{const t=[],n=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(n);return t},pr=(e,t,n)=>e.isSome()&&t.isSome()?E.some(n(e.getOrDie(),t.getOrDie())):E.none(),hr=e=>U(e,(e=>Un(e,"/*")?e.substring(0,e.length-"/*".length):e)),vr=(e,t)=>{const n=e.toString(),o=n.indexOf(")")+1,r=n.indexOf("("),s=n.substring(r+1,o-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:t,parameters:hr(s)}),e},fr=e=>({classes:l(e.classes)?[]:e.classes,attributes:l(e.attributes)?{}:e.attributes,styles:l(e.styles)?{}:e.styles}),br=(e,t,n)=>ur(((o,r)=>{n(o,e,t)})),yr=e=>({key:e,value:void 0}),_r=(e,t,n,o,r,s,a)=>{const i=e=>qe(e,n)?e[n]():E.none(),c=Pe(r,((e,t)=>((e,t,n)=>((e,t,n)=>{const o=n.toString(),r=o.indexOf(")")+1,s=o.indexOf("("),a=o.substring(s+1,r-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:t,parameters:hr(a.slice(0,1).concat(a.slice(3)))}),e})(((o,...r)=>{const s=[o].concat(r);return o.config({name:v(e)}).fold((()=>{throw new Error("We could not find any behaviour configuration for: "+e+". Using API: "+n)}),(e=>{const n=Array.prototype.slice.call(s,1);return t.apply(void 0,[o,e.config,e.state].concat(n))}))}),n,t))(n,e,t))),l={...Pe(s,((e,t)=>vr(e,t))),...c,revoke:y(yr,n),config:t=>{const o=Kt(n+"-config",e,t);return{key:n,value:{config:o,me:l,configAsRaw:wt((()=>Kt(n+"-config",e,t))),initialConfig:t,state:a}}},schema:v(t),exhibit:(e,t)=>pr(i(e),ze(o,"exhibit"),((e,n)=>n(t,e.config,e.state))).getOrThunk((()=>fr({}))),name:v(n),handlers:e=>i(e).map((e=>ze(o,"events").getOr((()=>({})))(e.config,e.state))).getOr({})};return l},xr=e=>Nn(e),wr=Bt([Zt("fields"),Zt("name"),cn("active",{}),cn("apis",{}),cn("state",Tn),cn("extra",{})]),Or=e=>{const t=Kt("Creating behaviour: "+e.name,wr,e);return((e,t,n,o,r,s)=>{const a=Bt(e),i=sn(t,[an("config",e)]);return _r(a,i,t,n,o,r,s)})(t.fields,t.name,t.active,t.apis,t.extra,t.state)},Sr=Bt([Zt("branchKey"),Zt("branches"),Zt("name"),cn("active",{}),cn("apis",{}),cn("state",Tn),cn("extra",{})]),Cr=v(void 0),Er=(e,t)=>{const n=((e,t)=>{const n=tr(t);return Or({fields:[Zt("enabled")],name:e,active:{events:v(n)}})})(e,t);return{key:e,value:{config:{},me:n,configAsRaw:v({}),initialConfig:{},state:Tn}}},kr=()=>R(document),Tr=e=>e.dom.focus(),Ar=(e=kr())=>E.from(e.dom.activeElement).map(R),Mr=e=>Ar(Ce(e)).filter((t=>e.dom.contains(t.dom))),Rr=(e,t)=>{j(t,(t=>{Fe(e,t)}))},Nr=e=>{e.dom.textContent="",j(ye(e),(e=>{Fr(e)}))},Fr=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Br=e=>e.dom.innerHTML,Dr=(e,t)=>{const n=he(e).dom,o=R(n.createDocumentFragment()),r=((e,t)=>{const n=(t||document).createElement("div");return n.innerHTML=e,ye(R(n))})(t,n);Rr(o,r),Nr(e),Fe(e,o)},Hr=(e,t,n)=>{if(!(r(n)||c(n)||g(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},Pr=(e,t,n)=>{Hr(e.dom,t,n)},Ir=(e,t)=>{const n=e.dom;He(t,((e,t)=>{Hr(n,t,e)}))},Vr=(e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n},Wr=(e,t)=>E.from(Vr(e,t)),Lr=(e,t)=>{const n=e.dom;return!(!n||!n.hasAttribute)&&n.hasAttribute(t)},Ur=(e,t)=>{e.dom.removeAttribute(t)},jr=e=>we(e)?"#shadow-root":(e=>{const t=A("div"),n=R(e.dom.cloneNode(!0));return Fe(t,n),Br(t)})((e=>((e,t)=>R(e.dom.cloneNode(!1)))(e))(e)),zr=e=>jr(e);var $r;!function(e){e[e.STOP=0]="STOP",e[e.NORMAL=1]="NORMAL",e[e.LOGGING=2]="LOGGING"}($r||($r={}));const qr=vn({}),Gr=["alloy/data/Fields","alloy/debugging/Debugging"],Kr=(e,t,n)=>((e,t,n)=>{switch(ze(qr.get(),e).orThunk((()=>{const t=Be(qr.get());return re(t,(t=>e.indexOf(t)>-1?E.some(qr.get()[t]):E.none()))})).getOr($r.NORMAL)){case $r.NORMAL:return n(Yr());case $r.LOGGING:{const o=((e,t)=>{const n=[],o=(new Date).getTime();return{logEventCut:(e,t,o)=>{n.push({outcome:"cut",target:t,purpose:o})},logEventStopped:(e,t,o)=>{n.push({outcome:"stopped",target:t,purpose:o})},logNoParent:(e,t,o)=>{n.push({outcome:"no-parent",target:t,purpose:o})},logEventNoHandlers:(e,t)=>{n.push({outcome:"no-handlers-left",target:t})},logEventResponse:(e,t,o)=>{n.push({outcome:"response",purpose:o,target:t})},write:()=>{const r=(new Date).getTime();W(["mousemove","mouseover","mouseout",Uo()],e)||console.log(e,{event:e,time:r-o,target:t.dom,sequence:U(n,(e=>W(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+zr(e.target)+")":e.outcome))})}}})(e,t),r=n(o);return o.write(),r}case $r.STOP:return!0}})(e,t,n),Yr=v({logEventCut:p,logEventStopped:p,logNoParent:p,logEventNoHandlers:p,logEventResponse:p,write:p}),Qr=e=>e.cHandler,Jr=e=>{const t=vn(E.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(E.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(E.some(e))}}},Xr=()=>Jr((e=>e.unbind())),Zr=()=>{const e=Jr(p);return{...e,on:t=>e.get().each(t)}};var es=(e,t,n,o,r)=>e(n,o)?E.some(n):m(r)&&r(n)?E.none():t(n,o,r);const ts=(e,t,n)=>{let o=e.dom;const r=m(n)?n:w;for(;o.parentNode;){o=o.parentNode;const e=R(o);if(t(e))return E.some(e);if(r(e))break}return E.none()},ns=(e,t,n)=>es(((e,t)=>t(e)),ts,e,t,n),os=(e,t,n)=>ts(e,(e=>se(e,t)),n),rs=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return ae(n)?E.none():E.from(n.querySelector(e)).map(R)})(t,e),ss=(e,t,n)=>es(((e,t)=>se(e,t)),os,e,t,n),as=[8],is=[9],cs=[13],ls=[27],us=[32],ds=[37],ms=[38],gs=[39],ps=[40],hs=e=>{const t=e.raw;return void 0===t.touches||1!==t.touches.length?E.none():E.some(t.touches[0])},vs=e=>{const t=Zr(),n=vn(!1),o=((e,t)=>{let n=null;return{cancel:()=>{null!==n&&(clearTimeout(n),n=null)},schedule:(...t)=>{n=setTimeout((()=>{e.apply(null,t),n=null}),400)}}})((t=>{e.triggerEvent(Wo(),t),n.set(!0)})),r=Nn([{key:yo(),value:e=>(hs(e).each((r=>{o.cancel();const s={x:r.clientX,y:r.clientY,target:e.target};o.schedule(e),n.set(!1),t.set(s)})),E.none())},{key:_o(),value:e=>(o.cancel(),hs(e).each((e=>{t.on((n=>{((e,t)=>{const n=Math.abs(e.clientX-t.x),o=Math.abs(e.clientY-t.y);return n>5||o>5})(e,n)&&t.clear()}))})),E.none())},{key:xo(),value:r=>(o.cancel(),t.get().filter((e=>ie(e.target,r.target))).map((t=>n.get()?(r.prevent(),!1):e.triggerEvent(Vo(),r))))}]);return{fireIfReady:(e,t)=>ze(r,t).bind((t=>t(e)))}},fs=(e,t)=>{const n=ze(e,"target").getOr(t);return vn(n)},bs=Mn([{stopped:[]},{resume:["element"]},{complete:[]}]),ys=(e,t,n,o,r,s)=>{const a=e(t,o),i=((e,t)=>{const n=vn(!1),o=vn(!1);return{stop:()=>{n.set(!0)},cut:()=>{o.set(!0)},isStopped:n.get,isCut:o.get,event:e,setSource:t.set,getSource:t.get}})(n,r);return a.fold((()=>(s.logEventNoHandlers(t,o),bs.complete())),(e=>{const n=e.descHandler;return Qr(n)(i),i.isStopped()?(s.logEventStopped(t,e.element,n.purpose),bs.stopped()):i.isCut()?(s.logEventCut(t,e.element,n.purpose),bs.complete()):be(e.element).fold((()=>(s.logNoParent(t,e.element,n.purpose),bs.complete())),(o=>(s.logEventResponse(t,e.element,n.purpose),bs.resume(o))))}))},_s=(e,t,n,o,r,s)=>ys(e,t,n,o,r,s).fold(O,(o=>_s(e,t,n,o,r,s)),w),xs=(e,t,n,o,r)=>{const s=fs(n,o);return _s(e,t,n,o,s,r)};let ws=0;const Os=e=>{const t=(new Date).getTime(),n=Math.floor(1e9*Math.random());return ws++,e+"_"+n+ws+String(t)},Ss=v("alloy-id-"),Cs=v("data-alloy-id"),Es=Ss(),ks=Cs(),Ts=(e,t)=>{Object.defineProperty(e.dom,ks,{value:t,writable:!0})},As=e=>{const t=ue(e)?e.dom[ks]:null;return E.from(t)},Ms=e=>Os(e),Rs=()=>{const e={};return{registerId:(t,n,o)=>{He(o,((o,r)=>{const s=void 0!==e[r]?e[r]:{};s[n]=((e,t)=>({cHandler:y.apply(void 0,[e.handler].concat(t)),purpose:e.purpose}))(o,t),e[r]=s}))},unregisterId:t=>{He(e,((e,n)=>{$e(e,t)&&delete e[t]}))},filterByType:t=>ze(e,t).map((e=>Ue(e,((e,t)=>((e,t)=>({id:e,descHandler:t}))(t,e))))).getOr([]),find:(t,n,o)=>ze(e,n).bind((e=>((e,t,n)=>{const o=t(e),r=Fn(n);return o.orThunk((()=>r(e)?E.none():((e,t,n)=>{let o=e.dom;const r=Fn(n);for(;o.parentNode;){o=o.parentNode;const e=R(o),n=t(e);if(n.isSome())return n;if(r(e))break}return E.none()})(e,t,r)))})(o,(t=>((e,t)=>As(t).bind((t=>ze(e,t))).map((e=>((e,t)=>({element:e,descHandler:t}))(t,e))))(e,t)),t)))}},Ns=()=>{const e=Rs(),t={},n=n=>{As(n.element).each((n=>{delete t[n],e.unregisterId(n)}))};return{find:(t,n,o)=>e.find(t,n,o),filter:t=>e.filterByType(t),register:o=>{const r=(e=>{const t=e.element;return As(t).getOrThunk((()=>((e,t)=>{const n=Os(Es+"uid-");return Ts(t,n),n})(0,e.element)))})(o);qe(t,r)&&((e,o)=>{const r=t[o];if(r!==e)throw new Error('The tagId "'+o+'" is already used by: '+zr(r.element)+"\nCannot use it for: "+zr(e.element)+"\nThe conflicting element is"+(ct(r.element)?" ":" not ")+"already in the DOM");n(e)})(o,r);const s=[o];e.registerId(s,r,o.events),t[r]=o},unregister:n,getById:e=>ze(t,e)}},Fs=tr([((e,t)=>({key:e,value:Hn({can:(e,t)=>{const n=t.event,o=n.originator,r=n.target;return!((e,t,n)=>ie(t,e.element)&&!ie(t,n))(e,o,r)||(console.warn(Fo()+" did not get interpreted by the desired target. \nOriginator: "+zr(o)+"\nTarget: "+zr(r)+"\nCheck the "+Fo()+" event handlers"),!1)}})}))(Fo())]);var Bs=Object.freeze({__proto__:null,events:Fs});const Ds=f,Hs=e=>{const t=t=>`The component must be in a context to execute: ${t}`+(e?"\n"+zr(e().element)+" is not in context.":""),n=e=>()=>{throw new Error(t(e))},o=e=>()=>{console.warn(t(e))};return{debugInfo:v("fake"),triggerEvent:o("triggerEvent"),triggerFocus:o("triggerFocus"),triggerEscape:o("triggerEscape"),broadcast:o("broadcast"),broadcastOn:o("broadcastOn"),broadcastEvent:o("broadcastEvent"),build:n("build"),buildOrPatch:n("buildOrPatch"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),isConnected:w}},Ps=Hs(),Is=Os("alloy-premade"),Vs=e=>(Object.defineProperty(e.element.dom,Is,{value:e.uid,writable:!0}),Rn(Is,e)),Ws=e=>ze(e,Is),Ls=e=>((e,t)=>{const n=t.toString(),o=n.indexOf(")")+1,r=n.indexOf("("),s=n.substring(r+1,o-1).split(/,\s*/);return e.toFunctionAnnotation=()=>({name:"OVERRIDE",parameters:hr(s.slice(1))}),e})(((t,...n)=>e(t.getApis(),t,...n)),e),Us=(e,t)=>{const n={};return He(e,((e,o)=>{He(e,((e,r)=>{const s=ze(n,r).getOr([]);n[r]=s.concat([t(o,e)])}))})),n},js=(e,t,n,o)=>{try{const r=((n,r)=>{const s=P.call(n,0);return s.sort(((n,r)=>{const s=n[t],a=r[t],i=o.indexOf(s),c=o.indexOf(a);if(-1===i)throw new Error("The ordering for "+e+" does not have an entry for "+s+".\nOrder specified: "+JSON.stringify(o,null,2));if(-1===c)throw new Error("The ordering for "+e+" does not have an entry for "+a+".\nOrder specified: "+JSON.stringify(o,null,2));return i<c?-1:c<i?1:0})),s})(n);return ot.value(r)}catch(e){return ot.error([e])}},zs=(e,t)=>({name:e,handler:t}),$s=(e,t)=>{const n={};return j(e,(e=>{n[e.name()]=e.handlers(t)})),n},qs=(e,t,n)=>{const o=t[n];return o?js("Event: "+n,"name",e,o).map((e=>(e=>{const t=((e,t)=>(...t)=>q(e,((e,n)=>e&&(e=>e.can)(n).apply(void 0,t)),!0))(e),n=((e,t)=>(...t)=>q(e,((e,n)=>e||(e=>e.abort)(n).apply(void 0,t)),!1))(e);return{can:t,abort:n,run:(...t)=>{j(e,(e=>{e.run.apply(void 0,t)}))}}})(U(e,(e=>e.handler))))):((e,t)=>ot.error(["The event ("+e+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+JSON.stringify(U(t,(e=>e.name)),null,2)]))(n,e)},Gs=(e,t)=>{const n=Ue(e,((e,n)=>(1===e.length?ot.value(e[0].handler):qs(e,t,n)).map((o=>{const r=(e=>{const t=(e=>m(e)?{can:O,abort:w,run:e}:e)(e);return(e,n,...o)=>{const r=[e,n].concat(o);t.abort.apply(void 0,r)?n.stop():t.can.apply(void 0,r)&&t.run.apply(void 0,r)}})(o),s=e.length>1?z(t[n],(t=>L(e,(e=>e.name===t)))).join(" > "):e[0].name;return Rn(n,((e,t)=>({handler:e,purpose:t}))(r,s))}))));return((e,t)=>{const n=(e=>{const t=[],n=[];return j(e,(e=>{e.fold((e=>{t.push(e)}),(e=>{n.push(e)}))})),{errors:t,values:n}})(e);return n.errors.length>0?(o=n.errors,ot.error(Y(o))):((e,t)=>0===e.length?ot.value(t):ot.value(_t(t,xt.apply(void 0,e))))(n.values,t);var o})(n,{})},Ks="alloy.base.behaviour",Ys=Dt([Jt("dom","dom",{tag:"required",process:{}},Dt([Zt("tag"),cn("styles",{}),cn("classes",[]),cn("attributes",{}),on("value"),on("innerHtml")])),Zt("components"),Zt("uid"),cn("events",{}),cn("apis",{}),Jt("eventOrder","eventOrder",(Pa={[Po()]:["disabling",Ks,"toggling","typeaheadevents"],[Fo()]:[Ks,"focusing","keying"],[Uo()]:[Ks,"disabling","toggling","representing"],[Eo()]:[Ks,"representing","streaming","invalidating"],[zo()]:[Ks,"representing","item-events","tooltipping"],[wo()]:["focusing",Ks,"item-type-events"],[yo()]:["focusing",Ks,"item-type-events"],[Oo()]:["item-type-events","tooltipping"],[Ho()]:["receiving","reflecting","tooltipping"]},Ct(v(Pa))),It()),on("domModification")]),Qs=e=>e.events,Js=(e,t)=>{const n=Vr(e,t);return void 0===n||""===n?[]:n.split(" ")},Xs=e=>void 0!==e.dom.classList,Zs=e=>Js(e,"class"),ea=(e,t)=>{Xs(e)?e.dom.classList.add(t):((e,t)=>{((e,t,n)=>{const o=Js(e,t).concat([n]);Pr(e,t,o.join(" "))})(e,"class",t)})(e,t)},ta=(e,t)=>{Xs(e)?e.dom.classList.remove(t):((e,t)=>{((e,t,n)=>{const o=z(Js(e,t),(e=>e!==n));o.length>0?Pr(e,t,o.join(" ")):Ur(e,t)})(e,"class",t)})(e,t),(e=>{0===(Xs(e)?e.dom.classList:Zs(e)).length&&Ur(e,"class")})(e)},na=(e,t)=>Xs(e)&&e.dom.classList.contains(t),oa=(e,t)=>{j(t,(t=>{ea(e,t)}))},ra=(e,t)=>{j(t,(t=>{ta(e,t)}))},sa=e=>void 0!==e.style&&m(e.style.getPropertyValue),aa=(e,t,n)=>{if(!r(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);sa(e)&&e.style.setProperty(t,n)},ia=(e,t)=>{sa(e)&&e.style.removeProperty(t)},ca=(e,t,n)=>{const o=e.dom;aa(o,t,n)},la=(e,t)=>{const n=e.dom;He(t,((e,t)=>{aa(n,t,e)}))},ua=(e,t)=>{const n=e.dom;He(t,((e,t)=>{e.fold((()=>{ia(n,t)}),(e=>{aa(n,t,e)}))}))},da=(e,t)=>{const n=e.dom,o=window.getComputedStyle(n).getPropertyValue(t);return""!==o||ct(e)?o:ma(n,t)},ma=(e,t)=>sa(e)?e.style.getPropertyValue(t):"",ga=(e,t)=>{const n=e.dom,o=ma(n,t);return E.from(o).filter((e=>e.length>0))},pa=(e,t)=>{const n=e.dom;ia(n,t),mr(Wr(e,"style").map(jn),"")&&Ur(e,"style")},ha=e=>e.dom.offsetWidth,va=e=>e.dom.value,fa=(e,t)=>{if(void 0===t)throw new Error("Value.set was undefined");e.dom.value=t},ba=(e,t,n)=>{n.fold((()=>Fe(e,t)),(e=>{ie(e,t)||(Re(e,t),Fr(e))}))},ya=(e,t,n)=>{const o=U(t,n),r=ye(e);return j(r.slice(o.length),Fr),o},_a=(e,t,n,o)=>{const r=_e(e,t),s=o(n,r),a=((e,t,n)=>_e(e,t).map((e=>{if(n.exists((t=>!ie(t,e)))){const t=n.map(ce).getOr("span"),o=A(t);return Re(e,o),o}return e})))(e,t,r);return ba(e,s.element,a),s},xa=(e,t)=>{const n=Be(e),o=Be(t),r=Z(o,n),s=((e,n)=>{const o={},r={};return We(e,((e,n)=>!$e(t,n)||e!==t[n]),Ve(o),Ve(r)),{t:o,f:r}})(e).t;return{toRemove:r,toSet:s}},wa=(e,t)=>{const{class:n,style:o,...r}=(e=>q(e.dom.attributes,((e,t)=>(e[t.name]=t.value,e)),{}))(t),{toSet:s,toRemove:a}=xa(e.attributes,r),i=(e=>{const t={},n=e.dom;if(sa(n))for(let e=0;e<n.style.length;e++){const o=n.style.item(e);t[o]=n.style[o]}return t})(t),{toSet:c,toRemove:l}=xa(e.styles,i),u=(e=>Xs(e)?(e=>{const t=e.dom.classList,n=new Array(t.length);for(let e=0;e<t.length;e++){const o=t.item(e);null!==o&&(n[e]=o)}return n})(e):Zs(e))(t),d=Z(u,e.classes),m=Z(e.classes,u);return j(a,(e=>Ur(t,e))),Ir(t,s),oa(t,m),ra(t,d),j(l,(e=>pa(t,e))),la(t,c),e.innerHtml.fold((()=>{const n=e.domChildren;((e,t)=>{ya(e,t,((t,n)=>{const o=_e(e,n);return ba(e,t,o),t}))})(t,n)}),(e=>{Dr(t,e)})),(()=>{const n=t,o=e.value.getOrUndefined();o!==va(n)&&fa(n,null!=o?o:"")})(),t},Oa=e=>{const t=(e=>{const t=ze(e,"behaviours").getOr({});return Q(Be(t),(e=>{const n=t[e];return d(n)?[n.me]:[]}))})(e);return((e,t)=>((e,t)=>{const n=U(t,(e=>sn(e.name(),[Zt("config"),cn("state",Tn)]))),o=qt("component.behaviours",Dt(n),e.behaviours).fold((t=>{throw new Error(Yt(t)+"\nComplete spec:\n"+JSON.stringify(e,null,2))}),f);return{list:t,data:Pe(o,(e=>{const t=e.map((e=>({config:e.config,state:e.state.init(e.config)})));return v(t)}))}})(e,t))(e,t)},Sa=(e,t)=>{const n=()=>g,o=vn(Ps),r=Gt((e=>qt("custom.definition",Ys,e))(e)),s=Oa(e),a=(e=>e.list)(s),i=(e=>e.data)(s),c=((e,t,n)=>{const o={...(r=e).dom,uid:r.uid,domChildren:U(r.components,(e=>e.element))};var r;const s=(e=>e.domModification.fold((()=>fr({})),fr))(e),a={"alloy.base.modification":s},i=t.length>0?((e,t,n,o)=>{const r={...t};j(n,(t=>{r[t.name()]=t.exhibit(e,o)}));const s=Us(r,((e,t)=>({name:e,modification:t}))),a=e=>$(e,((e,t)=>({...t.modification,...e})),{}),i=$(s.classes,((e,t)=>t.modification.concat(e)),[]),c=a(s.attributes),l=a(s.styles);return fr({classes:i,attributes:c,styles:l})})(n,a,t,o):s;return c=o,l=i,{...c,attributes:{...c.attributes,...l.attributes},styles:{...c.styles,...l.styles},classes:c.classes.concat(l.classes)};var c,l})(r,a,i),l=((e,t)=>{const n=t.filter((t=>ce(t)===e.tag&&!(e=>e.innerHtml.isSome()&&e.domChildren.length>0)(e)&&!(e=>$e(e.dom,Is))(t))).bind((t=>((e,t)=>{try{const n=wa(e,t);return E.some(n)}catch(e){return E.none()}})(e,t))).getOrThunk((()=>(e=>{const t=A(e.tag);Ir(t,e.attributes),oa(t,e.classes),la(t,e.styles),e.innerHtml.each((e=>Dr(t,e)));const n=e.domChildren;return Rr(t,n),e.value.each((e=>{fa(t,e)})),t})(e)));return Ts(n,e.uid),n})(c,t),u=((e,t,n)=>{const o={"alloy.base.behaviour":Qs(e)};return((e,t,n,o)=>{const r=((e,t,n)=>{const o={...n,...$s(t,e)};return Us(o,zs)})(e,n,o);return Gs(r,t)})(n,e.eventOrder,t,o).getOrDie()})(r,a,i),d=vn(r.components),g={uid:e.uid,getSystem:o.get,config:t=>{const n=i;return(m(n[t.name()])?n[t.name()]:()=>{throw new Error("Could not find "+t.name()+" in "+JSON.stringify(e,null,2))})()},hasConfigured:e=>m(i[e.name()]),spec:e,readState:e=>i[e]().map((e=>e.state.readState())).getOr("not enabled"),getApis:()=>r.apis,connect:e=>{o.set(e)},disconnect:()=>{o.set(Hs(n))},element:l,syncComponents:()=>{const e=ye(l),t=Q(e,(e=>o.get().getByDom(e).fold((()=>[]),te)));d.set(t)},components:d.get,events:u};return g},Ca=e=>{const t=M(e);return Ea({element:t})},Ea=e=>{const t=Kt("external.component",Bt([Zt("element"),on("uid")]),e),n=vn(Hs()),o=t.uid.getOrThunk((()=>Ms("external")));Ts(t.element,o);const r={uid:o,getSystem:n.get,config:E.none,hasConfigured:w,connect:e=>{n.set(e)},disconnect:()=>{n.set(Hs((()=>r)))},getApis:()=>({}),element:t.element,spec:e,readState:v("No state"),syncComponents:p,components:v([]),events:{}};return Vs(r)},ka=Ms,Ta=(e,t)=>Ws(e).getOrThunk((()=>((e,t)=>{const{events:n,...o}=Ds(e),r=((e,t)=>{const n=ze(e,"components").getOr([]);return t.fold((()=>U(n,Aa)),(e=>U(n,((t,n)=>Ta(t,_e(e,n))))))})(o,t),s={...o,events:{...Bs,...n},components:r};return ot.value(Sa(s,t))})((e=>$e(e,"uid"))(e)?e:{uid:ka(""),...e},t).getOrDie())),Aa=e=>Ta(e,E.none()),Ma=Vs,Ra=(e,t)=>((e,t,n)=>ln(e,{},Dt(n)))(e,0,U(t,(t=>{return n=t.name(),o="Cannot configure "+t.name()+" for "+e,Jt(n,n,{tag:"option",process:{}},At((e=>ht("The field: "+n+" is forbidden. "+o))));var n,o})).concat([Xt("dump",f)])),Na=(e,t)=>({...xr(t),...e.dump}),Fa=Ra,Ba=Na,Da=v([Zt("menu"),Zt("selectedMenu")]),Ha=v([Zt("item"),Zt("selectedItem")]);var Pa;v(Dt(Ha().concat(Da())));const Ia=v(Dt(Ha())),Va=nn("initSize",[Zt("numColumns"),Zt("numRows")]),Wa=()=>nn("markers",[Zt("backgroundMenu")].concat(Da()).concat(Ha())),La=(e,t,n)=>((()=>{const e=new Error;if(void 0!==e.stack){const t=e.stack.split("\n");G(t,(e=>e.indexOf("alloy")>0&&!L(Gr,(t=>e.indexOf(t)>-1)))).getOr("unknown")}})(),Jt(t,t,n,zt((e=>ot.value(((...t)=>e.apply(void 0,t))))))),Ua=e=>La(0,e,St(p)),ja=e=>La(0,e,St(E.none)),za=e=>La(0,e,{tag:"required",process:{}}),$a=e=>La(0,e,{tag:"required",process:{}}),qa=(e,t)=>Xt(e,v(t)),Ga=e=>Xt(e,f),Ka=v(Va),Ya="placeholder",Qa=Mn([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Ja=e=>$e(e,"uiType"),Xa=(e,t,n,o)=>((e,t,n,o)=>Ja(n)&&n.uiType===Ya?((e,t,n,o)=>e.exists((e=>e!==n.owner))?Qa.single(!0,v(n)):ze(o,n.name).fold((()=>{throw new Error("Unknown placeholder component: "+n.name+"\nKnown: ["+Be(o)+"]\nNamespace: "+e.getOr("none")+"\nSpec: "+JSON.stringify(n,null,2))}),(e=>e.replace())))(e,0,n,o):Qa.single(!1,v(n)))(e,0,n,o).fold(((r,s)=>{const a=Ja(n)?s(t,n.config,n.validated):s(t),i=ze(a,"components").getOr([]),c=Q(i,(n=>Xa(e,t,n,o)));return[{...a,components:c}]}),((e,o)=>{if(Ja(n)){const e=o(t,n.config,n.validated);return n.validated.preprocess.getOr(f)(e)}return o(t)})),Za=Qa.single,ei=Qa.multiple,ti=v(Ya),ni=Mn([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),oi=cn("factory",{sketch:f}),ri=cn("schema",[]),si=Zt("name"),ai=Jt("pname","pname",Ot((e=>"<alloy."+Os(e.name)+">")),It()),ii=Xt("schema",(()=>[on("preprocess")])),ci=cn("defaults",v({})),li=cn("overrides",v({})),ui=Dt([oi,ri,si,ai,ci,li]),di=Dt([oi,ri,si,ci,li]),mi=Dt([oi,ri,si,ai,ci,li]),gi=Dt([oi,ii,si,Zt("unit"),ai,ci,li]),pi=e=>{const t=e=>e.name;return e.fold(t,t,t,t)},hi=(e,t)=>n=>{const o=Kt("Converting part type",t,n);return e(o)},vi=hi(ni.required,ui),fi=hi(ni.external,di),bi=hi(ni.optional,mi),yi=hi(ni.group,gi),_i=v("entirety"),xi=(e,t,n,o)=>_t(t.defaults(e,n,o),n,{uid:e.partUids[t.name]},t.overrides(e,n,o)),wi=(e,t)=>({uiType:ti(),owner:e,name:t}),Oi=(e,t,n)=>((e,t,n)=>{const o={},r={};return j(n,(e=>{e.fold((e=>{o[e.pname]=Za(!0,((t,n,o)=>e.factory.sketch(xi(t,e,n,o))))}),(e=>{const n=t.parts[e.name];r[e.name]=v(e.factory.sketch(xi(t,e,n[_i()]),n))}),(e=>{o[e.pname]=Za(!1,((t,n,o)=>e.factory.sketch(xi(t,e,n,o))))}),(e=>{o[e.pname]=ei(!0,((t,n,o)=>{const r=t[e.name];return U(r,(n=>e.factory.sketch(_t(e.defaults(t,n,o),n,e.overrides(t,n)))))}))}))})),{internals:v(o),externals:v(r)}})(0,t,n),Si=(e,t,n)=>((e,t,n,o)=>{const r=Pe(o,((e,t)=>((e,t)=>{let n=!1;return{name:v(e),required:()=>t.fold(((e,t)=>e),((e,t)=>e)),used:()=>n,replace:()=>{if(n)throw new Error("Trying to use the same placeholder more than once: "+e);return n=!0,t}}})(t,e))),s=((e,t,n,o)=>Q(n,(n=>Xa(e,t,n,o))))(e,t,n,r);return He(r,(n=>{if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+JSON.stringify(t.components,null,2))})),s})(E.some(e),t,t.components,n),Ci=e=>Jt("partUids","partUids",Ct((t=>((e,t)=>{const n=(e=>U(e,pi))(t);return Nn(U(n,(t=>({key:t,value:e+"-"+t}))))})(t.uid,e))),It()),Ei=(e,t,n,o,r)=>{const s=((e,t)=>(e.length>0?[nn("parts",e)]:[]).concat([Zt("uid"),cn("dom",{}),cn("components",[]),Ga("originalSpec"),cn("debug.sketcher",{})]).concat(t))(o,r);return Kt(e+" [SpecSchema]",Bt(s.concat(t)),n)},ki=e=>(e=>$e(e,"uid"))(e)?e:{...e,uid:Ms("uid")},Ti=Bt([Zt("name"),Zt("factory"),Zt("configFields"),cn("apis",{}),cn("extraApis",{})]),Ai=Bt([Zt("name"),Zt("factory"),Zt("configFields"),Zt("partFields"),cn("apis",{}),cn("extraApis",{})]),Mi=e=>{const t=Kt("Sketcher for "+e.name,Ti,e),n=Pe(t.apis,Ls),o=Pe(t.extraApis,((e,t)=>vr(e,t)));return{name:t.name,configFields:t.configFields,sketch:e=>((e,t,n,o)=>{const r=ki(o);return n(Ei(e,t,r,[],[]),r)})(t.name,t.configFields,t.factory,e),...n,...o}},Ri=e=>{const t=Kt("Sketcher for "+e.name,Ai,e),n=((e,t)=>{const n={};return j(t,(t=>{(e=>e.fold(E.some,E.none,E.some,E.some))(t).each((t=>{const o=wi(e,t.pname);n[t.name]=n=>{const r=Kt("Part: "+t.name+" in "+e,Dt(t.schema),n);return{...o,config:n,validated:r}}}))})),n})(t.name,t.partFields),o=Pe(t.apis,Ls),r=Pe(t.extraApis,((e,t)=>vr(e,t)));return{name:t.name,partFields:t.partFields,configFields:t.configFields,sketch:e=>((e,t,n,o,r)=>{const s=ki(r),a=(e=>Q(e,(e=>e.fold(E.none,E.some,E.none,E.none).map((e=>nn(e.name,e.schema.concat([Ga(_i())])))).toArray())))(n),i=Ci(n),c=Ei(e,t,s,a,[i]),l=Oi(0,c,n);return o(c,Si(e,c,l.internals()),s,l.externals())})(t.name,t.configFields,t.partFields,t.factory,e),parts:n,...o,...r}};Mi({name:"Container",factory:e=>{const{attributes:t,...n}=e.dom;return{uid:e.uid,dom:{tag:"div",attributes:{role:"presentation",...t},...n},components:e.components,behaviours:(o=e.containerBehaviours,o.dump),events:e.events,domModification:e.domModification,eventOrder:e.eventOrder};var o},configFields:[cn("components",[]),Ra("containerBehaviours",[]),cn("events",{}),cn("domModification",{}),cn("eventOrder",{})]});const Ni=e=>e.getSystem().isConnected(),Fi=e=>{Qo(e,zo());const t=e.components();j(t,Fi)},Bi=e=>{const t=e.components();j(t,Bi),Qo(e,jo())},Di=(e,t)=>{e.getSystem().addToWorld(t),ct(e.element)&&Bi(t)},Hi=e=>{Fi(e),e.getSystem().removeFromWorld(e)},Pi=(e,t)=>{Fe(e.element,t.element)},Ii=(e,t)=>{Vi(e,t,Fe)},Vi=(e,t,n)=>{e.getSystem().addToWorld(t),n(e.element,t.element),ct(e.element)&&Bi(t),e.syncComponents()},Wi=e=>{Fi(e),Fr(e.element),e.getSystem().removeFromWorld(e)},Li=e=>{const t=be(e.element).bind((t=>e.getSystem().getByDom(t).toOptional()));Wi(e),t.each((e=>{e.syncComponents()}))},Ui=e=>{const t=e.components();j(t,Wi),Nr(e.element),e.syncComponents()},ji=e=>{const t=t=>be(e.element).fold(O,(e=>ie(t,e))),n=Ns(),o=(e,o)=>n.find(t,e,o),r=((e,t)=>{const n={stopBackspace:!0,...t},o=vs(n),r=U(["touchstart","touchmove","touchend","touchcancel","gesturestart","mousedown","mouseup","mouseover","mousemove","mouseout","click"].concat(["selectstart","input","contextmenu","change","transitionend","transitioncancel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),(t=>Me(e,t,(e=>{o.fireIfReady(e,t).each((t=>{t&&e.kill()})),n.triggerEvent(t,e)&&e.kill()})))),s=Zr(),a=Me(e,"paste",(e=>{o.fireIfReady(e,"paste").each((t=>{t&&e.kill()})),n.triggerEvent("paste",e)&&e.kill(),s.set(setTimeout((()=>{n.triggerEvent(Do(),e)}),0))})),i=Me(e,"keydown",(e=>{n.triggerEvent("keydown",e)?e.kill():n.stopBackspace&&(e=>{return e.raw.which===as[0]&&!W(["input","textarea"],ce(e.target))&&(t=e.target,!ss(t,'[contenteditable="true"]',void 0).isSome());var t})(e)&&e.prevent()})),c=Me(e,"focusin",(e=>{n.triggerEvent("focusin",e)&&e.kill()})),l=Zr(),u=Me(e,"focusout",(e=>{n.triggerEvent("focusout",e)&&e.kill(),l.set(setTimeout((()=>{n.triggerEvent(Bo(),e)}),0))}));return{unbind:()=>{j(r,(e=>{e.unbind()})),i.unbind(),c.unbind(),u.unbind(),a.unbind(),s.on(clearTimeout),l.on(clearTimeout)}}})(e.element,{triggerEvent:(e,t)=>Kr(e,t.target,(n=>((e,t,n,o)=>xs(e,t,n,n.target,o))(o,e,t,n)))}),s={debugInfo:v("real"),triggerEvent:(e,t,n)=>{Kr(e,t,(r=>xs(o,e,n,t,r)))},triggerFocus:(e,t)=>{As(e).fold((()=>{Tr(e)}),(n=>{Kr(Fo(),e,(n=>(((e,t,n,o,r)=>{const s=fs(n,o);ys(e,t,n,o,s,r)})(o,Fo(),{originator:t,kill:p,prevent:p,target:e},e,n),!1)))}))},triggerEscape:(e,t)=>{s.triggerEvent("keydown",e.element,t.event)},getByUid:e=>h(e),getByDom:e=>f(e),build:Aa,buildOrPatch:Ta,addToGui:e=>{c(e)},removeFromGui:e=>{l(e)},addToWorld:e=>{a(e)},removeFromWorld:e=>{i(e)},broadcast:e=>{d(e)},broadcastOn:(e,t)=>{m(e,t)},broadcastEvent:(e,t)=>{g(e,t)},isConnected:O},a=e=>{e.connect(s),de(e.element)||(n.register(e),j(e.components(),a),s.triggerEvent(Uo(),e.element,{target:e.element}))},i=e=>{de(e.element)||(j(e.components(),i),n.unregister(e)),e.disconnect()},c=t=>{Ii(e,t)},l=e=>{Li(e)},u=e=>{const t=n.filter(Ho());j(t,(t=>{const n=t.descHandler;Qr(n)(e)}))},d=e=>{u({universal:!0,data:e})},m=(e,t)=>{u({universal:!1,channels:e,data:t})},g=(e,t)=>((e,t,n)=>{const o=(e=>{const t=vn(!1);return{stop:()=>{t.set(!0)},cut:p,isStopped:t.get,isCut:w,event:e,setSource:_("Cannot set source of a broadcasted event"),getSource:_("Cannot get source of a broadcasted event")}})(t);return j(e,(e=>{const t=e.descHandler;Qr(t)(o)})),o.isStopped()})(n.filter(e),t),h=e=>n.getById(e).fold((()=>ot.error(new Error('Could not find component with uid: "'+e+'" in system.'))),ot.value),f=e=>{const t=As(e).getOr("not found");return h(t)};return a(e),{root:e,element:e.element,destroy:()=>{r.unbind(),Fr(e.element)},add:c,remove:l,getByUid:h,getByDom:f,addToWorld:a,removeFromWorld:i,broadcast:d,broadcastOn:m,broadcastEvent:g}},zi=e=>{const t=(e=>void 0!==e.uid)(e)&&qe(e,"uid")?e.uid:Ms("memento");return{get:e=>e.getSystem().getByUid(t).getOrDie(),getOpt:e=>e.getSystem().getByUid(t).toOptional(),asSpec:()=>({...e,uid:t})}};var $i=Object.freeze({__proto__:null,exhibit:(e,t)=>fr({classes:[],styles:t.useFixed()?{}:{position:"relative"}})});const qi=(e,t)=>({left:e,top:t,translate:(n,o)=>qi(e+n,t+o)}),Gi=qi,Ki=(e,t)=>void 0!==e?e:void 0!==t?t:0,Yi=e=>{const t=e.dom.ownerDocument,n=t.body,o=t.defaultView,r=t.documentElement;if(n===e.dom)return Gi(n.offsetLeft,n.offsetTop);const s=Ki(null==o?void 0:o.pageYOffset,r.scrollTop),a=Ki(null==o?void 0:o.pageXOffset,r.scrollLeft),i=Ki(r.clientTop,n.clientTop),c=Ki(r.clientLeft,n.clientLeft);return Qi(e).translate(a-c,s-i)},Qi=e=>{const t=e.dom,n=t.ownerDocument.body;return n===t?Gi(n.offsetLeft,n.offsetTop):ct(e)?(e=>{const t=e.getBoundingClientRect();return Gi(t.left,t.top)})(t):Gi(0,0)},Ji=(e,t)=>{const n=n=>{const o=t(n);if(o<=0||null===o){const t=da(n,e);return parseFloat(t)||0}return o},o=(e,t)=>q(t,((t,n)=>{const o=da(e,n),r=void 0===o?0:parseInt(o,10);return isNaN(r)?t:t+r}),0);return{set:(t,n)=>{if(!g(n)&&!n.match(/^[0-9]+$/))throw new Error(e+".set accepts only positive integer values. Value was "+n);const o=t.dom;sa(o)&&(o.style[e]=n+"px")},get:n,getOuter:n,aggregate:o,max:(e,t,n)=>{const r=o(e,n);return t>r?t-r:0}}},Xi=Ji("height",(e=>{const t=e.dom;return ct(e)?t.getBoundingClientRect().height:t.offsetHeight})),Zi=e=>Xi.get(e),ec=e=>Xi.getOuter(e),tc=Ji("width",(e=>e.dom.offsetWidth)),nc=e=>tc.get(e),oc=e=>tc.getOuter(e),rc=e=>{const t=void 0!==e?e.dom:document,n=t.body.scrollLeft||t.documentElement.scrollLeft,o=t.body.scrollTop||t.documentElement.scrollTop;return Gi(n,o)},sc=(e,t,n,o)=>({x:e,y:t,width:n,height:o,right:e+n,bottom:t+o}),ac=(e,t)=>e.view(t).fold(v([]),(t=>{const n=e.owner(t),o=ac(e,n);return[t].concat(o)}));var ic=Object.freeze({__proto__:null,view:e=>{var t;return(e.dom===document?E.none():E.from(null===(t=e.dom.defaultView)||void 0===t?void 0:t.frameElement)).map(R)},owner:e=>he(e)});const cc=e=>{const t=kr(),n=rc(t),o=((e,t)=>{const n=t.owner(e),o=ac(t,n);return E.some(o)})(e,ic);return o.fold(y(Yi,e),(t=>{const o=Qi(e),r=$(t,((e,t)=>{const n=Qi(t);return{left:e.left+n.left,top:e.top+n.top}}),{left:0,top:0});return Gi(r.left+o.left+n.left,r.top+o.top+n.top)}))},lc=(e,t,n,o)=>({x:e,y:t,width:n,height:o,right:e+n,bottom:t+o}),uc=e=>{const t=Yi(e),n=oc(e),o=ec(e);return lc(t.left,t.top,n,o)},dc=()=>(e=>{const t=void 0===e?window:e,n=t.document,o=rc(R(n));return(e=>{const t=void 0===e?window:e;return fo().browser.isFirefox()?E.none():E.from(t.visualViewport)})(t).fold((()=>{const e=t.document.documentElement,n=e.clientWidth,r=e.clientHeight;return sc(o.left,o.top,n,r)}),(e=>sc(Math.max(e.pageLeft,o.left),Math.max(e.pageTop,o.top),e.width,e.height)))})(window),mc=(e,t)=>{const n=Ce(t),o=Ar(n).bind((e=>{const n=t=>ie(e,t);return n(t)?E.some(t):((e,t)=>{const n=e=>{for(let o=0;o<e.childNodes.length;o++){const r=R(e.childNodes[o]);if(t(r))return E.some(r);const s=n(e.childNodes[o]);if(s.isSome())return s}return E.none()};return n(e.dom)})(t,n)})),r=e(t);return o.each((e=>{Ar(n).filter((t=>ie(t,e))).fold((()=>{Tr(e)}),p)})),r},gc=(e,t,n,o,r)=>{const s=e=>e+"px";return{position:e,left:t.map(s),top:n.map(s),right:o.map(s),bottom:r.map(s)}},pc=Mn([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),hc=pc.southeast,vc=pc.southwest,fc=pc.northeast,bc=pc.northwest,yc=pc.south,_c=pc.north,xc=pc.east,wc=pc.west,Oc=Mn([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),Sc=(e,t,n,o,r,s)=>{const a=t.rect,i=a.x-n,c=a.y-o,l=r-(i+a.width),u=s-(c+a.height),d=E.some(i),m=E.some(c),g=E.some(l),p=E.some(u),h=E.none();return t.direction.fold((()=>gc(e,d,m,h,h)),(()=>gc(e,h,m,g,h)),(()=>gc(e,d,h,h,p)),(()=>gc(e,h,h,g,p)),(()=>gc(e,d,m,h,h)),(()=>gc(e,d,h,h,p)),(()=>gc(e,d,m,h,h)),(()=>gc(e,h,m,g,h)))},Cc=(e,t)=>e.fold((()=>{const e=t.rect;return gc("absolute",E.some(e.x),E.some(e.y),E.none(),E.none())}),((e,n,o,r)=>Sc("absolute",t,e,n,o,r)),((e,n,o,r)=>Sc("fixed",t,e,n,o,r))),Ec=(e,t)=>{const n=y(cc,t),o=e.fold(n,n,(()=>{const e=rc();return cc(t).translate(-e.left,-e.top)})),r=oc(t),s=ec(t);return lc(o.left,o.top,r,s)},kc=(e,t)=>t.fold((()=>e.fold(dc,dc,lc)),(t=>e.fold(t,t,(()=>{const n=t(),o=Tc(e,n.x,n.y);return lc(o.left,o.top,n.width,n.height)})))),Tc=(e,t,n)=>{const o=Gi(t,n);return e.fold(v(o),v(o),(()=>{const e=rc();return o.translate(-e.left,-e.top)}))};Oc.none;const Ac=Oc.relative,Mc=Oc.fixed,Rc="data-alloy-placement",Nc=(e,t,n,o)=>{const r=e+t;return r>o?n:r<n?o:r},Fc=(e,t,n)=>Math.min(Math.max(e,t),n),Bc=(e,t)=>ee(["left","right","top","bottom"],(n=>ze(t,n).map((t=>((e,t)=>{switch(t){case 1:return e.x;case 0:return e.x+e.width;case 2:return e.y;case 3:return e.y+e.height}})(e,t))))),Dc=Mn([{fit:["reposition"]},{nofit:["reposition","visibleW","visibleH","isVisible"]}]),Hc=(e,t,n,o)=>{const r=e.bubble,s=r.offset,a=((e,t,n)=>{const o=(o,r)=>t[o].map((t=>{const s="top"===o||"bottom"===o,a=s?n.top:n.left,i=("left"===o||"top"===o?Math.max:Math.min)(t,r)+a;return s?Fc(i,e.y,e.bottom):Fc(i,e.x,e.right)})).getOr(r),r=o("left",e.x),s=o("top",e.y),a=o("right",e.right),i=o("bottom",e.bottom);return lc(r,s,a-r,i-s)})(o,e.restriction,s),i=e.x+s.left,c=e.y+s.top,l=lc(i,c,t,n),{originInBounds:u,sizeInBounds:d,visibleW:m,visibleH:g}=((e,t)=>{const{x:n,y:o,right:r,bottom:s}=t,{x:a,y:i,right:c,bottom:l,width:u,height:d}=e;return{originInBounds:a>=n&&a<=r&&i>=o&&i<=s,sizeInBounds:c<=r&&c>=n&&l<=s&&l>=o,visibleW:Math.min(u,a>=n?r-a:c-n),visibleH:Math.min(d,i>=o?s-i:l-o)}})(l,a),p=u&&d,h=p?l:((e,t)=>{const{x:n,y:o,right:r,bottom:s}=t,{x:a,y:i,width:c,height:l}=e,u=Math.max(n,r-c),d=Math.max(o,s-l),m=Fc(a,n,u),g=Fc(i,o,d),p=Math.min(m+c,r)-m,h=Math.min(g+l,s)-g;return lc(m,g,p,h)})(l,a),f=h.width>0&&h.height>0,{maxWidth:b,maxHeight:y}=((e,t,n)=>{const o=v(t.bottom-n.y),r=v(n.bottom-t.y),s=((e,t,n,o)=>e.fold(t,t,o,o,t,o,n,n))(e,r,r,o),a=v(t.right-n.x),i=v(n.right-t.x),c=((e,t,n,o)=>e.fold(t,o,t,o,n,n,t,o))(e,i,i,a);return{maxWidth:c,maxHeight:s}})(e.direction,h,o),_={rect:h,maxHeight:y,maxWidth:b,direction:e.direction,placement:e.placement,classes:{on:r.classesOn,off:r.classesOff},layout:e.label,testY:c};return p||e.alwaysFit?Dc.fit(_):Dc.nofit(_,m,g,f)},Pc=["top","bottom","right","left"],Ic="data-alloy-transition-timer",Vc=(e,t,n,o,s,a)=>{const i=((e,t,n)=>n.exists((n=>{const o=e.mode;return"all"===o||n[o]!==t[o]})))(o,s,a);if(i||((e,t)=>((e,t)=>J(t,(t=>na(e,t))))(e,t.classes))(e,o)){ca(e,"position",n.position);const a=Ec(t,e),c=Cc(t,{...s,rect:a}),l=ee(Pc,(e=>c[e]));((e,t)=>{const n=e=>parseFloat(e).toFixed(3);return je(t,((t,o)=>!((e,t,n=b)=>pr(e,t,n).getOr(e.isNone()&&t.isNone()))(e[o].map(n),t.map(n)))).isSome()})(n,l)&&(ua(e,l),i&&((e,t)=>{oa(e,t.classes),Wr(e,Ic).each((t=>{clearTimeout(parseInt(t,10)),Ur(e,Ic)})),((e,t)=>{const n=Xr(),o=Xr();let s;const a=t=>{var n;const o=null!==(n=t.raw.pseudoElement)&&void 0!==n?n:"";return ie(t.target,e)&&!zn(o)&&W(Pc,t.raw.propertyName)},i=r=>{if(u(r)||a(r)){n.clear(),o.clear();const a=null==r?void 0:r.raw.type;(u(a)||a===Ao())&&(clearTimeout(s),Ur(e,Ic),ra(e,t.classes))}},c=Me(e,Mo(),(t=>{a(t)&&(c.unbind(),n.set(Me(e,Ao(),i)),o.set(Me(e,To(),i)))})),l=(e=>{const t=t=>{const n=da(e,t).split(/\s*,\s*/);return z(n,zn)},n=e=>{if(r(e)&&/^[\d.]+/.test(e)){const t=parseFloat(e);return Un(e,"ms")?t:1e3*t}return 0},o=t("transition-delay"),s=t("transition-duration");return q(s,((e,t,r)=>{const s=n(o[r])+n(t);return Math.max(e,s)}),0)})(e);requestAnimationFrame((()=>{s=setTimeout(i,l+17),Pr(e,Ic,s)}))})(e,t)})(e,o),ha(e))}else ra(e,o.classes)},Wc=v(((e,t)=>{((e,t)=>{((e,t)=>{const n=Xi.max(e,t,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]);ca(e,"max-height",n+"px")})(e,Math.floor(t))})(e,t),la(e,{"overflow-x":"hidden","overflow-y":"auto"})})),Lc=(e,t,n)=>void 0===e[t]?n:e[t],Uc=(e,t,n,o)=>{const r=((e,t,n,o)=>{pa(t,"max-height"),pa(t,"max-width");const r={width:oc(s=t),height:ec(s)};var s;return((e,t,n,o,r,s)=>{const a=o.width,i=o.height,c=(t,c,l,u,d)=>{const m=t(n,o,r,e,s),g=Hc(m,a,i,s);return g.fold(v(g),((e,t,n,o)=>(d===o?n>u||t>l:!d&&o)?g:Dc.nofit(c,l,u,d)))};return q(t,((e,t)=>{const n=y(c,t);return e.fold(v(e),n)}),Dc.nofit({rect:n,maxHeight:o.height,maxWidth:o.width,direction:hc(),placement:"southeast",classes:{on:[],off:[]},layout:"none",testY:n.y},-1,-1,!1)).fold(f,f)})(t,o.preference,e,r,n,o.bounds)})(e,t,n,o);return((e,t,n)=>{const o=Cc(n.origin,t);n.transition.each((r=>{Vc(e,n.origin,o,r,t,n.lastPlacement)})),((e,t)=>{ua(e,(e=>({...e,position:E.some(e.position)}))(t))})(e,o)})(t,r,o),((e,t)=>{((e,t)=>{Pr(e,Rc,t)})(e,t.placement)})(t,r),((e,t)=>{const n=t.classes;ra(e,n.off),oa(e,n.on)})(t,r),((e,t,n)=>{(0,n.maxHeightFunction)(e,t.maxHeight)})(t,r,o),((e,t,n)=>{(0,n.maxWidthFunction)(e,t.maxWidth)})(t,r,o),{layout:r.layout,placement:r.placement}},jc=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right","inset"],zc=()=>((e,t,n,o=1)=>{const r=e*o,s=t*o,a=e=>ze(n,e).getOr([]),i=(e,t,n)=>{const o=Z(jc,n);return{offset:Gi(e,t),classesOn:Q(n,a),classesOff:Q(o,a)}};return{southeast:()=>i(-e,t,["top","alignLeft"]),southwest:()=>i(e,t,["top","alignRight"]),south:()=>i(-e/2,t,["top","alignCentre"]),northeast:()=>i(-e,-t,["bottom","alignLeft"]),northwest:()=>i(e,-t,["bottom","alignRight"]),north:()=>i(-e/2,-t,["bottom","alignCentre"]),east:()=>i(e,-t/2,["valignCentre","left"]),west:()=>i(-e,-t/2,["valignCentre","right"]),insetNortheast:()=>i(r,s,["top","alignLeft","inset"]),insetNorthwest:()=>i(-r,s,["top","alignRight","inset"]),insetNorth:()=>i(-r/2,s,["top","alignCentre","inset"]),insetSoutheast:()=>i(r,-s,["bottom","alignLeft","inset"]),insetSouthwest:()=>i(-r,-s,["bottom","alignRight","inset"]),insetSouth:()=>i(-r/2,-s,["bottom","alignCentre","inset"]),insetEast:()=>i(-r,-s/2,["valignCentre","right","inset"]),insetWest:()=>i(r,-s/2,["valignCentre","left","inset"])}})(0,0,{}),$c=(e,t,n,o,r,s,a,i=!1)=>({x:e,y:t,bubble:n,direction:o,placement:r,restriction:s,label:`${a}-${r}`,alwaysFit:i}),qc="layout",Gc=e=>e.x,Kc=(e,t)=>e.x+e.width/2-t.width/2,Yc=(e,t)=>e.x+e.width-t.width,Qc=(e,t)=>e.y-t.height,Jc=e=>e.y+e.height,Xc=(e,t)=>e.y+e.height/2-t.height/2,Zc=(e,t,n)=>$c(Gc(e),Jc(e),n.southeast(),hc(),"southeast",Bc(e,{left:1,top:3}),qc),el=(e,t,n)=>$c(Yc(e,t),Jc(e),n.southwest(),vc(),"southwest",Bc(e,{right:0,top:3}),qc),tl=(e,t,n)=>$c(Gc(e),Qc(e,t),n.northeast(),fc(),"northeast",Bc(e,{left:1,bottom:2}),qc),nl=(e,t,n)=>$c(Yc(e,t),Qc(e,t),n.northwest(),bc(),"northwest",Bc(e,{right:0,bottom:2}),qc),ol=(e,t,n)=>$c(Kc(e,t),Qc(e,t),n.north(),_c(),"north",Bc(e,{bottom:2}),qc),rl=(e,t,n)=>$c(Kc(e,t),Jc(e),n.south(),yc(),"south",Bc(e,{top:3}),qc),sl=(e,t,n)=>$c((e=>e.x+e.width)(e),Xc(e,t),n.east(),xc(),"east",Bc(e,{left:0}),qc),al=(e,t,n)=>$c(((e,t)=>e.x-t.width)(e,t),Xc(e,t),n.west(),wc(),"west",Bc(e,{right:1}),qc),il=()=>[Zc,el,tl,nl,rl,ol,sl,al],cl=()=>[el,Zc,nl,tl,rl,ol,sl,al],ll=()=>[tl,nl,Zc,el,ol,rl],ul=()=>[nl,tl,el,Zc,ol,rl],dl=()=>[Zc,el,tl,nl,rl,ol],ml=()=>[el,Zc,nl,tl,rl,ol],gl=f,pl=(e,t)=>n=>"rtl"===hl(n)?t:e,hl=e=>"rtl"===da(e,"direction")?"rtl":"ltr",vl=(e,t,n)=>ns(e,t,n).isSome();var fl;!function(e){e.TopToBottom="toptobottom",e.BottomToTop="bottomtotop"}(fl||(fl={}));const bl=e=>vl(e,(e=>ue(e)&&Vr(e,"data-alloy-vertical-dir")===fl.BottomToTop)),yl=()=>sn("layouts",[Zt("onLtr"),Zt("onRtl"),on("onBottomLtr"),on("onBottomRtl")]),_l=(e,t,n,o,r,s,a)=>{const i=a.map(bl).getOr(!1),c=t.layouts.map((t=>t.onLtr(e))),l=t.layouts.map((t=>t.onRtl(e))),u=i?t.layouts.bind((t=>t.onBottomLtr.map((t=>t(e))))).or(c).getOr(r):c.getOr(n),d=i?t.layouts.bind((t=>t.onBottomRtl.map((t=>t(e))))).or(l).getOr(s):l.getOr(o);return pl(u,d)(e)};var xl=[Zt("hotspot"),on("bubble"),cn("overrides",{}),yl(),qa("placement",((e,t,n)=>{const o=t.hotspot,r=Ec(n,o.element),s=_l(e.element,t,dl(),ml(),ll(),ul(),E.some(t.hotspot.element));return E.some(gl({anchorBox:r,bubble:t.bubble.getOr(zc()),overrides:t.overrides,layouts:s,placer:E.none()}))}))],wl=[Zt("x"),Zt("y"),cn("height",0),cn("width",0),cn("bubble",zc()),cn("overrides",{}),yl(),qa("placement",((e,t,n)=>{const o=Tc(n,t.x,t.y),r=lc(o.left,o.top,t.width,t.height),s=_l(e.element,t,il(),cl(),il(),cl(),E.none());return E.some(gl({anchorBox:r,bubble:t.bubble,overrides:t.overrides,layouts:s,placer:E.none()}))}))];const Ol=Mn([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),Sl=e=>e.fold(f,((e,t,n)=>e.translate(-t,-n))),Cl=e=>e.fold(f,f),El=e=>q(e,((e,t)=>e.translate(t.left,t.top)),Gi(0,0)),kl=e=>{const t=U(e,Cl);return El(t)},Tl=Ol.screen,Al=Ol.absolute,Ml=(e,t,n)=>{const o=he(e.element),r=rc(o),s=((e,t,n)=>{const o=fe(n.root).dom;return E.from(o.frameElement).map(R).filter((t=>{const n=he(t),o=he(e.element);return ie(n,o)})).map(Yi)})(e,0,n).getOr(r);return Al(s,r.left,r.top)},Rl=(e,t,n,o)=>{const r=Tl(Gi(e,t));return E.some(((e,t,n)=>({point:e,width:t,height:n}))(r,n,o))},Nl=(e,t,n,o,r)=>e.map((e=>{const s=[t,e.point],a=(i=()=>kl(s),c=()=>kl(s),l=()=>(e=>{const t=U(e,Sl);return El(t)})(s),o.fold(i,c,l));var i,c,l;const u={x:a.left,y:a.top,width:e.width,height:e.height};const d=n.showAbove?ll():dl(),m=n.showAbove?ul():ml(),g=_l(r,n,d,m,d,m,E.none());return gl({anchorBox:u,bubble:n.bubble.getOr(zc()),overrides:n.overrides,layouts:g,placer:E.none()})}));var Fl=[Zt("node"),Zt("root"),on("bubble"),yl(),cn("overrides",{}),cn("showAbove",!1),qa("placement",((e,t,n)=>{const o=Ml(e,0,t);return t.node.filter(ct).bind((r=>{const s=r.dom.getBoundingClientRect(),a=Rl(s.left,s.top,s.width,s.height),i=t.node.getOr(e.element);return Nl(a,o,t,n,i)}))}))];const Bl=(e,t,n,o)=>({start:e,soffset:t,finish:n,foffset:o}),Dl=Mn([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Hl=(Dl.before,Dl.on,Dl.after,e=>e.fold(f,f,f)),Pl=Mn([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Il={domRange:Pl.domRange,relative:Pl.relative,exact:Pl.exact,exactFromRange:e=>Pl.exact(e.start,e.soffset,e.finish,e.foffset),getWin:e=>{const t=(e=>e.match({domRange:e=>R(e.startContainer),relative:(e,t)=>Hl(e),exact:(e,t,n,o)=>e}))(e);return fe(t)},range:Bl},Vl=(e,t,n)=>{const o=e.document.createRange();var r;return r=o,t.fold((e=>{r.setStartBefore(e.dom)}),((e,t)=>{r.setStart(e.dom,t)}),(e=>{r.setStartAfter(e.dom)})),((e,t)=>{t.fold((t=>{e.setEndBefore(t.dom)}),((t,n)=>{e.setEnd(t.dom,n)}),(t=>{e.setEndAfter(t.dom)}))})(o,n),o},Wl=(e,t,n,o,r)=>{const s=e.document.createRange();return s.setStart(t.dom,n),s.setEnd(o.dom,r),s},Ll=e=>({left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}),Ul=Mn([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),jl=(e,t,n)=>t(R(n.startContainer),n.startOffset,R(n.endContainer),n.endOffset),zl=(e,t)=>((e,t)=>{const n=((e,t)=>t.match({domRange:e=>({ltr:v(e),rtl:E.none}),relative:(t,n)=>({ltr:wt((()=>Vl(e,t,n))),rtl:wt((()=>E.some(Vl(e,n,t))))}),exact:(t,n,o,r)=>({ltr:wt((()=>Wl(e,t,n,o,r))),rtl:wt((()=>E.some(Wl(e,o,r,t,n))))})}))(e,t);return((e,t)=>{const n=t.ltr();return n.collapsed?t.rtl().filter((e=>!1===e.collapsed)).map((e=>Ul.rtl(R(e.endContainer),e.endOffset,R(e.startContainer),e.startOffset))).getOrThunk((()=>jl(0,Ul.ltr,n))):jl(0,Ul.ltr,n)})(0,n)})(e,t).match({ltr:(t,n,o,r)=>{const s=e.document.createRange();return s.setStart(t.dom,n),s.setEnd(o.dom,r),s},rtl:(t,n,o,r)=>{const s=e.document.createRange();return s.setStart(o.dom,r),s.setEnd(t.dom,n),s}});Ul.ltr,Ul.rtl;const $l=e=>{if(e.rangeCount>0){const t=e.getRangeAt(0),n=e.getRangeAt(e.rangeCount-1);return E.some(Bl(R(t.startContainer),t.startOffset,R(n.endContainer),n.endOffset))}return E.none()},ql=e=>{if(null===e.anchorNode||null===e.focusNode)return $l(e);{const t=R(e.anchorNode),n=R(e.focusNode);return((e,t,n,o)=>{const r=((e,t,n,o)=>{const r=he(e).dom.createRange();return r.setStart(e.dom,t),r.setEnd(n.dom,o),r})(e,t,n,o),s=ie(e,n)&&t===o;return r.collapsed&&!s})(t,e.anchorOffset,n,e.focusOffset)?E.some(Bl(t,e.anchorOffset,n,e.focusOffset)):$l(e)}},Gl=((e,t)=>{const n=t=>e(t)?E.from(t.dom.nodeValue):E.none();return{get:t=>{if(!e(t))throw new Error("Can only get text value of a text node");return n(t).getOr("")},getOption:n,set:(t,n)=>{if(!e(t))throw new Error("Can only set raw text value of a text node");t.dom.nodeValue=n}}})(de),Kl=(e,t)=>({element:e,offset:t}),Yl=(e,t)=>de(e)?Kl(e,t):((e,t)=>{const n=ye(e);if(0===n.length)return Kl(e,t);if(t<n.length)return Kl(n[t],0);{const e=n[n.length-1],t=de(e)?(e=>Gl.get(e))(e).length:ye(e).length;return Kl(e,t)}})(e,t),Ql=(e,t)=>t.getSelection.getOrThunk((()=>()=>(e=>(e=>E.from(e.getSelection()))(e).filter((e=>e.rangeCount>0)).bind(ql))(e)))().map((e=>{const t=Yl(e.start,e.soffset),n=Yl(e.finish,e.foffset);return Il.range(t.element,t.offset,n.element,n.offset)}));var Jl=[on("getSelection"),Zt("root"),on("bubble"),yl(),cn("overrides",{}),cn("showAbove",!1),qa("placement",((e,t,n)=>{const o=fe(t.root).dom,r=Ml(e,0,t),s=Ql(o,t).bind((e=>{const t=((e,t)=>(e=>{const t=e.getBoundingClientRect();return t.width>0||t.height>0?E.some(t).map(Ll):E.none()})(zl(e,t)))(o,Il.exactFromRange(e)).orThunk((()=>{const t=M("\ufeff");Re(e.start,t);const n=((e,t)=>(e=>{const t=e.getClientRects(),n=t.length>0?t[0]:e.getBoundingClientRect();return n.width>0||n.height>0?E.some(n).map(Ll):E.none()})(zl(e,t)))(o,Il.exact(t,0,t,1));return Fr(t),n}));return t.bind((e=>Rl(e.left,e.top,e.width,e.height)))})),a=Ql(o,t).bind((e=>ue(e.start)?E.some(e.start):(e=>E.from(e.dom.parentElement).map(R))(e.start))),i=a.getOr(e.element);return Nl(s,r,t,n,i)}))];const Xl="link-layout",Zl=e=>e.x+e.width,eu=(e,t)=>e.x-t.width,tu=(e,t)=>e.y-t.height+e.height,nu=e=>e.y,ou=(e,t,n)=>$c(Zl(e),nu(e),n.southeast(),hc(),"southeast",Bc(e,{left:0,top:2}),Xl),ru=(e,t,n)=>$c(eu(e,t),nu(e),n.southwest(),vc(),"southwest",Bc(e,{right:1,top:2}),Xl),su=(e,t,n)=>$c(Zl(e),tu(e,t),n.northeast(),fc(),"northeast",Bc(e,{left:0,bottom:3}),Xl),au=(e,t,n)=>$c(eu(e,t),tu(e,t),n.northwest(),bc(),"northwest",Bc(e,{right:1,bottom:3}),Xl),iu=()=>[ou,ru,su,au],cu=()=>[ru,ou,au,su];var lu=[Zt("item"),yl(),cn("overrides",{}),qa("placement",((e,t,n)=>{const o=Ec(n,t.item.element),r=_l(e.element,t,iu(),cu(),iu(),cu(),E.none());return E.some(gl({anchorBox:o,bubble:zc(),overrides:t.overrides,layouts:r,placer:E.none()}))}))],uu=Qt("type",{selection:Jl,node:Fl,hotspot:xl,submenu:lu,makeshift:wl});const du=[((e,t)=>Jt(e,e,{tag:"required",process:{}},Ht(t)))("classes",Wt),ln("mode","all",(fu=["all","layout","placement"],zt((e=>W(fu,e)?ot.value(e):ot.error(`Unsupported value: "${e}", choose one of "${fu.join(", ")}".`)))))],mu=[cn("useFixed",w),on("getBounds")],gu=[en("anchor",uu),sn("transition",du)],pu=(e,t,n,o,r,s,a)=>((e,t,n,o,r,s,a,i)=>{const c=Lc(a,"maxHeightFunction",Wc()),l=Lc(a,"maxWidthFunction",p),u=e.anchorBox,d=e.origin,m={bounds:kc(d,s),origin:d,preference:o,maxHeightFunction:c,maxWidthFunction:l,lastPlacement:r,transition:i};return Uc(u,t,n,m)})(((e,t)=>((e,t)=>({anchorBox:e,origin:t}))(e,t))(n.anchorBox,t),r.element,n.bubble,n.layouts,s,o,n.overrides,a),hu=(e,t,n,o,r,s)=>{const a=s.map(uc);return vu(e,t,n,o,r,a)},vu=(e,t,n,o,r,s)=>{const a=Kt("placement.info",Dt(gu),r),i=a.anchor,c=o.element,l=n.get(o.uid);mc((()=>{ca(c,"position","fixed");const r=ga(c,"visibility");ca(c,"visibility","hidden");const u=t.useFixed()?(()=>{const e=document.documentElement;return Mc(0,0,e.clientWidth,e.clientHeight)})():(e=>{const t=Yi(e.element),n=e.element.dom.getBoundingClientRect();return Ac(t.left,t.top,n.width,n.height)})(e),d=i.placement,m=s.map(v).or(t.getBounds);d(e,i,u).each((t=>{const r=t.placer.getOr(pu)(e,u,t,m,o,l,a.transition);n.set(o.uid,r)})),r.fold((()=>{pa(c,"visibility")}),(e=>{ca(c,"visibility",e)})),ga(c,"left").isNone()&&ga(c,"top").isNone()&&ga(c,"right").isNone()&&ga(c,"bottom").isNone()&&mr(ga(c,"position"),"fixed")&&pa(c,"position")}),c)};var fu,bu=Object.freeze({__proto__:null,position:(e,t,n,o,r)=>{hu(e,t,n,o,r,E.none())},positionWithin:hu,positionWithinBounds:vu,getMode:(e,t,n)=>t.useFixed()?"fixed":"absolute",reset:(e,t,n,o)=>{const r=o.element;j(["position","left","right","top","bottom"],(e=>pa(r,e))),(e=>{Ur(e,Rc)})(r),n.clear(o.uid)}});const yu=Or({fields:mu,name:"positioning",active:$i,apis:bu,state:Object.freeze({__proto__:null,init:()=>{let e={};return An({readState:()=>e,clear:t=>{d(t)?delete e[t]:e={}},set:(t,n)=>{e[t]=n},get:t=>ze(e,t)})}})}),_u=(e,t)=>{mc((()=>{((e,t,n)=>{const o=e.components();(e=>{j(e.components(),(e=>Fr(e.element))),Nr(e.element),e.syncComponents()})(e);const r=n(t),s=Z(o,r);j(s,(t=>{Fi(t),e.getSystem().removeFromWorld(t)})),j(r,(t=>{Ni(t)?Pi(e,t):(e.getSystem().addToWorld(t),Pi(e,t),ct(e.element)&&Bi(t))})),e.syncComponents()})(e,t,(()=>U(t,e.getSystem().build)))}),e.element)},xu=(e,t)=>{mc((()=>{((n,o,r)=>{const s=n.components(),a=Q(o,(e=>Ws(e).toArray()));j(s,(e=>{W(a,e)||Hi(e)}));const i=((e,t,n)=>ya(e,t,((t,o)=>_a(e,o,t,n))))(e.element,t,e.getSystem().buildOrPatch),c=Z(s,i);j(c,(e=>{Ni(e)&&Hi(e)})),j(i,(e=>{Ni(e)||Di(n,e)})),n.syncComponents()})(e,t)}),e.element)},wu=(e,t,n,o)=>{Hi(t);const r=_a(e.element,n,o,e.getSystem().buildOrPatch);Di(e,r),e.syncComponents()},Ou=(e,t,n)=>{const o=e.getSystem().build(n);Vi(e,o,t)},Su=(e,t,n,o)=>{Li(t),Ou(e,((e,t)=>((e,t,n)=>{_e(e,n).fold((()=>{Fe(e,t)}),(e=>{Re(e,t)}))})(e,t,n)),o)},Cu=(e,t)=>e.components(),Eu=(e,t,n,o,r)=>{const s=Cu(e);return E.from(s[o]).map((n=>(r.fold((()=>Li(n)),(r=>{(t.reuseDom?wu:Su)(e,n,o,r)})),n)))};var ku=Object.freeze({__proto__:null,append:(e,t,n,o)=>{Ou(e,Fe,o)},prepend:(e,t,n,o)=>{Ou(e,Ne,o)},remove:(e,t,n,o)=>{const r=Cu(e),s=G(r,(e=>ie(o.element,e.element)));s.each(Li)},replaceAt:Eu,replaceBy:(e,t,n,o,r)=>{const s=Cu(e);return K(s,o).bind((n=>Eu(e,t,0,n,r)))},set:(e,t,n,o)=>(t.reuseDom?xu:_u)(e,o),contents:Cu});const Tu=Or({fields:[ln("reuseDom",!0,Lt)],name:"replacing",apis:ku}),Au=e=>!(e=>e.offsetWidth<=0&&e.offsetHeight<=0)(e.dom);var Mu,Ru={exports:{}};(Mu=Ru).exports&&(Mu.exports=function(){var e=3,t=4,n=12,o=13,r=16,s=17;function a(e,t){void 0===t&&(t=0);var n=e.charCodeAt(t);if(55296<=n&&n<=56319&&t<e.length-1){var o=n;return 56320<=(r=e.charCodeAt(t+1))&&r<=57343?1024*(o-55296)+(r-56320)+65536:o}if(56320<=n&&n<=57343&&t>=1){var r=n;return 55296<=(o=e.charCodeAt(t-1))&&o<=56319?1024*(o-55296)+(r-56320)+65536:r}return n}function i(a,i,c){var l=[a].concat(i).concat([c]),u=l[l.length-2],d=c,m=l.lastIndexOf(14);if(m>1&&l.slice(1,m).every((function(t){return t==e}))&&-1==[e,o,s].indexOf(a))return 2;var g=l.lastIndexOf(t);if(g>0&&l.slice(1,g).every((function(e){return e==t}))&&-1==[n,t].indexOf(u))return l.filter((function(e){return e==t})).length%2==1?3:4;if(0==u&&1==d)return 0;if(2==u||0==u||1==u)return 14==d&&i.every((function(t){return t==e}))?2:1;if(2==d||0==d||1==d)return 1;if(6==u&&(6==d||7==d||9==d||10==d))return 0;if(!(9!=u&&7!=u||7!=d&&8!=d))return 0;if((10==u||8==u)&&8==d)return 0;if(d==e||15==d)return 0;if(5==d)return 0;if(u==n)return 0;var p=-1!=l.indexOf(e)?l.lastIndexOf(e)-1:l.length-2;return-1!=[o,s].indexOf(l[p])&&l.slice(p+1,-1).every((function(t){return t==e}))&&14==d||15==u&&-1!=[r,s].indexOf(d)?0:-1!=i.indexOf(t)?2:u==t&&d==t?0:1}function c(a){return 1536<=a&&a<=1541||1757==a||1807==a||2274==a||3406==a||69821==a||70082<=a&&a<=70083||72250==a||72326<=a&&a<=72329||73030==a?n:13==a?0:10==a?1:0<=a&&a<=9||11<=a&&a<=12||14<=a&&a<=31||127<=a&&a<=159||173==a||1564==a||6158==a||8203==a||8206<=a&&a<=8207||8232==a||8233==a||8234<=a&&a<=8238||8288<=a&&a<=8292||8293==a||8294<=a&&a<=8303||55296<=a&&a<=57343||65279==a||65520<=a&&a<=65528||65529<=a&&a<=65531||113824<=a&&a<=113827||119155<=a&&a<=119162||917504==a||917505==a||917506<=a&&a<=917535||917632<=a&&a<=917759||918e3<=a&&a<=921599?2:768<=a&&a<=879||1155<=a&&a<=1159||1160<=a&&a<=1161||1425<=a&&a<=1469||1471==a||1473<=a&&a<=1474||1476<=a&&a<=1477||1479==a||1552<=a&&a<=1562||1611<=a&&a<=1631||1648==a||1750<=a&&a<=1756||1759<=a&&a<=1764||1767<=a&&a<=1768||1770<=a&&a<=1773||1809==a||1840<=a&&a<=1866||1958<=a&&a<=1968||2027<=a&&a<=2035||2070<=a&&a<=2073||2075<=a&&a<=2083||2085<=a&&a<=2087||2089<=a&&a<=2093||2137<=a&&a<=2139||2260<=a&&a<=2273||2275<=a&&a<=2306||2362==a||2364==a||2369<=a&&a<=2376||2381==a||2385<=a&&a<=2391||2402<=a&&a<=2403||2433==a||2492==a||2494==a||2497<=a&&a<=2500||2509==a||2519==a||2530<=a&&a<=2531||2561<=a&&a<=2562||2620==a||2625<=a&&a<=2626||2631<=a&&a<=2632||2635<=a&&a<=2637||2641==a||2672<=a&&a<=2673||2677==a||2689<=a&&a<=2690||2748==a||2753<=a&&a<=2757||2759<=a&&a<=2760||2765==a||2786<=a&&a<=2787||2810<=a&&a<=2815||2817==a||2876==a||2878==a||2879==a||2881<=a&&a<=2884||2893==a||2902==a||2903==a||2914<=a&&a<=2915||2946==a||3006==a||3008==a||3021==a||3031==a||3072==a||3134<=a&&a<=3136||3142<=a&&a<=3144||3146<=a&&a<=3149||3157<=a&&a<=3158||3170<=a&&a<=3171||3201==a||3260==a||3263==a||3266==a||3270==a||3276<=a&&a<=3277||3285<=a&&a<=3286||3298<=a&&a<=3299||3328<=a&&a<=3329||3387<=a&&a<=3388||3390==a||3393<=a&&a<=3396||3405==a||3415==a||3426<=a&&a<=3427||3530==a||3535==a||3538<=a&&a<=3540||3542==a||3551==a||3633==a||3636<=a&&a<=3642||3655<=a&&a<=3662||3761==a||3764<=a&&a<=3769||3771<=a&&a<=3772||3784<=a&&a<=3789||3864<=a&&a<=3865||3893==a||3895==a||3897==a||3953<=a&&a<=3966||3968<=a&&a<=3972||3974<=a&&a<=3975||3981<=a&&a<=3991||3993<=a&&a<=4028||4038==a||4141<=a&&a<=4144||4146<=a&&a<=4151||4153<=a&&a<=4154||4157<=a&&a<=4158||4184<=a&&a<=4185||4190<=a&&a<=4192||4209<=a&&a<=4212||4226==a||4229<=a&&a<=4230||4237==a||4253==a||4957<=a&&a<=4959||5906<=a&&a<=5908||5938<=a&&a<=5940||5970<=a&&a<=5971||6002<=a&&a<=6003||6068<=a&&a<=6069||6071<=a&&a<=6077||6086==a||6089<=a&&a<=6099||6109==a||6155<=a&&a<=6157||6277<=a&&a<=6278||6313==a||6432<=a&&a<=6434||6439<=a&&a<=6440||6450==a||6457<=a&&a<=6459||6679<=a&&a<=6680||6683==a||6742==a||6744<=a&&a<=6750||6752==a||6754==a||6757<=a&&a<=6764||6771<=a&&a<=6780||6783==a||6832<=a&&a<=6845||6846==a||6912<=a&&a<=6915||6964==a||6966<=a&&a<=6970||6972==a||6978==a||7019<=a&&a<=7027||7040<=a&&a<=7041||7074<=a&&a<=7077||7080<=a&&a<=7081||7083<=a&&a<=7085||7142==a||7144<=a&&a<=7145||7149==a||7151<=a&&a<=7153||7212<=a&&a<=7219||7222<=a&&a<=7223||7376<=a&&a<=7378||7380<=a&&a<=7392||7394<=a&&a<=7400||7405==a||7412==a||7416<=a&&a<=7417||7616<=a&&a<=7673||7675<=a&&a<=7679||8204==a||8400<=a&&a<=8412||8413<=a&&a<=8416||8417==a||8418<=a&&a<=8420||8421<=a&&a<=8432||11503<=a&&a<=11505||11647==a||11744<=a&&a<=11775||12330<=a&&a<=12333||12334<=a&&a<=12335||12441<=a&&a<=12442||42607==a||42608<=a&&a<=42610||42612<=a&&a<=42621||42654<=a&&a<=42655||42736<=a&&a<=42737||43010==a||43014==a||43019==a||43045<=a&&a<=43046||43204<=a&&a<=43205||43232<=a&&a<=43249||43302<=a&&a<=43309||43335<=a&&a<=43345||43392<=a&&a<=43394||43443==a||43446<=a&&a<=43449||43452==a||43493==a||43561<=a&&a<=43566||43569<=a&&a<=43570||43573<=a&&a<=43574||43587==a||43596==a||43644==a||43696==a||43698<=a&&a<=43700||43703<=a&&a<=43704||43710<=a&&a<=43711||43713==a||43756<=a&&a<=43757||43766==a||44005==a||44008==a||44013==a||64286==a||65024<=a&&a<=65039||65056<=a&&a<=65071||65438<=a&&a<=65439||66045==a||66272==a||66422<=a&&a<=66426||68097<=a&&a<=68099||68101<=a&&a<=68102||68108<=a&&a<=68111||68152<=a&&a<=68154||68159==a||68325<=a&&a<=68326||69633==a||69688<=a&&a<=69702||69759<=a&&a<=69761||69811<=a&&a<=69814||69817<=a&&a<=69818||69888<=a&&a<=69890||69927<=a&&a<=69931||69933<=a&&a<=69940||70003==a||70016<=a&&a<=70017||70070<=a&&a<=70078||70090<=a&&a<=70092||70191<=a&&a<=70193||70196==a||70198<=a&&a<=70199||70206==a||70367==a||70371<=a&&a<=70378||70400<=a&&a<=70401||70460==a||70462==a||70464==a||70487==a||70502<=a&&a<=70508||70512<=a&&a<=70516||70712<=a&&a<=70719||70722<=a&&a<=70724||70726==a||70832==a||70835<=a&&a<=70840||70842==a||70845==a||70847<=a&&a<=70848||70850<=a&&a<=70851||71087==a||71090<=a&&a<=71093||71100<=a&&a<=71101||71103<=a&&a<=71104||71132<=a&&a<=71133||71219<=a&&a<=71226||71229==a||71231<=a&&a<=71232||71339==a||71341==a||71344<=a&&a<=71349||71351==a||71453<=a&&a<=71455||71458<=a&&a<=71461||71463<=a&&a<=71467||72193<=a&&a<=72198||72201<=a&&a<=72202||72243<=a&&a<=72248||72251<=a&&a<=72254||72263==a||72273<=a&&a<=72278||72281<=a&&a<=72283||72330<=a&&a<=72342||72344<=a&&a<=72345||72752<=a&&a<=72758||72760<=a&&a<=72765||72767==a||72850<=a&&a<=72871||72874<=a&&a<=72880||72882<=a&&a<=72883||72885<=a&&a<=72886||73009<=a&&a<=73014||73018==a||73020<=a&&a<=73021||73023<=a&&a<=73029||73031==a||92912<=a&&a<=92916||92976<=a&&a<=92982||94095<=a&&a<=94098||113821<=a&&a<=113822||119141==a||119143<=a&&a<=119145||119150<=a&&a<=119154||119163<=a&&a<=119170||119173<=a&&a<=119179||119210<=a&&a<=119213||119362<=a&&a<=119364||121344<=a&&a<=121398||121403<=a&&a<=121452||121461==a||121476==a||121499<=a&&a<=121503||121505<=a&&a<=121519||122880<=a&&a<=122886||122888<=a&&a<=122904||122907<=a&&a<=122913||122915<=a&&a<=122916||122918<=a&&a<=122922||125136<=a&&a<=125142||125252<=a&&a<=125258||917536<=a&&a<=917631||917760<=a&&a<=917999?e:127462<=a&&a<=127487?t:2307==a||2363==a||2366<=a&&a<=2368||2377<=a&&a<=2380||2382<=a&&a<=2383||2434<=a&&a<=2435||2495<=a&&a<=2496||2503<=a&&a<=2504||2507<=a&&a<=2508||2563==a||2622<=a&&a<=2624||2691==a||2750<=a&&a<=2752||2761==a||2763<=a&&a<=2764||2818<=a&&a<=2819||2880==a||2887<=a&&a<=2888||2891<=a&&a<=2892||3007==a||3009<=a&&a<=3010||3014<=a&&a<=3016||3018<=a&&a<=3020||3073<=a&&a<=3075||3137<=a&&a<=3140||3202<=a&&a<=3203||3262==a||3264<=a&&a<=3265||3267<=a&&a<=3268||3271<=a&&a<=3272||3274<=a&&a<=3275||3330<=a&&a<=3331||3391<=a&&a<=3392||3398<=a&&a<=3400||3402<=a&&a<=3404||3458<=a&&a<=3459||3536<=a&&a<=3537||3544<=a&&a<=3550||3570<=a&&a<=3571||3635==a||3763==a||3902<=a&&a<=3903||3967==a||4145==a||4155<=a&&a<=4156||4182<=a&&a<=4183||4228==a||6070==a||6078<=a&&a<=6085||6087<=a&&a<=6088||6435<=a&&a<=6438||6441<=a&&a<=6443||6448<=a&&a<=6449||6451<=a&&a<=6456||6681<=a&&a<=6682||6741==a||6743==a||6765<=a&&a<=6770||6916==a||6965==a||6971==a||6973<=a&&a<=6977||6979<=a&&a<=6980||7042==a||7073==a||7078<=a&&a<=7079||7082==a||7143==a||7146<=a&&a<=7148||7150==a||7154<=a&&a<=7155||7204<=a&&a<=7211||7220<=a&&a<=7221||7393==a||7410<=a&&a<=7411||7415==a||43043<=a&&a<=43044||43047==a||43136<=a&&a<=43137||43188<=a&&a<=43203||43346<=a&&a<=43347||43395==a||43444<=a&&a<=43445||43450<=a&&a<=43451||43453<=a&&a<=43456||43567<=a&&a<=43568||43571<=a&&a<=43572||43597==a||43755==a||43758<=a&&a<=43759||43765==a||44003<=a&&a<=44004||44006<=a&&a<=44007||44009<=a&&a<=44010||44012==a||69632==a||69634==a||69762==a||69808<=a&&a<=69810||69815<=a&&a<=69816||69932==a||70018==a||70067<=a&&a<=70069||70079<=a&&a<=70080||70188<=a&&a<=70190||70194<=a&&a<=70195||70197==a||70368<=a&&a<=70370||70402<=a&&a<=70403||70463==a||70465<=a&&a<=70468||70471<=a&&a<=70472||70475<=a&&a<=70477||70498<=a&&a<=70499||70709<=a&&a<=70711||70720<=a&&a<=70721||70725==a||70833<=a&&a<=70834||70841==a||70843<=a&&a<=70844||70846==a||70849==a||71088<=a&&a<=71089||71096<=a&&a<=71099||71102==a||71216<=a&&a<=71218||71227<=a&&a<=71228||71230==a||71340==a||71342<=a&&a<=71343||71350==a||71456<=a&&a<=71457||71462==a||72199<=a&&a<=72200||72249==a||72279<=a&&a<=72280||72343==a||72751==a||72766==a||72873==a||72881==a||72884==a||94033<=a&&a<=94078||119142==a||119149==a?5:4352<=a&&a<=4447||43360<=a&&a<=43388?6:4448<=a&&a<=4519||55216<=a&&a<=55238?7:4520<=a&&a<=4607||55243<=a&&a<=55291?8:44032==a||44060==a||44088==a||44116==a||44144==a||44172==a||44200==a||44228==a||44256==a||44284==a||44312==a||44340==a||44368==a||44396==a||44424==a||44452==a||44480==a||44508==a||44536==a||44564==a||44592==a||44620==a||44648==a||44676==a||44704==a||44732==a||44760==a||44788==a||44816==a||44844==a||44872==a||44900==a||44928==a||44956==a||44984==a||45012==a||45040==a||45068==a||45096==a||45124==a||45152==a||45180==a||45208==a||45236==a||45264==a||45292==a||45320==a||45348==a||45376==a||45404==a||45432==a||45460==a||45488==a||45516==a||45544==a||45572==a||45600==a||45628==a||45656==a||45684==a||45712==a||45740==a||45768==a||45796==a||45824==a||45852==a||45880==a||45908==a||45936==a||45964==a||45992==a||46020==a||46048==a||46076==a||46104==a||46132==a||46160==a||46188==a||46216==a||46244==a||46272==a||46300==a||46328==a||46356==a||46384==a||46412==a||46440==a||46468==a||46496==a||46524==a||46552==a||46580==a||46608==a||46636==a||46664==a||46692==a||46720==a||46748==a||46776==a||46804==a||46832==a||46860==a||46888==a||46916==a||46944==a||46972==a||47e3==a||47028==a||47056==a||47084==a||47112==a||47140==a||47168==a||47196==a||47224==a||47252==a||47280==a||47308==a||47336==a||47364==a||47392==a||47420==a||47448==a||47476==a||47504==a||47532==a||47560==a||47588==a||47616==a||47644==a||47672==a||47700==a||47728==a||47756==a||47784==a||47812==a||47840==a||47868==a||47896==a||47924==a||47952==a||47980==a||48008==a||48036==a||48064==a||48092==a||48120==a||48148==a||48176==a||48204==a||48232==a||48260==a||48288==a||48316==a||48344==a||48372==a||48400==a||48428==a||48456==a||48484==a||48512==a||48540==a||48568==a||48596==a||48624==a||48652==a||48680==a||48708==a||48736==a||48764==a||48792==a||48820==a||48848==a||48876==a||48904==a||48932==a||48960==a||48988==a||49016==a||49044==a||49072==a||49100==a||49128==a||49156==a||49184==a||49212==a||49240==a||49268==a||49296==a||49324==a||49352==a||49380==a||49408==a||49436==a||49464==a||49492==a||49520==a||49548==a||49576==a||49604==a||49632==a||49660==a||49688==a||49716==a||49744==a||49772==a||49800==a||49828==a||49856==a||49884==a||49912==a||49940==a||49968==a||49996==a||50024==a||50052==a||50080==a||50108==a||50136==a||50164==a||50192==a||50220==a||50248==a||50276==a||50304==a||50332==a||50360==a||50388==a||50416==a||50444==a||50472==a||50500==a||50528==a||50556==a||50584==a||50612==a||50640==a||50668==a||50696==a||50724==a||50752==a||50780==a||50808==a||50836==a||50864==a||50892==a||50920==a||50948==a||50976==a||51004==a||51032==a||51060==a||51088==a||51116==a||51144==a||51172==a||51200==a||51228==a||51256==a||51284==a||51312==a||51340==a||51368==a||51396==a||51424==a||51452==a||51480==a||51508==a||51536==a||51564==a||51592==a||51620==a||51648==a||51676==a||51704==a||51732==a||51760==a||51788==a||51816==a||51844==a||51872==a||51900==a||51928==a||51956==a||51984==a||52012==a||52040==a||52068==a||52096==a||52124==a||52152==a||52180==a||52208==a||52236==a||52264==a||52292==a||52320==a||52348==a||52376==a||52404==a||52432==a||52460==a||52488==a||52516==a||52544==a||52572==a||52600==a||52628==a||52656==a||52684==a||52712==a||52740==a||52768==a||52796==a||52824==a||52852==a||52880==a||52908==a||52936==a||52964==a||52992==a||53020==a||53048==a||53076==a||53104==a||53132==a||53160==a||53188==a||53216==a||53244==a||53272==a||53300==a||53328==a||53356==a||53384==a||53412==a||53440==a||53468==a||53496==a||53524==a||53552==a||53580==a||53608==a||53636==a||53664==a||53692==a||53720==a||53748==a||53776==a||53804==a||53832==a||53860==a||53888==a||53916==a||53944==a||53972==a||54e3==a||54028==a||54056==a||54084==a||54112==a||54140==a||54168==a||54196==a||54224==a||54252==a||54280==a||54308==a||54336==a||54364==a||54392==a||54420==a||54448==a||54476==a||54504==a||54532==a||54560==a||54588==a||54616==a||54644==a||54672==a||54700==a||54728==a||54756==a||54784==a||54812==a||54840==a||54868==a||54896==a||54924==a||54952==a||54980==a||55008==a||55036==a||55064==a||55092==a||55120==a||55148==a||55176==a?9:44033<=a&&a<=44059||44061<=a&&a<=44087||44089<=a&&a<=44115||44117<=a&&a<=44143||44145<=a&&a<=44171||44173<=a&&a<=44199||44201<=a&&a<=44227||44229<=a&&a<=44255||44257<=a&&a<=44283||44285<=a&&a<=44311||44313<=a&&a<=44339||44341<=a&&a<=44367||44369<=a&&a<=44395||44397<=a&&a<=44423||44425<=a&&a<=44451||44453<=a&&a<=44479||44481<=a&&a<=44507||44509<=a&&a<=44535||44537<=a&&a<=44563||44565<=a&&a<=44591||44593<=a&&a<=44619||44621<=a&&a<=44647||44649<=a&&a<=44675||44677<=a&&a<=44703||44705<=a&&a<=44731||44733<=a&&a<=44759||44761<=a&&a<=44787||44789<=a&&a<=44815||44817<=a&&a<=44843||44845<=a&&a<=44871||44873<=a&&a<=44899||44901<=a&&a<=44927||44929<=a&&a<=44955||44957<=a&&a<=44983||44985<=a&&a<=45011||45013<=a&&a<=45039||45041<=a&&a<=45067||45069<=a&&a<=45095||45097<=a&&a<=45123||45125<=a&&a<=45151||45153<=a&&a<=45179||45181<=a&&a<=45207||45209<=a&&a<=45235||45237<=a&&a<=45263||45265<=a&&a<=45291||45293<=a&&a<=45319||45321<=a&&a<=45347||45349<=a&&a<=45375||45377<=a&&a<=45403||45405<=a&&a<=45431||45433<=a&&a<=45459||45461<=a&&a<=45487||45489<=a&&a<=45515||45517<=a&&a<=45543||45545<=a&&a<=45571||45573<=a&&a<=45599||45601<=a&&a<=45627||45629<=a&&a<=45655||45657<=a&&a<=45683||45685<=a&&a<=45711||45713<=a&&a<=45739||45741<=a&&a<=45767||45769<=a&&a<=45795||45797<=a&&a<=45823||45825<=a&&a<=45851||45853<=a&&a<=45879||45881<=a&&a<=45907||45909<=a&&a<=45935||45937<=a&&a<=45963||45965<=a&&a<=45991||45993<=a&&a<=46019||46021<=a&&a<=46047||46049<=a&&a<=46075||46077<=a&&a<=46103||46105<=a&&a<=46131||46133<=a&&a<=46159||46161<=a&&a<=46187||46189<=a&&a<=46215||46217<=a&&a<=46243||46245<=a&&a<=46271||46273<=a&&a<=46299||46301<=a&&a<=46327||46329<=a&&a<=46355||46357<=a&&a<=46383||46385<=a&&a<=46411||46413<=a&&a<=46439||46441<=a&&a<=46467||46469<=a&&a<=46495||46497<=a&&a<=46523||46525<=a&&a<=46551||46553<=a&&a<=46579||46581<=a&&a<=46607||46609<=a&&a<=46635||46637<=a&&a<=46663||46665<=a&&a<=46691||46693<=a&&a<=46719||46721<=a&&a<=46747||46749<=a&&a<=46775||46777<=a&&a<=46803||46805<=a&&a<=46831||46833<=a&&a<=46859||46861<=a&&a<=46887||46889<=a&&a<=46915||46917<=a&&a<=46943||46945<=a&&a<=46971||46973<=a&&a<=46999||47001<=a&&a<=47027||47029<=a&&a<=47055||47057<=a&&a<=47083||47085<=a&&a<=47111||47113<=a&&a<=47139||47141<=a&&a<=47167||47169<=a&&a<=47195||47197<=a&&a<=47223||47225<=a&&a<=47251||47253<=a&&a<=47279||47281<=a&&a<=47307||47309<=a&&a<=47335||47337<=a&&a<=47363||47365<=a&&a<=47391||47393<=a&&a<=47419||47421<=a&&a<=47447||47449<=a&&a<=47475||47477<=a&&a<=47503||47505<=a&&a<=47531||47533<=a&&a<=47559||47561<=a&&a<=47587||47589<=a&&a<=47615||47617<=a&&a<=47643||47645<=a&&a<=47671||47673<=a&&a<=47699||47701<=a&&a<=47727||47729<=a&&a<=47755||47757<=a&&a<=47783||47785<=a&&a<=47811||47813<=a&&a<=47839||47841<=a&&a<=47867||47869<=a&&a<=47895||47897<=a&&a<=47923||47925<=a&&a<=47951||47953<=a&&a<=47979||47981<=a&&a<=48007||48009<=a&&a<=48035||48037<=a&&a<=48063||48065<=a&&a<=48091||48093<=a&&a<=48119||48121<=a&&a<=48147||48149<=a&&a<=48175||48177<=a&&a<=48203||48205<=a&&a<=48231||48233<=a&&a<=48259||48261<=a&&a<=48287||48289<=a&&a<=48315||48317<=a&&a<=48343||48345<=a&&a<=48371||48373<=a&&a<=48399||48401<=a&&a<=48427||48429<=a&&a<=48455||48457<=a&&a<=48483||48485<=a&&a<=48511||48513<=a&&a<=48539||48541<=a&&a<=48567||48569<=a&&a<=48595||48597<=a&&a<=48623||48625<=a&&a<=48651||48653<=a&&a<=48679||48681<=a&&a<=48707||48709<=a&&a<=48735||48737<=a&&a<=48763||48765<=a&&a<=48791||48793<=a&&a<=48819||48821<=a&&a<=48847||48849<=a&&a<=48875||48877<=a&&a<=48903||48905<=a&&a<=48931||48933<=a&&a<=48959||48961<=a&&a<=48987||48989<=a&&a<=49015||49017<=a&&a<=49043||49045<=a&&a<=49071||49073<=a&&a<=49099||49101<=a&&a<=49127||49129<=a&&a<=49155||49157<=a&&a<=49183||49185<=a&&a<=49211||49213<=a&&a<=49239||49241<=a&&a<=49267||49269<=a&&a<=49295||49297<=a&&a<=49323||49325<=a&&a<=49351||49353<=a&&a<=49379||49381<=a&&a<=49407||49409<=a&&a<=49435||49437<=a&&a<=49463||49465<=a&&a<=49491||49493<=a&&a<=49519||49521<=a&&a<=49547||49549<=a&&a<=49575||49577<=a&&a<=49603||49605<=a&&a<=49631||49633<=a&&a<=49659||49661<=a&&a<=49687||49689<=a&&a<=49715||49717<=a&&a<=49743||49745<=a&&a<=49771||49773<=a&&a<=49799||49801<=a&&a<=49827||49829<=a&&a<=49855||49857<=a&&a<=49883||49885<=a&&a<=49911||49913<=a&&a<=49939||49941<=a&&a<=49967||49969<=a&&a<=49995||49997<=a&&a<=50023||50025<=a&&a<=50051||50053<=a&&a<=50079||50081<=a&&a<=50107||50109<=a&&a<=50135||50137<=a&&a<=50163||50165<=a&&a<=50191||50193<=a&&a<=50219||50221<=a&&a<=50247||50249<=a&&a<=50275||50277<=a&&a<=50303||50305<=a&&a<=50331||50333<=a&&a<=50359||50361<=a&&a<=50387||50389<=a&&a<=50415||50417<=a&&a<=50443||50445<=a&&a<=50471||50473<=a&&a<=50499||50501<=a&&a<=50527||50529<=a&&a<=50555||50557<=a&&a<=50583||50585<=a&&a<=50611||50613<=a&&a<=50639||50641<=a&&a<=50667||50669<=a&&a<=50695||50697<=a&&a<=50723||50725<=a&&a<=50751||50753<=a&&a<=50779||50781<=a&&a<=50807||50809<=a&&a<=50835||50837<=a&&a<=50863||50865<=a&&a<=50891||50893<=a&&a<=50919||50921<=a&&a<=50947||50949<=a&&a<=50975||50977<=a&&a<=51003||51005<=a&&a<=51031||51033<=a&&a<=51059||51061<=a&&a<=51087||51089<=a&&a<=51115||51117<=a&&a<=51143||51145<=a&&a<=51171||51173<=a&&a<=51199||51201<=a&&a<=51227||51229<=a&&a<=51255||51257<=a&&a<=51283||51285<=a&&a<=51311||51313<=a&&a<=51339||51341<=a&&a<=51367||51369<=a&&a<=51395||51397<=a&&a<=51423||51425<=a&&a<=51451||51453<=a&&a<=51479||51481<=a&&a<=51507||51509<=a&&a<=51535||51537<=a&&a<=51563||51565<=a&&a<=51591||51593<=a&&a<=51619||51621<=a&&a<=51647||51649<=a&&a<=51675||51677<=a&&a<=51703||51705<=a&&a<=51731||51733<=a&&a<=51759||51761<=a&&a<=51787||51789<=a&&a<=51815||51817<=a&&a<=51843||51845<=a&&a<=51871||51873<=a&&a<=51899||51901<=a&&a<=51927||51929<=a&&a<=51955||51957<=a&&a<=51983||51985<=a&&a<=52011||52013<=a&&a<=52039||52041<=a&&a<=52067||52069<=a&&a<=52095||52097<=a&&a<=52123||52125<=a&&a<=52151||52153<=a&&a<=52179||52181<=a&&a<=52207||52209<=a&&a<=52235||52237<=a&&a<=52263||52265<=a&&a<=52291||52293<=a&&a<=52319||52321<=a&&a<=52347||52349<=a&&a<=52375||52377<=a&&a<=52403||52405<=a&&a<=52431||52433<=a&&a<=52459||52461<=a&&a<=52487||52489<=a&&a<=52515||52517<=a&&a<=52543||52545<=a&&a<=52571||52573<=a&&a<=52599||52601<=a&&a<=52627||52629<=a&&a<=52655||52657<=a&&a<=52683||52685<=a&&a<=52711||52713<=a&&a<=52739||52741<=a&&a<=52767||52769<=a&&a<=52795||52797<=a&&a<=52823||52825<=a&&a<=52851||52853<=a&&a<=52879||52881<=a&&a<=52907||52909<=a&&a<=52935||52937<=a&&a<=52963||52965<=a&&a<=52991||52993<=a&&a<=53019||53021<=a&&a<=53047||53049<=a&&a<=53075||53077<=a&&a<=53103||53105<=a&&a<=53131||53133<=a&&a<=53159||53161<=a&&a<=53187||53189<=a&&a<=53215||53217<=a&&a<=53243||53245<=a&&a<=53271||53273<=a&&a<=53299||53301<=a&&a<=53327||53329<=a&&a<=53355||53357<=a&&a<=53383||53385<=a&&a<=53411||53413<=a&&a<=53439||53441<=a&&a<=53467||53469<=a&&a<=53495||53497<=a&&a<=53523||53525<=a&&a<=53551||53553<=a&&a<=53579||53581<=a&&a<=53607||53609<=a&&a<=53635||53637<=a&&a<=53663||53665<=a&&a<=53691||53693<=a&&a<=53719||53721<=a&&a<=53747||53749<=a&&a<=53775||53777<=a&&a<=53803||53805<=a&&a<=53831||53833<=a&&a<=53859||53861<=a&&a<=53887||53889<=a&&a<=53915||53917<=a&&a<=53943||53945<=a&&a<=53971||53973<=a&&a<=53999||54001<=a&&a<=54027||54029<=a&&a<=54055||54057<=a&&a<=54083||54085<=a&&a<=54111||54113<=a&&a<=54139||54141<=a&&a<=54167||54169<=a&&a<=54195||54197<=a&&a<=54223||54225<=a&&a<=54251||54253<=a&&a<=54279||54281<=a&&a<=54307||54309<=a&&a<=54335||54337<=a&&a<=54363||54365<=a&&a<=54391||54393<=a&&a<=54419||54421<=a&&a<=54447||54449<=a&&a<=54475||54477<=a&&a<=54503||54505<=a&&a<=54531||54533<=a&&a<=54559||54561<=a&&a<=54587||54589<=a&&a<=54615||54617<=a&&a<=54643||54645<=a&&a<=54671||54673<=a&&a<=54699||54701<=a&&a<=54727||54729<=a&&a<=54755||54757<=a&&a<=54783||54785<=a&&a<=54811||54813<=a&&a<=54839||54841<=a&&a<=54867||54869<=a&&a<=54895||54897<=a&&a<=54923||54925<=a&&a<=54951||54953<=a&&a<=54979||54981<=a&&a<=55007||55009<=a&&a<=55035||55037<=a&&a<=55063||55065<=a&&a<=55091||55093<=a&&a<=55119||55121<=a&&a<=55147||55149<=a&&a<=55175||55177<=a&&a<=55203?10:9757==a||9977==a||9994<=a&&a<=9997||127877==a||127938<=a&&a<=127940||127943==a||127946<=a&&a<=127948||128066<=a&&a<=128067||128070<=a&&a<=128080||128110==a||128112<=a&&a<=128120||128124==a||128129<=a&&a<=128131||128133<=a&&a<=128135||128170==a||128372<=a&&a<=128373||128378==a||128400==a||128405<=a&&a<=128406||128581<=a&&a<=128583||128587<=a&&a<=128591||128675==a||128692<=a&&a<=128694||128704==a||128716==a||129304<=a&&a<=129308||129310<=a&&a<=129311||129318==a||129328<=a&&a<=129337||129341<=a&&a<=129342||129489<=a&&a<=129501?o:127995<=a&&a<=127999?14:8205==a?15:9792==a||9794==a||9877<=a&&a<=9878||9992==a||10084==a||127752==a||127806==a||127859==a||127891==a||127908==a||127912==a||127979==a||127981==a||128139==a||128187<=a&&a<=128188||128295==a||128300==a||128488==a||128640==a||128658==a?r:128102<=a&&a<=128105?s:11}return this.nextBreak=function(e,t){if(void 0===t&&(t=0),t<0)return 0;if(t>=e.length-1)return e.length;for(var n,o,r=c(a(e,t)),s=[],l=t+1;l<e.length;l++)if(o=l-1,!(55296<=(n=e).charCodeAt(o)&&n.charCodeAt(o)<=56319&&56320<=n.charCodeAt(o+1)&&n.charCodeAt(o+1)<=57343)){var u=c(a(e,l));if(i(r,s,u))return l;s.push(u)}return e.length},this.splitGraphemes=function(e){for(var t,n=[],o=0;(t=this.nextBreak(e,o))<e.length;)n.push(e.slice(o,t)),o=t;return o<e.length&&n.push(e.slice(o)),n},this.iterateGraphemes=function(e){var t=0,n={next:function(){var n,o;return(o=this.nextBreak(e,t))<e.length?(n=e.slice(t,o),t=o,{value:n,done:!1}):t<e.length?(n=e.slice(t),t=e.length,{value:n,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return n}),n},this.countGraphemes=function(e){for(var t,n=0,o=0;(t=this.nextBreak(e,o))<e.length;)o=t,n++;return o<e.length&&n++,n},this});var Nu=Ru.exports;const Fu=fo().os.isMacOS()?"\u2318":"Ctrl",Bu=Pe({tc_menu_name:"TinyComments",tc_conversations_title:"Comments",tc_announce_sidebar_available:`Comment. Sidebar available. Press ${Fu} + Alt + M to switch to sidebar`,tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_comment:"Comment",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Add comment...",tc_kebab_delete_conversation:"Delete conversation",tc_kebab_resolve_conversation:"Resolve conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_resolve_buttons_proceed:"Resolve",tc_create_problem:"An error occurred while creating a comment. See the console for details",tc_reply_problem:"An error occurred while replying to a comment. See the console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone.",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_resolve_prompts_conversation:"Resolve this conversation?",tc_resolve_prompts_conversation_detail_sing:"1 comment will be resolved. You can't undo this action.",tc_resolve_prompts_conversation_detail_pl:"{0} comments will be resolved. You can't undo this action.",tc_delete_problem_all:"An error occurred deleting all the conversations. See the console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_resolve_unauthorised_conversation:"You are not allowed to resolve this conversation",tc_resolve_problem_conversation:"An error occurred resolving the conversation. See the console for details.",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},f),Du="tox-button--kebab",Hu="tox-comment",Pu="tox-comment__body",Iu="tox-textarea",Vu="tox-comment__reply",Wu="tox-comment__overlay",Lu="tox-comment__overlaytext",Uu="tox-comment__buttonspacing",ju="tox-button",zu="tox-comment__edit",$u="tox-comment__scroll",qu="tox-collection__item",Gu="tox-conversations",Ku=`tox-comment__expander p:contains(${Bu.tc_comment_buttons_showmore})`,Yu=`tox-comment__expander p:contains(${Bu.tc_comment_buttons_showless})`,Qu=e=>`.${e}`,Ju=e=>t=>[`${Qu(Hu)}:contains(${t})`,Qu(e)].join(" "),Xu={kebab:Qu(Du),cardBody:`${Qu(Hu)} ${Qu(Pu)}`,card:Qu(Hu),showMore:Qu(Ku),showLess:Qu(Yu),editItem:[".tox-menu",`[role="menuitem"]:contains(${Bu.tc_kebab_edit})`].join(" "),deleteItem:[".tox-menu",`[role="menuitem"]:contains(${Bu.tc_kebab_delete})`].join(" "),deleteConversationItem:[".tox-menu",`[role="menuitem"]:contains(${Bu.tc_kebab_delete_conversation})`].join(" "),resolveConversationItem:[".tox-menu",`[role="menuitem"]:contains(${Bu.tc_kebab_resolve_conversation})`].join(" "),outerScroll:Qu($u),outerContainer:Qu(Gu),cardFor:e=>`${Qu(Hu)}:contains("${e}")`,cardN:e=>`${Qu(Hu)}:nth-child(${e+1})`,kebabFor:Ju(Du),showMoreFor:Ju(Ku),showLessFor:Ju(Yu),editSaveButton:`.tox-button:contains(${Bu.tc_edit_buttons_save})`,replyCommentButton:`.tox-button:contains(${Bu.tc_reply_buttons_comment})`,cancelButton:`.tox-button:contains(${Bu.tc_edit_buttons_cancel})`,clearButton:`.tox-button:contains(${Bu.tc_reply_buttons_clear})`,deleteButton:`.tox-button:contains(${Bu.tc_delete_buttons_proceed})`,resolveButton:`.tox-button:contains(${Bu.tc_resolve_buttons_proceed})`,commentText:[Qu(Gu),Qu($u),Qu(Hu),"textarea"].join(" "),editActions:Qu(zu),cardOverlay:Qu(Wu),cardOverlayText:Qu(Lu),cardOverlayButtons:Qu(Uu),replyTextarea:`.${Vu} textarea`,editTextarea:[Qu(Hu),"textarea"].join(" "),kebabMenu:Qu("tox-menu"),textarea:Qu(Iu)},Zu={kebabOpen:`${Du}--open`,bodyExpanded:"tox-comment__body--expanded",bodyNotAnimating:"tox-comment__body--pending",disappearing:"tox-comment--disappearing",commentThreadOverlay:"tox-comment-thread__overlay",bodyHasGradient:"tox-comment__gradient",editingTextarea:Iu},ed={conversationsTitle:["tox-conversations__title"],conversationsHead:["tox-conversations__header"],showMoreLessContainer:["tox-comment__expander"],outerContainer:[Gu],date:["tox-comment__date"],replySection:[Vu],replyTextarea:[Iu],textarea:[],editTextarea:[],kebab:["tox-button--naked",Du,ju,"tox-button--icon"],kebabIcon:["tox-icon"],card:[Hu],cardHead:["tox-comment__header"],cardHeadMeta:["tox-comment__meta"],cardBody:[Pu],cardOverlay:[Wu],cardOverlayText:[Lu],cardOverlayButtons:[Uu],button:[ju],secondaryButton:[ju,"tox-button--secondary"],editActions:[zu],outerScroll:[$u],commentList:["tox-comment-thread"],avatar:["tox-user__avatar"],username:["tox-user__name"],user:["tox-user"],showMoreLess:[],kebabItem:[qu],kebabItemLabel:["tox-collection__item-label"],kebabDisabledItem:["tox-collection__item--state-disabled"],kebabMenu:["tox-menu","tox-collection","tox-collection--list"],kebabMenuGroup:["tox-collection__group"],roots:[Gu]},td={kebab:{backgroundMenu:"tox-menu--background",selectedMenu:"tox-menu--active",menu:"tox-menu",item:qu,selectedItem:"tox-collection__item--active"}},nd=["#2DC26B","#F1C40F","#E03E2D","#B96AD9","#3598DB","#169179","#E67E23","#BA372A","#843FA1","#236FA1","#95A5A6","#7E8C8D","#34495E"],od=(e,t)=>E.from(t.authorAvatar).orThunk((()=>e.lookup(t.author))).getOrThunk((()=>{const n=((e,t,n=36)=>{const o=n/2;return`<svg height="${n}" width="${n}" xmlns="http://www.w3.org/2000/svg"><circle cx="${o}" cy="${o}" r="${o}" fill="${t}"/><text x="50%" y="50%" text-anchor="middle" dominant-baseline="central" fill="#FFF" font-family="sans-serif" font-size="${o}">`+(e=>(new Nu).splitGraphemes(e)[0])(e)+"</text></svg>"})(t.authorName,(()=>{const e=Math.floor(Math.random()*nd.length);return nd[e]})()),o="data:image/svg+xml,"+encodeURIComponent(n);return e.store(t.author,o),o}));var rd=Object.freeze({__proto__:null,getCurrent:(e,t,n)=>t.find(e)});const sd=[Zt("find")],ad=Or({fields:sd,name:"composing",apis:rd}),id=(e,t)=>{t.ignore||(Tr(e.element),t.onFocus(e))};var cd=Object.freeze({__proto__:null,focus:id,blur:(e,t)=>{t.ignore||(e=>{e.dom.blur()})(e.element)},isFocused:e=>(e=>{const t=Ce(e).dom;return e.dom===t.activeElement})(e.element)}),ld=Object.freeze({__proto__:null,exhibit:(e,t)=>{const n=t.ignore?{}:{attributes:{tabindex:"-1"}};return fr(n)},events:e=>tr([or(Fo(),((t,n)=>{id(t,e),n.stop()}))].concat(e.stopMousedown?[or(wo(),((e,t)=>{t.event.prevent()}))]:[]))}),ud=[Ua("onFocus"),cn("stopMousedown",!1),cn("ignore",!1)];const dd=Or({fields:ud,name:"focusing",active:ld,apis:cd}),md=(e,t,n)=>{t.store.manager.onLoad(e,t,n)},gd=(e,t,n)=>{t.store.manager.onUnload(e,t,n)};var pd=Object.freeze({__proto__:null,onLoad:md,onUnload:gd,setValue:(e,t,n,o)=>{t.store.manager.setValue(e,t,n,o)},getValue:(e,t,n)=>t.store.manager.getValue(e,t,n),getState:(e,t,n)=>n}),hd=Object.freeze({__proto__:null,events:(e,t)=>{const n=e.resetOnDom?[cr(((n,o)=>{md(n,e,t)})),lr(((n,o)=>{gd(n,e,t)}))]:[br(e,t,md)];return tr(n)}});const vd=()=>{const e=vn(null);return An({set:e.set,get:e.get,isNotSet:()=>null===e.get(),clear:()=>{e.set(null)},readState:()=>({mode:"memory",value:e.get()})})},fd=()=>{const e=vn({}),t=vn({});return An({readState:()=>({mode:"dataset",dataByValue:e.get(),dataByText:t.get()}),lookup:n=>ze(e.get(),n).orThunk((()=>ze(t.get(),n))),update:n=>{const o=e.get(),r=t.get(),s={},a={};j(n,(e=>{s[e.value]=e,ze(e,"meta").each((t=>{ze(t,"text").each((t=>{a[t]=e}))}))})),e.set({...o,...s}),t.set({...r,...a})},clear:()=>{e.set({}),t.set({})}})};var bd=Object.freeze({__proto__:null,memory:vd,dataset:fd,manual:()=>An({readState:p}),init:e=>e.store.manager.state(e)});const yd=(e,t,n,o)=>{const r=t.store;n.update([o]),r.setValue(e,o),t.onSetValue(e,o)};var _d=[on("initialValue"),Zt("getFallbackEntry"),Zt("getDataKey"),Zt("setValue"),qa("manager",{setValue:yd,getValue:(e,t,n)=>{const o=t.store,r=o.getDataKey(e);return n.lookup(r).getOrThunk((()=>o.getFallbackEntry(r)))},onLoad:(e,t,n)=>{t.store.initialValue.each((o=>{yd(e,t,n,o)}))},onUnload:(e,t,n)=>{n.clear()},state:fd})],xd=[Zt("getValue"),cn("setValue",p),on("initialValue"),qa("manager",{setValue:(e,t,n,o)=>{t.store.setValue(e,o),t.onSetValue(e,o)},getValue:(e,t,n)=>t.store.getValue(e),onLoad:(e,t,n)=>{t.store.initialValue.each((n=>{t.store.setValue(e,n)}))},onUnload:p,state:Tn.init})],wd=[on("initialValue"),qa("manager",{setValue:(e,t,n,o)=>{n.set(o),t.onSetValue(e,o)},getValue:(e,t,n)=>n.get(),onLoad:(e,t,n)=>{t.store.initialValue.each((e=>{n.isNotSet()&&n.set(e)}))},onUnload:(e,t,n)=>{n.clear()},state:vd})],Od=[ln("store",{mode:"memory"},Qt("mode",{memory:wd,manual:xd,dataset:_d})),Ua("onSetValue"),cn("resetOnDom",!1)];const Sd=Or({fields:Od,name:"representing",active:hd,apis:pd,extra:{setValueFrom:(e,t)=>{const n=Sd.getValue(t);Sd.setValue(e,n)}},state:bd});var Cd=Object.freeze({__proto__:null,exhibit:(e,t)=>fr({attributes:Nn([{key:t.tabAttr,value:"true"}])})}),Ed=[cn("tabAttr","data-alloy-tabstop")];const kd=Or({fields:Ed,name:"tabstopping",active:Cd}),Td=(e,t,n,o)=>ze(t.routes,o.start).bind((e=>ze(e,o.destination))),Ad=(e,t,n,o)=>Td(0,t,0,o).bind((e=>e.transition.map((t=>({transition:t,route:e}))))),Md=(e,t,n)=>{((e,t,n)=>Rd(e,t).bind((e=>Ad(0,t,0,e))))(e,t).each((n=>{const o=n.transition;ta(e.element,o.transitionClass),Ur(e.element,t.destinationAttr)}))},Rd=(e,t,n)=>{const o=e.element;return Wr(o,t.destinationAttr).map((n=>({start:Vr(e.element,t.stateAttr),destination:n})))},Nd=(e,t,n,o)=>{Md(e,t),Lr(e.element,t.stateAttr)&&Vr(e.element,t.stateAttr)!==o&&t.onFinish(e,o),Pr(e.element,t.stateAttr,o)};var Fd=Object.freeze({__proto__:null,findRoute:Td,disableTransition:Md,getCurrentRoute:Rd,jumpTo:Nd,progressTo:(e,t,n,o)=>{((e,t,n,o)=>{Lr(e.element,t.destinationAttr)&&(Wr(e.element,t.destinationAttr).each((n=>{Pr(e.element,t.stateAttr,n)})),Ur(e.element,t.destinationAttr))})(e,t);const r=((e,t,n,o)=>({start:Vr(e.element,t.stateAttr),destination:o}))(e,t,0,o);Ad(0,t,0,r).fold((()=>{Nd(e,t,0,o)}),(n=>{Md(e,t);const r=n.transition;ea(e.element,r.transitionClass),Pr(e.element,t.destinationAttr,o)}))},getState:(e,t,n)=>Wr(e.element,t.stateAttr)}),Bd=Object.freeze({__proto__:null,events:(e,t)=>tr([or(Ao(),((t,n)=>{const o=n.event.raw;Rd(t,e).each((n=>{Td(0,e,0,n).each((r=>{r.transition.each((r=>{o.propertyName===r.property&&(Nd(t,e,0,n.destination),e.onTransition(t,n))}))}))}))})),cr(((t,n)=>{Nd(t,e,0,e.initialState)}))])}),Dd=[cn("destinationAttr","data-transitioning-destination"),cn("stateAttr","data-transitioning-state"),Zt("initialState"),Ua("onTransition"),Ua("onFinish"),en("routes",$t(ot.value,$t(ot.value,Bt([an("transition",[Zt("property"),Zt("transitionClass")])]))))];const Hd=Or({fields:Dd,name:"transitioning",active:Bd,apis:Fd,extra:{createRoutes:e=>{const t={};return He(e,((e,n)=>{const o=n.split("<->");t[o[0]]=Rn(o[1],e),t[o[1]]=Rn(o[0],e)})),t},createBistate:(e,t,n)=>Nn([{key:e,value:Rn(t,n)},{key:t,value:Rn(e,n)}]),createTristate:(e,t,n,o)=>Nn([{key:e,value:Nn([{key:t,value:o},{key:n,value:o}])},{key:t,value:Nn([{key:e,value:o},{key:n,value:o}])},{key:n,value:Nn([{key:e,value:o},{key:t,value:o}])}])}}),Pd=(e,t,n,o)=>{const r=n.get();n.set(o),((e,t,n)=>{t.toggleClass.each((t=>{n.get()?ea(e.element,t):ta(e.element,t)}))})(e,t,n),((e,t,n)=>{const o=t.aria;o.update(e,o,n.get())})(e,t,n),r!==o&&t.onToggled(e,o)},Id=(e,t,n)=>{Pd(e,t,n,!n.get())},Vd=(e,t,n)=>{Pd(e,t,n,t.selected)};var Wd=Object.freeze({__proto__:null,onLoad:Vd,toggle:Id,isOn:(e,t,n)=>n.get(),on:(e,t,n)=>{Pd(e,t,n,!0)},off:(e,t,n)=>{Pd(e,t,n,!1)},set:Pd}),Ld=Object.freeze({__proto__:null,exhibit:()=>fr({}),events:(e,t)=>{const n=(o=e,r=t,s=Id,dr((e=>{s(e,o,r)})));var o,r,s;const a=br(e,t,Vd);return tr(Y([e.toggleOnExecute?[n]:[],[a]]))}});const Ud=(e,t,n)=>{Pr(e.element,"aria-expanded",n)};var jd=[cn("selected",!1),on("toggleClass"),cn("toggleOnExecute",!0),Ua("onToggled"),ln("aria",{mode:"none"},Qt("mode",{pressed:[cn("syncWithExpanded",!1),qa("update",((e,t,n)=>{Pr(e.element,"aria-pressed",n),t.syncWithExpanded&&Ud(e,0,n)}))],checked:[qa("update",((e,t,n)=>{Pr(e.element,"aria-checked",n)}))],expanded:[qa("update",Ud)],selected:[qa("update",((e,t,n)=>{Pr(e.element,"aria-selected",n)}))],none:[qa("update",p)]}))];const zd=Or({fields:jd,name:"toggling",active:Ld,apis:Wd,state:(!1,{init:()=>{const e=vn(false);return{get:()=>e.get(),set:t=>e.set(t),clear:()=>e.set(false),readState:()=>e.get()}}})});const $d=()=>{const e=(e,t)=>{t.stop(),Xo(e)};return[or(ko(),e),or(Vo(),e),sr(yo()),sr(wo())]},qd=e=>tr(Y([e.map((e=>dr(((t,n)=>{e(t),n.stop()})))).toArray(),$d()])),Gd=(e,t,n)=>{const o=X(e.slice(0,t)),r=X(e.slice(t+1));return G(o.concat(r),n)},Kd=(e,t,n)=>{const o=X(e.slice(0,t));return G(o,n)},Yd=(e,t,n)=>{const o=e.slice(0,t),r=e.slice(t+1);return G(r.concat(o),n)},Qd=(e,t,n)=>{const o=e.slice(t+1);return G(o,n)},Jd=e=>t=>{const n=t.raw;return W(e,n.which)},Xd=e=>t=>J(e,(e=>e(t))),Zd=e=>!0===e.raw.shiftKey,em=e=>!0===e.raw.ctrlKey,tm=(nm=Zd,e=>!nm(e));var nm;const om=(e,t)=>({matches:e,classification:t}),rm=(e,t,n,o)=>{const r=lt(e.element,"."+t.highlightClass);j(r,(n=>{L(o,(e=>e.element===n))||(ta(n,t.highlightClass),e.getSystem().getByDom(n).each((n=>{t.onDehighlight(e,n),Qo(n,Yo())})))}))},sm=(e,t,n,o)=>{rm(e,t,0,[o]),am(e,t,n,o)||(ea(o.element,t.highlightClass),t.onHighlight(e,o),Qo(o,Ko()))},am=(e,t,n,o)=>na(o.element,t.highlightClass),im=(e,t,n)=>rs(e.element,"."+t.itemClass).bind((t=>e.getSystem().getByDom(t).toOptional())),cm=(e,t,n)=>{const o=lt(e.element,"."+t.itemClass);return(o.length>0?E.some(o[o.length-1]):E.none()).bind((t=>e.getSystem().getByDom(t).toOptional()))},lm=(e,t,n,o)=>{const r=lt(e.element,"."+t.itemClass);return K(r,(e=>na(e,t.highlightClass))).bind((t=>{const n=Nc(t,o,0,r.length-1);return e.getSystem().getByDom(r[n]).toOptional()}))},um=(e,t,n)=>{const o=lt(e.element,"."+t.itemClass);return gr(U(o,(t=>e.getSystem().getByDom(t).toOptional())))};var dm=Object.freeze({__proto__:null,dehighlightAll:(e,t,n)=>rm(e,t,0,[]),dehighlight:(e,t,n,o)=>{am(e,t,n,o)&&(ta(o.element,t.highlightClass),t.onDehighlight(e,o),Qo(o,Yo()))},highlight:sm,highlightFirst:(e,t,n)=>{im(e,t).each((o=>{sm(e,t,n,o)}))},highlightLast:(e,t,n)=>{cm(e,t).each((o=>{sm(e,t,n,o)}))},highlightAt:(e,t,n,o)=>{((e,t,n,o)=>{const r=lt(e.element,"."+t.itemClass);return E.from(r[o]).fold((()=>ot.error(new Error("No element found with index "+o))),e.getSystem().getByDom)})(e,t,0,o).fold((e=>{throw e}),(o=>{sm(e,t,n,o)}))},highlightBy:(e,t,n,o)=>{const r=um(e,t);G(r,o).each((o=>{sm(e,t,n,o)}))},isHighlighted:am,getHighlighted:(e,t,n)=>rs(e.element,"."+t.highlightClass).bind((t=>e.getSystem().getByDom(t).toOptional())),getFirst:im,getLast:cm,getPrevious:(e,t,n)=>lm(e,t,0,-1),getNext:(e,t,n)=>lm(e,t,0,1),getCandidates:um}),mm=[Zt("highlightClass"),Zt("itemClass"),Ua("onHighlight"),Ua("onDehighlight")];const gm=Or({fields:mm,name:"highlighting",apis:dm}),pm=(e,t,n)=>{t.exists((e=>n.exists((t=>ie(t,e)))))||Jo(e,Go(),{prevFocus:t,newFocus:n})},hm=()=>{const e=e=>Mr(e.element);return{get:e,set:(t,n)=>{const o=e(t);t.getSystem().triggerFocus(n,t.element);const r=e(t);pm(t,o,r)}}},vm=()=>{const e=e=>gm.getHighlighted(e).map((e=>e.element));return{get:e,set:(t,n)=>{const o=e(t);t.getSystem().getByDom(n).fold(p,(e=>{gm.highlight(t,e)}));const r=e(t);pm(t,o,r)}}};var fm;!function(e){e.OnFocusMode="onFocus",e.OnEnterOrSpaceMode="onEnterOrSpace",e.OnApiMode="onApi"}(fm||(fm={}));const bm=(e,t,n,o,r)=>{const s=(e,t,n,o,r)=>((e,t)=>{const n=G(e,(e=>e.matches(t)));return n.map((e=>e.classification))})(n(e,t,o,r),t.event).bind((n=>n(e,t,o,r))),a={schema:()=>e.concat([cn("focusManager",hm()),ln("focusInside","onFocus",zt((e=>W(["onFocus","onEnterOrSpace","onApi"],e)?ot.value(e):ot.error("Invalid value for focusInside")))),qa("handler",a),qa("state",t),qa("sendFocusIn",r)]),processKey:s,toEvents:(e,t)=>{const a=e.focusInside!==fm.OnFocusMode?E.none():r(e).map((n=>or(Fo(),((o,r)=>{n(o,e,t),r.stop()})))),i=[or(So(),((o,a)=>{s(o,a,n,e,t).fold((()=>{((n,o)=>{const s=Jd(us.concat(cs))(o.event);e.focusInside===fm.OnEnterOrSpaceMode&&s&&Bn(n,o)&&r(e).each((r=>{r(n,e,t),o.stop()}))})(o,a)}),(e=>{a.stop()}))})),or(Co(),((n,r)=>{s(n,r,o,e,t).each((e=>{r.stop()}))}))];return tr(a.toArray().concat(i))}};return a},ym=e=>{const t=[on("onEscape"),on("onEnter"),cn("selector",'[data-alloy-tabstop="true"]:not(:disabled)'),cn("firstTabstop",0),cn("useTabstopAt",O),on("visibilitySelector")].concat([e]),n=(e,t)=>{const n=e.visibilitySelector.bind((e=>ss(t,e))).getOr(t);return Zi(n)>0},o=(e,t,o)=>{((e,t)=>{const o=lt(e.element,t.selector),r=z(o,(e=>n(t,e)));return E.from(r[t.firstTabstop])})(e,t).each((n=>{t.focusManager.set(e,n)}))},r=(e,t,o,r)=>{const s=lt(e.element,o.selector);return((e,t)=>t.focusManager.get(e).bind((e=>ss(e,t.selector))))(e,o).bind((t=>K(s,y(ie,t)).bind((t=>((e,t,o,r,s)=>s(t,o,(e=>((e,t)=>n(e,t)&&e.useTabstopAt(t))(r,e))).fold((()=>r.cyclic?E.some(!0):E.none()),(t=>(r.focusManager.set(e,t),E.some(!0)))))(e,s,t,o,r)))))},s=v([om(Xd([Zd,Jd(is)]),((e,t,n)=>{const o=n.cyclic?Gd:Kd;return r(e,0,n,o)})),om(Jd(is),((e,t,n)=>{const o=n.cyclic?Yd:Qd;return r(e,0,n,o)})),om(Xd([tm,Jd(cs)]),((e,t,n)=>n.onEnter.bind((n=>n(e,t)))))]),a=v([om(Jd(ls),((e,t,n)=>n.onEscape.bind((n=>n(e,t)))))]);return bm(t,Tn.init,s,a,(()=>E.some(o)))};var _m=ym(Xt("cyclic",w)),xm=ym(Xt("cyclic",O));const wm=e=>pe("input")(e)&&"radio"!==Vr(e,"type")||pe("textarea")(e),Om=(e,t,n)=>wm(n)&&Jd(us)(t.event)?E.none():((e,t,n)=>(Zo(e,n,Po()),E.some(!0)))(e,0,n),Sm=(e,t)=>E.some(!0),Cm=[cn("execute",Om),cn("useSpace",!1),cn("useEnter",!0),cn("useControlEnter",!1),cn("useDown",!1)],Em=(e,t,n)=>n.execute(e,t,e.element);var km=bm(Cm,Tn.init,((e,t,n,o)=>{const r=n.useSpace&&!wm(e.element)?us:[],s=n.useEnter?cs:[],a=n.useDown?ps:[],i=r.concat(s).concat(a);return[om(Jd(i),Em)].concat(n.useControlEnter?[om(Xd([em,Jd(cs)]),Em)]:[])}),((e,t,n,o)=>n.useSpace&&!wm(e.element)?[om(Jd(us),Sm)]:[]),(()=>E.none()));const Tm=()=>{const e=Zr();return An({readState:()=>e.get().map((e=>({numRows:String(e.numRows),numColumns:String(e.numColumns)}))).getOr({numRows:"?",numColumns:"?"}),setGridSize:(t,n)=>{e.set({numRows:t,numColumns:n})},getNumRows:()=>e.get().map((e=>e.numRows)),getNumColumns:()=>e.get().map((e=>e.numColumns))})};var Am=Object.freeze({__proto__:null,flatgrid:Tm,init:e=>e.state(e)});const Mm=e=>(t,n,o,r)=>{const s=e(t.element);return Bm(s,t,n,o,r)},Rm=(e,t)=>{const n=pl(e,t);return Mm(n)},Nm=(e,t)=>{const n=pl(t,e);return Mm(n)},Fm=e=>(t,n,o,r)=>Bm(e,t,n,o,r),Bm=(e,t,n,o,r)=>o.focusManager.get(t).bind((n=>e(t.element,n,o,r))).map((e=>(o.focusManager.set(t,e),!0))),Dm=Fm,Hm=Fm,Pm=Fm,Im=(e,t,n)=>{const o=lt(e,n);return((e,n)=>K(e,(e=>ie(e,t))).map((t=>({index:t,candidates:e}))))(z(o,Au))},Vm=(e,t)=>K(e,(e=>ie(t,e))),Wm=(e,t,n,o)=>o(Math.floor(t/n),t%n).bind((t=>{const o=t.row*n+t.column;return o>=0&&o<e.length?E.some(e[o]):E.none()})),Lm=(e,t,n,o,r)=>Wm(e,t,o,((t,s)=>{const a=t===n-1?e.length-t*o:o,i=Nc(s,r,0,a-1);return E.some({row:t,column:i})})),Um=(e,t,n,o,r)=>Wm(e,t,o,((t,s)=>{const a=Nc(t,r,0,n-1),i=a===n-1?e.length-a*o:o,c=Fc(s,0,i-1);return E.some({row:a,column:c})})),jm=[Zt("selector"),cn("execute",Om),ja("onEscape"),cn("captureTab",!1),Ka()],zm=(e,t,n)=>{rs(e.element,t.selector).each((n=>{t.focusManager.set(e,n)}))},$m=e=>(t,n,o,r)=>Im(t,n,o.selector).bind((t=>e(t.candidates,t.index,r.getNumRows().getOr(o.initSize.numRows),r.getNumColumns().getOr(o.initSize.numColumns)))),qm=(e,t,n)=>n.captureTab?E.some(!0):E.none(),Gm=$m(((e,t,n,o)=>Lm(e,t,n,o,-1))),Km=$m(((e,t,n,o)=>Lm(e,t,n,o,1))),Ym=$m(((e,t,n,o)=>Um(e,t,n,o,-1))),Qm=$m(((e,t,n,o)=>Um(e,t,n,o,1))),Jm=v([om(Jd(ds),Rm(Gm,Km)),om(Jd(gs),Nm(Gm,Km)),om(Jd(ms),Dm(Ym)),om(Jd(ps),Hm(Qm)),om(Xd([Zd,Jd(is)]),qm),om(Xd([tm,Jd(is)]),qm),om(Jd(us.concat(cs)),((e,t,n,o)=>((e,t)=>t.focusManager.get(e).bind((e=>ss(e,t.selector))))(e,n).bind((o=>n.execute(e,t,o)))))]),Xm=v([om(Jd(ls),((e,t,n)=>n.onEscape(e,t))),om(Jd(us),Sm)]);var Zm=bm(jm,Tm,Jm,Xm,(()=>E.some(zm)));const eg=(e,t,n,o)=>{const r=(e,t,n)=>{const s=Nc(t,o,0,n.length-1);return s===e?E.none():(a=n[s],"button"===ce(a)&&"disabled"===Vr(a,"disabled")?r(e,s,n):E.from(n[s]));var a};return Im(e,n,t).bind((e=>{const t=e.index,n=e.candidates;return r(t,t,n)}))},tg=[Zt("selector"),cn("getInitial",E.none),cn("execute",Om),ja("onEscape"),cn("executeOnMove",!1),cn("allowVertical",!0)],ng=(e,t,n)=>((e,t)=>t.focusManager.get(e).bind((e=>ss(e,t.selector))))(e,n).bind((o=>n.execute(e,t,o))),og=(e,t,n)=>{t.getInitial(e).orThunk((()=>rs(e.element,t.selector))).each((n=>{t.focusManager.set(e,n)}))},rg=(e,t,n)=>eg(e,n.selector,t,-1),sg=(e,t,n)=>eg(e,n.selector,t,1),ag=e=>(t,n,o,r)=>e(t,n,o,r).bind((()=>o.executeOnMove?ng(t,n,o):E.some(!0))),ig=v([om(Jd(us),Sm),om(Jd(ls),((e,t,n)=>n.onEscape(e,t)))]);var cg=bm(tg,Tn.init,((e,t,n,o)=>{const r=ds.concat(n.allowVertical?ms:[]),s=gs.concat(n.allowVertical?ps:[]);return[om(Jd(r),ag(Rm(rg,sg))),om(Jd(s),ag(Nm(rg,sg))),om(Jd(cs),ng),om(Jd(us),ng)]}),ig,(()=>E.some(og)));const lg=(e,t,n)=>E.from(e[t]).bind((e=>E.from(e[n]).map((e=>({rowIndex:t,columnIndex:n,cell:e}))))),ug=(e,t,n,o)=>{const r=e[t].length,s=Nc(n,o,0,r-1);return lg(e,t,s)},dg=(e,t,n,o)=>{const r=Nc(n,o,0,e.length-1),s=e[r].length,a=Fc(t,0,s-1);return lg(e,r,a)},mg=(e,t,n,o)=>{const r=e[t].length,s=Fc(n+o,0,r-1);return lg(e,t,s)},gg=(e,t,n,o)=>{const r=Fc(n+o,0,e.length-1),s=e[r].length,a=Fc(t,0,s-1);return lg(e,r,a)},pg=[nn("selectors",[Zt("row"),Zt("cell")]),cn("cycles",!0),cn("previousSelector",E.none),cn("execute",Om)],hg=(e,t,n)=>{const o=t.previousSelector(e).orThunk((()=>{const n=t.selectors;return rs(e.element,n.cell)}));o.each((n=>{t.focusManager.set(e,n)}))},vg=(e,t)=>(n,o,r)=>{const s=r.cycles?e:t;return ss(o,r.selectors.row).bind((e=>{const t=lt(e,r.selectors.cell);return Vm(t,o).bind((t=>{const o=lt(n,r.selectors.row);return Vm(o,e).bind((e=>{const n=((e,t)=>U(e,(e=>lt(e,t.selectors.cell))))(o,r);return s(n,e,t).map((e=>e.cell))}))}))}))},fg=vg(((e,t,n)=>ug(e,t,n,-1)),((e,t,n)=>mg(e,t,n,-1))),bg=vg(((e,t,n)=>ug(e,t,n,1)),((e,t,n)=>mg(e,t,n,1))),yg=vg(((e,t,n)=>dg(e,n,t,-1)),((e,t,n)=>gg(e,n,t,-1))),_g=vg(((e,t,n)=>dg(e,n,t,1)),((e,t,n)=>gg(e,n,t,1))),xg=v([om(Jd(ds),Rm(fg,bg)),om(Jd(gs),Nm(fg,bg)),om(Jd(ms),Dm(yg)),om(Jd(ps),Hm(_g)),om(Jd(us.concat(cs)),((e,t,n)=>Mr(e.element).bind((o=>n.execute(e,t,o)))))]),wg=v([om(Jd(us),Sm)]);var Og=bm(pg,Tn.init,xg,wg,(()=>E.some(hg)));const Sg=[Zt("selector"),cn("execute",Om),cn("moveOnTab",!1)],Cg=(e,t,n)=>n.focusManager.get(e).bind((o=>n.execute(e,t,o))),Eg=(e,t,n)=>{rs(e.element,t.selector).each((n=>{t.focusManager.set(e,n)}))},kg=(e,t,n)=>eg(e,n.selector,t,-1),Tg=(e,t,n)=>eg(e,n.selector,t,1),Ag=v([om(Jd(ms),Pm(kg)),om(Jd(ps),Pm(Tg)),om(Xd([Zd,Jd(is)]),((e,t,n,o)=>n.moveOnTab?Pm(kg)(e,t,n,o):E.none())),om(Xd([tm,Jd(is)]),((e,t,n,o)=>n.moveOnTab?Pm(Tg)(e,t,n,o):E.none())),om(Jd(cs),Cg),om(Jd(us),Cg)]),Mg=v([om(Jd(us),Sm)]);var Rg=bm(Sg,Tn.init,Ag,Mg,(()=>E.some(Eg)));const Ng=[ja("onSpace"),ja("onEnter"),ja("onShiftEnter"),ja("onLeft"),ja("onRight"),ja("onTab"),ja("onShiftTab"),ja("onUp"),ja("onDown"),ja("onEscape"),cn("stopSpaceKeyup",!1),on("focusIn")];var Fg=bm(Ng,Tn.init,((e,t,n)=>[om(Jd(us),n.onSpace),om(Xd([tm,Jd(cs)]),n.onEnter),om(Xd([Zd,Jd(cs)]),n.onShiftEnter),om(Xd([Zd,Jd(is)]),n.onShiftTab),om(Xd([tm,Jd(is)]),n.onTab),om(Jd(ms),n.onUp),om(Jd(ps),n.onDown),om(Jd(ds),n.onLeft),om(Jd(gs),n.onRight),om(Jd(us),n.onSpace)]),((e,t,n)=>[...n.stopSpaceKeyup?[om(Jd(us),Sm)]:[],om(Jd(ls),n.onEscape)]),(e=>e.focusIn));const Bg=_m.schema(),Dg=xm.schema(),Hg=cg.schema(),Pg=Zm.schema(),Ig=Og.schema(),Vg=km.schema(),Wg=Rg.schema(),Lg=Fg.schema(),Ug=(e=>{const t=Kt("Creating behaviour: "+e.name,Sr,e);return((e,t,n,o,r,s)=>{const a=e,i=sn(t,[rn("config",e)]);return _r(a,i,t,n,o,r,s)})(Qt(t.branchKey,t.branches),t.name,t.active,t.apis,t.extra,t.state)})({branchKey:"mode",branches:Object.freeze({__proto__:null,acyclic:Bg,cyclic:Dg,flow:Hg,flatgrid:Pg,matrix:Ig,execution:Vg,menu:Wg,special:Lg}),name:"keying",active:{events:(e,t)=>e.handler.toEvents(e,t)},apis:{focusIn:(e,t,n)=>{t.sendFocusIn(t).fold((()=>{e.getSystem().triggerFocus(e.element,e.element)}),(o=>{o(e,t,n)}))},setGridSize:(e,t,n,o,r)=>{(e=>qe(e,"setGridSize"))(n)?n.setGridSize(o,r):console.error("Layout does not support setGridSize")}},state:Am}),jg=Mi({name:"Button",factory:e=>{const t=qd(e.action),n=e.dom.tag,o=t=>ze(e.dom,"attributes").bind((e=>ze(e,t)));return{uid:e.uid,dom:e.dom,components:e.components,events:t,behaviours:Ba(e.buttonBehaviours,[dd.config({}),Ug.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:"button"===n?{type:o("type").getOr("button"),...o("role").map((e=>({role:e}))).getOr({})}:{role:o("role").getOr("button")}},eventOrder:e.eventOrder}},configFields:[cn("uid",void 0),Zt("dom"),cn("components",[]),Fa("buttonBehaviours",[dd,Ug]),on("action"),on("role"),cn("eventOrder",{})]}),zg=["input","button","textarea","select"],$g=(e,t,n)=>{(t.disabled()?Jg:Xg)(e,t)},qg=(e,t)=>!0===t.useNative&&W(zg,ce(e.element)),Gg=e=>{Pr(e.element,"disabled","disabled")},Kg=e=>{Ur(e.element,"disabled")},Yg=e=>{Pr(e.element,"aria-disabled","true")},Qg=e=>{Pr(e.element,"aria-disabled","false")},Jg=(e,t,n)=>{t.disableClass.each((t=>{ea(e.element,t)})),(qg(e,t)?Gg:Yg)(e),t.onDisabled(e)},Xg=(e,t,n)=>{t.disableClass.each((t=>{ta(e.element,t)})),(qg(e,t)?Kg:Qg)(e),t.onEnabled(e)},Zg=(e,t)=>qg(e,t)?(e=>Lr(e.element,"disabled"))(e):(e=>"true"===Vr(e.element,"aria-disabled"))(e);var ep=Object.freeze({__proto__:null,enable:Xg,disable:Jg,isDisabled:Zg,onLoad:$g,set:(e,t,n,o)=>{(o?Jg:Xg)(e,t)}}),tp=Object.freeze({__proto__:null,exhibit:(e,t)=>fr({classes:t.disabled()?t.disableClass.toArray():[]}),events:(e,t)=>tr([nr(Po(),((t,n)=>Zg(t,e))),br(e,t,$g)])}),np=[((e,t)=>ln("disabled",t,Ut))(0,w),cn("useNative",!0),on("disableClass"),Ua("onDisabled"),Ua("onEnabled")];const op=Or({fields:np,name:"disabling",active:tp,apis:ep});var rp=Object.freeze({__proto__:null,events:e=>tr([or(Ho(),((t,n)=>{const o=e.channels,r=Be(o),s=n,a=((e,t)=>t.universal?e:z(e,(e=>W(t.channels,e))))(r,s);j(a,(e=>{const n=o[e],r=n.schema,a=Kt("channel["+e+"] data\nReceiver: "+zr(t.element),r,s.data);n.onReceive(t,a)}))}))])}),sp=[en("channels",$t(ot.value,Bt([za("onReceive"),cn("schema",It())])))];const ap=Or({fields:sp,name:"receiving",active:rp}),ip=e=>{var t;return op.config(null!==(t=e.disablingConfig)&&void 0!==t?t:{})},cp=e=>({[En]:{schema:un,onReceive:(t,n)=>{op.set(t,e(n))}}}),lp=e=>{var t;const n=null!==(t=e.disableWhileSaving)&&void 0!==t&&t;return[ip(e),(o=n?mn:dn,ap.config({channels:cp(o)}))];var o},up=e=>t=>{var n;const o=null!==(n=t.disableWhileSaving)&&void 0!==n&&n,r=t.eventName.map((e=>({action:t=>{Qo(t,e)}}))).getOr({});return jg.sketch({dom:{tag:"button",classes:e,styles:void 0!==t.styles?t.styles:{}},components:[Ca(t.text)],...r,buttonBehaviours:xr([kd.config({}),...lp({disableWhileSaving:o})])})},dp=up(ed.button),mp=up(ed.secondaryButton),gp="tc-save-edit",pp="tc-cancel-edit",hp=Os("tc-patch-comment-state-event"),vp=Os("tc-purge-comment-state-event"),fp=Os("tc-force-patch-state-event");var bp,yp;!function(e){e.None="Prop_None",e.Collapsed="Prop_Collapsed",e.Expanded="Prop_Expanded",e.CollapsedOrNone="Prop_CollapsedOrNone",e.ExpandOrNone="Prop_ExpandOrNone",e.Edit="Prop_Edit"}(bp||(bp={})),function(e){e[e.Before=0]="Before",e[e.QueryingDelete=1]="QueryingDelete",e[e.QueryingResolve=2]="QueryingResolve",e[e.PostDelete=3]="PostDelete",e[e.PostResolve=4]="PostResolve"}(yp||(yp={}));const _p=e=>U(e.conversation,(e=>e.props)),xp=(e,t)=>({...e,targetUid:t}),wp=(e,t)=>({...e,queue:e.queue.concat(t)}),Op=()=>({targetUid:E.none(),conversation:[],queue:[]}),Sp=(e,t)=>n=>{const o=t(n);Jo(n,hp,{uid:e,patch:o})},Cp=(e,t)=>n=>{const o=t(n);Jo(n,hp,{uid:e,patch:o}),Qo(n,fp)},Ep=e=>{Qo(e,fp)},kp=(e,t)=>{ca(e.element,"visibility","hidden"),zd.set(e,!1);const n=e.element.dom.clientHeight;return zd.set(e,!0),pa(e.element,"visibility"),e.element.dom.scrollHeight>n+1?t:bp.None},Tp=e=>{zd.off(e),ea(e.element,Zu.bodyHasGradient)},Ap=e=>{zd.on(e),ta(e.element,Zu.bodyHasGradient)},Mp=e=>xe(e.element),Rp=e=>{ta(e.element,Zu.bodyHasGradient),zd.set(e,!1),Ur(e.element,"aria-expanded")},Np=e=>{Mp(e).each((e=>{Ur(e,"readonly"),ea(e,Zu.editingTextarea),Tr(e);const t=e.dom,n=va(e).length;t.setSelectionRange(n,n)})),e.element.dom.scrollTop=0},Fp=e=>{const t=e=>t=>{j(e,(e=>e(t)))},n=t=>{Mp(t).each((n=>{const o=ga(n,"width");ca(n,"width",nc(n)+"px"),pa(n,"height"),Sd.setValue(t,e.props.content),t.getSystem().triggerEvent(Eo(),n,{}),ua(n,{width:o})}))},o=t=>{return n=t,o=e.memCommands,(e=>{Mp(e).each((e=>{Pr(e,"readonly","true"),ta(e,Zu.editingTextarea)}))})(n),void o.getOpt(n).each((e=>{Tu.remove(n,e)}));var n,o},r={[bp.None]:t([o,n,Rp]),[bp.Expanded]:t([o,n,Ap]),[bp.Collapsed]:t([o,n,Tp]),[bp.ExpandOrNone]:t([o,n,t=>{ea(t.element,Zu.bodyNotAnimating);const n=kp(t,bp.Expanded);Sp(e.props.uid,(()=>({mode:n})))(t)}]),[bp.CollapsedOrNone]:t([o,n,t=>{ea(t.element,Zu.bodyNotAnimating);const n=kp(t,bp.Collapsed);n===bp.Collapsed&&(ea(t.element,Zu.bodyHasGradient),zd.off(t)),ha(t.element),Sp(e.props.uid,(()=>({mode:n})))(t)}]),[bp.Edit]:t([t=>{return n=t,o=e.memCommands,zd.on(n),ta(n.element,Zu.bodyHasGradient),void((e,t)=>{Np(e),t.getOpt(e).fold((()=>{Tu.append(e,t.asSpec())}),p)})(n,o);var n,o},n])};return ze(r,e.props.mode)},Bp=Os("tc-focus-outer-comment"),Dp=Os("tc-start-delete-comment"),Hp=Os("tc-start-delete-conversation"),Pp=Os("tc-start-resolve-conversation"),Ip=Os("tc-commit-delete"),Vp=Os("tc-commit-resolve"),Wp=Os("tc-start-edit-comment"),Lp=Os("tc-commit-edit-comment");Os("tc-cancel-edit-comment"),Os("tc-long-content"),Os("tc-short-content");const Up=Os("tc-toggle-comment"),jp=v([on("data"),cn("inputAttributes",{}),cn("inputStyles",{}),cn("tag","input"),cn("inputClasses",[]),Ua("onSetValue"),cn("styles",{}),cn("eventOrder",{}),Ra("inputBehaviours",[Sd,dd]),cn("selectOnFocus",!0)]),zp=e=>xr([dd.config({onFocus:e.selectOnFocus?e=>{const t=e.element,n=va(t);t.dom.setSelectionRange(0,n.length)}:p})]),$p=e=>({...zp(e),...Na(e.inputBehaviours,[Sd.config({store:{mode:"manual",...e.data.map((e=>({initialValue:e}))).getOr({}),getValue:e=>va(e.element),setValue:(e,t)=>{va(e.element)!==t&&fa(e.element,t)}},onSetValue:e.onSetValue})])}),qp=e=>({tag:e.tag,attributes:{type:"text",...e.inputAttributes},styles:e.inputStyles,classes:e.inputClasses}),Gp=Mi({name:"Input",configFields:jp(),factory:(e,t)=>({uid:e.uid,dom:qp(e),components:[],behaviours:$p(e),eventOrder:e.eventOrder})}),Kp="data-alloy-widget-tabstop",Yp=e=>Ug.config({mode:"cyclic",onEscape:e.onEscape,useTabstopAt:e=>"textarea"!==ce(e)||"true"!==Vr(e,"readonly")}),Qp=e=>Ug.config({mode:"special",onEnter:t=>(Qo(t,e.enterEvent),E.some(!0)),onShiftEnter:(e,t)=>(t.cut(),E.none()),onSpace:(e,t)=>(t.cut(),E.none())}),Jp=e=>Ug.config({mode:"cyclic",selector:`[${Kp}="true"]`,focusInside:fm.OnEnterOrSpaceMode,onEscape:(t,n)=>Bn(t,n)?E.none():(Qo(t,e.escapeEvent),E.some(!0))}),Xp=e=>Ug.config({mode:"flow",allowVertical:!0,selector:e.selector}),Zp={"data-gramm_editor":"false",rows:"2"},eh={"white-space":"pre-wrap"},th=e=>{const t=e.element.dom;pa(e.element,"height"),ha(e.element);const n=t.clientHeight,o=t.scrollHeight;if(o>n){const t=Zi(e.element)-n;ca(e.element,"height",o+t+"px")}},nh=e=>{const t=Zr();return Gp.sketch({tag:"textarea",inputAttributes:{...Zp,readonly:"true"},inputClasses:ed.editTextarea,inputStyles:{...eh,"overflow-y":"hidden",border:"none !important"},data:e,inputBehaviours:xr([Er("textarea-events",[cr((e=>{t.set(nc(e.element)),th(e)})),or(Eo(),th)]),ap.config({channels:{...cp(mn),[kn]:{onReceive:e=>{const n=nc(e.element);t.on((t=>{t!==n&&pa(e.element,"height")})),t.set(n),th(e)}}}}),Qp({enterEvent:Lp}),kd.config({}),ip({})])})},oh=On,rh={[oh.LessThanMinute]:[Bu.tc_date_less_than_a_minute_ago,Bu.tc_date_less_than_a_minute_ago],[oh.Minute]:[Bu.tc_date_1_minute_ago,Bu.tc_date_x_minutes_ago],[oh.Hour]:[Bu.tc_date_1_hour_ago,Bu.tc_date_x_hours_ago],[oh.Day]:[Bu.tc_date_1_day_ago,Bu.tc_date_x_days_ago],[oh.Week]:[Bu.tc_date_1_week_ago,Bu.tc_date_x_weeks_ago],[oh.Month]:[Bu.tc_date_1_month_ago,Bu.tc_date_x_months_ago],[oh.Year]:[Bu.tc_date_1_year_ago,Bu.tc_date_x_years_ago]},sh=(e,t)=>{const n=rh[e.interval],o=1===e.intervalUnits?n[0]:n[1];return t.translate([o,e.intervalUnits])},ah={editCommentEvent:Os("tc-conversation-edit-comment"),deleteCommentEvent:Os("tc-conversation-delete-comment"),deleteConversationEvent:Os("tc-conversation-delete-all"),resolveConversationEvent:Os("tc-conversation-resolve"),createCommentEvent:Os("tc-conversation-create")},ih="aria-controls",ch=(e,t)=>vl(t,(t=>ie(t,e.element)),w)||((e,t)=>(e=>ns(e,(e=>{if(!ue(e))return!1;const t=Vr(e,"id");return void 0!==t&&t.indexOf(ih)>-1})).bind((e=>{const t=Vr(e,"id"),n=Ce(e);return rs(n,`[${ih}="${t}"]`)})))(t).exists((t=>ch(e,t))))(e,t);var lh=Object.freeze({__proto__:null,getCoupled:(e,t,n,o)=>n.getOrCreate(e,t,o)}),uh=[en("others",$t(ot.value,It()))],dh=Object.freeze({__proto__:null,init:()=>{const e={},t=v({});return An({readState:t,getOrCreate:(t,n,o)=>{const r=Be(n.others);if(r)return ze(e,o).getOrThunk((()=>{const r=ze(n.others,o).getOrDie("No information found for coupled component: "+o)(t),s=t.getSystem().build(r);return e[o]=s,s}));throw new Error("Cannot find coupled component: "+o+". Known coupled components: "+JSON.stringify(r,null,2))}})}});const mh=Or({fields:uh,name:"coupling",apis:lh,state:dh}),gh=(e,t,n,o)=>{n.get().each((t=>{Ui(e)}));const r=t.getAttachPoint(e);Ii(r,e);const s=e.getSystem().build(o);return Ii(e,s),n.set(s),s},ph=(e,t,n,o)=>{const r=gh(e,t,n,o);return t.onOpen(e,r),r},hh=(e,t,n)=>{n.get().each((o=>{Ui(e),Li(e),t.onClose(e,o),n.clear()}))},vh=(e,t,n)=>n.isOpen(),fh=(e,t,n)=>{const o=t.getAttachPoint(e);ca(e.element,"position",yu.getMode(o)),((e,t,n,o)=>{ga(e.element,t).fold((()=>{Ur(e.element,n)}),(t=>{Pr(e.element,n,t)})),ca(e.element,t,"hidden")})(e,"visibility",t.cloakVisibilityAttr)},bh=(e,t,n)=>{(e=>L(["top","left","right","bottom"],(t=>ga(e,t).isSome())))(e.element)||pa(e.element,"position"),((e,t,n)=>{Wr(e.element,n).fold((()=>pa(e.element,t)),(n=>ca(e.element,t,n)))})(e,"visibility",t.cloakVisibilityAttr)};var yh=Object.freeze({__proto__:null,cloak:fh,decloak:bh,open:ph,openWhileCloaked:(e,t,n,o,r)=>{fh(e,t),ph(e,t,n,o),r(),bh(e,t)},close:hh,isOpen:vh,isPartOf:(e,t,n,o)=>vh(0,0,n)&&n.get().exists((n=>t.isPartOf(e,n,o))),getState:(e,t,n)=>n.get(),setContent:(e,t,n,o)=>n.get().map((()=>gh(e,t,n,o)))}),_h=Object.freeze({__proto__:null,events:(e,t)=>tr([or(Lo(),((n,o)=>{hh(n,e,t)}))])}),xh=[Ua("onOpen"),Ua("onClose"),Zt("isPartOf"),Zt("getAttachPoint"),cn("cloakVisibilityAttr","data-precloak-visibility")],wh=Object.freeze({__proto__:null,init:()=>{const e=Zr(),t=v("not-implemented");return An({readState:t,isOpen:e.isSet,clear:e.clear,set:e.set,get:e.get})}});const Oh=Or({fields:xh,name:"sandboxing",active:_h,apis:yh,state:wh}),Sh="alloy.item-hover",Ch="alloy.item-focus",Eh="alloy.item-toggled",kh=e=>{(Mr(e.element).isNone()||dd.isFocused(e))&&(dd.isFocused(e)||dd.focus(e),Jo(e,Sh,{item:e}))},Th=e=>{Jo(e,Ch,{item:e})},Ah=v(Sh),Mh=v(Ch),Rh=v(Eh),Nh=e=>e.toggling.map((e=>e.exclusive?"menuitemradio":"menuitemcheckbox")).getOr("menuitem"),Fh=[Zt("data"),Zt("components"),Zt("dom"),cn("hasSubmenu",!1),on("toggling"),Fa("itemBehaviours",[zd,dd,Ug,Sd]),cn("ignoreFocus",!1),cn("domModification",{}),qa("builder",(e=>({dom:e.dom,domModification:{...e.domModification,attributes:{role:Nh(e),...e.domModification.attributes,"aria-haspopup":e.hasSubmenu,...e.hasSubmenu?{"aria-expanded":!1}:{}}},behaviours:Ba(e.itemBehaviours,[e.toggling.fold(zd.revoke,(e=>zd.config((e=>({aria:{mode:"checked"},...Le(e,((e,t)=>"exclusive"!==t)),onToggled:(t,n)=>{m(e.onToggled)&&e.onToggled(t,n),((e,t)=>{Jo(e,Eh,{item:e,state:t})})(t,n)}}))(e)))),dd.config({ignore:e.ignoreFocus,stopMousedown:e.ignoreFocus,onFocus:e=>{Th(e)}}),Ug.config({mode:"execution"}),Sd.config({store:{mode:"memory",initialValue:e.data}}),Er("item-type-events",[...$d(),or(Oo(),kh),or(Io(),dd.focus)])]),components:e.components,eventOrder:e.eventOrder}))),cn("eventOrder",{})],Bh=[Zt("dom"),Zt("components"),qa("builder",(e=>({dom:e.dom,components:e.components,events:tr([ar(Io())])})))],Dh=v("item-widget"),Hh=v([vi({name:"widget",overrides:e=>({behaviours:xr([Sd.config({store:{mode:"manual",getValue:t=>e.data,setValue:p}})])})})]),Ph=[Zt("uid"),Zt("data"),Zt("components"),Zt("dom"),cn("autofocus",!1),cn("ignoreFocus",!1),Fa("widgetBehaviours",[Sd,dd,Ug]),cn("domModification",{}),Ci(Hh()),qa("builder",(e=>{const t=Oi(Dh(),e,Hh()),n=Si(Dh(),e,t.internals()),o=t=>((e,t,n)=>{const o=t.partUids.widget;return e.getSystem().getByUid(o).toOptional()})(t,e).map((e=>(Ug.focusIn(e),e))),r=(t,n)=>wm(n.event.target)?E.none():e.autofocus?(n.setSource(t.element),E.none()):E.none();return{dom:e.dom,components:n,domModification:e.domModification,events:tr([dr(((e,t)=>{o(e).each((e=>{t.stop()}))})),or(Oo(),kh),or(Io(),((t,n)=>{e.autofocus?o(t):dd.focus(t)}))]),behaviours:Ba(e.widgetBehaviours,[Sd.config({store:{mode:"memory",initialValue:e.data}}),dd.config({ignore:e.ignoreFocus,onFocus:e=>{Th(e)}}),Ug.config({mode:"special",focusIn:e.autofocus?e=>{o(e)}:Cr(),onLeft:r,onRight:r,onEscape:(t,n)=>dd.isFocused(t)||e.autofocus?e.autofocus?(n.setSource(t.element),E.none()):E.none():(dd.focus(t),E.some(!0))})])}}))],Ih=Qt("type",{widget:Ph,item:Fh,separator:Bh}),Vh=v([yi({factory:{sketch:e=>{const t=Kt("menu.spec item",Ih,e);return t.builder(t)}},name:"items",unit:"item",defaults:(e,t)=>$e(t,"uid")?t:{...t,uid:Ms("item")},overrides:(e,t)=>({type:t.type,ignoreFocus:e.fakeFocus,domModification:{classes:[e.markers.item]}})})]),Wh=v([Zt("value"),Zt("items"),Zt("dom"),Zt("components"),cn("eventOrder",{}),Ra("menuBehaviours",[gm,Sd,ad,Ug]),ln("movement",{mode:"menu",moveOnTab:!0},Qt("mode",{grid:[Ka(),qa("config",((e,t)=>({mode:"flatgrid",selector:"."+e.markers.item,initSize:{numColumns:t.initSize.numColumns,numRows:t.initSize.numRows},focusManager:e.focusManager})))],matrix:[qa("config",((e,t)=>({mode:"matrix",selectors:{row:t.rowSelector,cell:"."+e.markers.item},focusManager:e.focusManager}))),Zt("rowSelector")],menu:[cn("moveOnTab",!0),qa("config",((e,t)=>({mode:"menu",selector:"."+e.markers.item,moveOnTab:t.moveOnTab,focusManager:e.focusManager})))]})),en("markers",Ia()),cn("fakeFocus",!1),cn("focusManager",hm()),Ua("onHighlight")]),Lh=v("alloy.menu-focus"),Uh=Ri({name:"Menu",configFields:Wh(),partFields:Vh(),factory:(e,t,n,o)=>({uid:e.uid,dom:e.dom,markers:e.markers,behaviours:Na(e.menuBehaviours,[gm.config({highlightClass:e.markers.selectedItem,itemClass:e.markers.item,onHighlight:e.onHighlight}),Sd.config({store:{mode:"memory",initialValue:e.value}}),ad.config({find:E.some}),Ug.config(e.movement.config(e,e.movement))]),events:tr([or(Mh(),((e,t)=>{const n=t.event;e.getSystem().getByDom(n.target).each((n=>{gm.highlight(e,n),t.stop(),Jo(e,Lh(),{menu:e,item:n})}))})),or(Ah(),((e,t)=>{const n=t.event.item;gm.highlight(e,n)})),or(Rh(),((e,t)=>{const{item:n,state:o}=t.event;o&&"menuitemradio"===Vr(n.element,"role")&&((e,t)=>{const n=lt(e.element,'[role="menuitemradio"][aria-checked="true"]');j(n,(n=>{ie(n,t.element)||e.getSystem().getByDom(n).each((e=>{zd.off(e)}))}))})(e,n)}))]),components:t,eventOrder:e.eventOrder,domModification:{attributes:{role:"menu"}}})}),jh=(e,t,n,o)=>ze(n,o).bind((o=>ze(e,o).bind((o=>{const r=jh(e,t,n,o);return E.some([o].concat(r))})))).getOr([]),zh=e=>"prepared"===e.type?E.some(e.menu):E.none(),$h=()=>{const e=vn({}),t=vn({}),n=vn({}),o=Zr(),r=vn({}),s=e=>a(e).bind(zh),a=e=>ze(t.get(),e),i=t=>ze(e.get(),t);return{setMenuBuilt:(e,n)=>{t.set({...t.get(),[e]:{type:"prepared",menu:n}})},setContents:(s,a,i,c)=>{o.set(s),e.set(i),t.set(a),r.set(c);const l=((e,t)=>{const n={};He(e,((e,t)=>{j(e,(e=>{n[e]=t}))}));const o=t,r=Ie(t,((e,t)=>({k:e,v:t}))),s=Pe(r,((e,t)=>[t].concat(jh(n,o,r,t))));return Pe(n,(e=>ze(s,e).getOr([e])))})(c,i);n.set(l)},expand:t=>ze(e.get(),t).map((e=>{const o=ze(n.get(),t).getOr([]);return[e].concat(o)})),refresh:e=>ze(n.get(),e),collapse:e=>ze(n.get(),e).bind((e=>e.length>1?E.some(e.slice(1)):E.none())),lookupMenu:a,lookupItem:i,otherMenus:e=>{const t=r.get();return Z(Be(t),e)},getPrimary:()=>o.get().bind(s),getMenus:()=>t.get(),clear:()=>{e.set({}),t.set({}),n.set({}),o.clear()},isClear:()=>o.get().isNone(),getTriggeringPath:(t,r)=>{const a=z(i(t).toArray(),(e=>s(e).isSome()));return ze(n.get(),t).bind((t=>{const n=X(a.concat(t));return(e=>{const t=[];for(let n=0;n<e.length;n++){const o=e[n];if(!o.isSome())return E.none();t.push(o.getOrDie())}return E.some(t)})(Q(n,((t,a)=>((t,n,o)=>s(t).bind((r=>(t=>je(e.get(),((e,n)=>e===t)))(t).bind((e=>n(e).map((e=>({triggeredMenu:r,triggeringItem:e,triggeringPath:o}))))))))(t,r,n.slice(0,a+1)).fold((()=>mr(o.get(),t)?[]:[E.none()]),(e=>[E.some(e)])))))}))}}},qh=zh,Gh=v("collapse-item"),Kh=Mi({name:"TieredMenu",configFields:[$a("onExecute"),$a("onEscape"),za("onOpenMenu"),za("onOpenSubmenu"),Ua("onRepositionMenu"),Ua("onCollapseMenu"),cn("highlightImmediately",!0),nn("data",[Zt("primary"),Zt("menus"),Zt("expansions")]),cn("fakeFocus",!1),Ua("onHighlight"),Ua("onHover"),Wa(),Zt("dom"),cn("navigateOnHover",!0),cn("stayInDom",!1),Ra("tmenuBehaviours",[Ug,gm,ad,Tu]),cn("eventOrder",{})],apis:{collapseMenu:(e,t)=>{e.collapseMenu(t)},highlightPrimary:(e,t)=>{e.highlightPrimary(t)},repositionMenus:(e,t)=>{e.repositionMenus(t)}},factory:(e,t)=>{const n=Zr(),o=$h(),r=e=>Sd.getValue(e).value,s=t=>Pe(e.data.menus,((e,t)=>Q(e.items,(e=>"separator"===e.type?[]:[e.data.value])))),a=(e,t)=>{gm.highlight(e,t),gm.getHighlighted(t).orThunk((()=>gm.getFirst(t))).each((t=>{Zo(e,t.element,Io())}))},i=(e,t)=>gr(U(t,(t=>e.lookupMenu(t).bind((e=>"prepared"===e.type?E.some(e.menu):E.none()))))),c=(t,n,o)=>{const r=i(n,n.otherMenus(o));j(r,(n=>{ra(n.element,[e.markers.backgroundMenu]),e.stayInDom||Tu.remove(t,n)}))},l=(t,o)=>{const s=(t=>n.get().getOrThunk((()=>{const o={},s=lt(t.element,`.${e.markers.item}`),a=z(s,(e=>"true"===Vr(e,"aria-haspopup")));return j(a,(e=>{t.getSystem().getByDom(e).each((e=>{const t=r(e);o[t]=e}))})),n.set(o),o})))(t);He(s,((e,t)=>{const n=W(o,t);Pr(e.element,"aria-expanded",n)}))},u=(t,n,o)=>E.from(o[0]).bind((r=>n.lookupMenu(r).bind((r=>{if("notbuilt"===r.type)return E.none();{const s=r.menu,l=i(n,o.slice(1));return j(l,(t=>{ea(t.element,e.markers.backgroundMenu)})),ct(s.element)||Tu.append(t,Ma(s)),ra(s.element,[e.markers.backgroundMenu]),a(t,s),c(t,n,o),E.some(s)}}))));let d;!function(e){e[e.HighlightSubmenu=0]="HighlightSubmenu",e[e.HighlightParent=1]="HighlightParent"}(d||(d={}));const m=(t,n,s=d.HighlightSubmenu)=>{if(n.hasConfigured(op)&&op.isDisabled(n))return E.some(n);{const a=r(n);return o.expand(a).bind((r=>(l(t,r),E.from(r[0]).bind((a=>o.lookupMenu(a).bind((i=>{const c=((e,t,n)=>{if("notbuilt"===n.type){const r=e.getSystem().build(n.nbMenu());return o.setMenuBuilt(t,r),r}return n.menu})(t,a,i);return ct(c.element)||Tu.append(t,Ma(c)),e.onOpenSubmenu(t,n,c,X(r)),s===d.HighlightSubmenu?(gm.highlightFirst(c),u(t,o,r)):(gm.dehighlightAll(c),E.some(n))})))))))}},g=(t,n)=>{const s=r(n);return o.collapse(s).bind((r=>(l(t,r),u(t,o,r).map((o=>(e.onCollapseMenu(t,n,o),o))))))},h=t=>(n,o)=>ss(o.getSource(),"."+e.markers.item).bind((e=>n.getSystem().getByDom(e).toOptional().bind((e=>t(n,e).map(O))))),v=tr([or(Lh(),((e,t)=>{const n=t.event.item;o.lookupItem(r(n)).each((()=>{const n=t.event.menu;gm.highlight(e,n);const s=r(t.event.item);o.refresh(s).each((t=>c(e,o,t)))}))})),dr(((t,n)=>{const o=n.event.target;t.getSystem().getByDom(o).each((n=>{0===r(n).indexOf("collapse-item")&&g(t,n),m(t,n,d.HighlightSubmenu).fold((()=>{e.onExecute(t,n)}),p)}))})),cr(((t,n)=>{(t=>{const n=((t,n,o)=>Pe(o,((o,r)=>{const s=()=>Uh.sketch({...o,value:r,markers:e.markers,fakeFocus:e.fakeFocus,onHighlight:e.onHighlight,focusManager:e.fakeFocus?vm():hm()});return r===n?{type:"prepared",menu:t.getSystem().build(s())}:{type:"notbuilt",nbMenu:s}})))(t,e.data.primary,e.data.menus),r=s();return o.setContents(e.data.primary,n,e.data.expansions,r),o.getPrimary()})(t).each((n=>{Tu.append(t,Ma(n)),e.onOpenMenu(t,n),e.highlightImmediately&&a(t,n)}))}))].concat(e.navigateOnHover?[or(Ah(),((t,n)=>{const s=n.event.item;((e,t)=>{const n=r(t);o.refresh(n).bind((t=>(l(e,t),u(e,o,t))))})(t,s),m(t,s,d.HighlightParent),e.onHover(t,s)}))]:[])),b=e=>gm.getHighlighted(e).bind(gm.getHighlighted),y={collapseMenu:e=>{b(e).each((t=>{g(e,t)}))},highlightPrimary:e=>{o.getPrimary().each((t=>{a(e,t)}))},repositionMenus:t=>{const n=o.getPrimary().bind((e=>b(t).bind((e=>{const t=r(e),n=(s=o.getMenus(),Ue(s,f));var s;const a=gr(U(n,qh));return o.getTriggeringPath(t,(e=>((e,t,n)=>re(t,(e=>{if(!e.getSystem().isConnected())return E.none();const t=gm.getCandidates(e);return G(t,(e=>r(e)===n))})))(0,a,e)))})).map((t=>({primary:e,triggeringPath:t})))));n.fold((()=>{(e=>E.from(e.components()[0]).filter((e=>"menu"===Vr(e.element,"role"))))(t).each((n=>{e.onRepositionMenu(t,n,[])}))}),(({primary:n,triggeringPath:o})=>{e.onRepositionMenu(t,n,o)}))}};return{uid:e.uid,dom:e.dom,markers:e.markers,behaviours:Na(e.tmenuBehaviours,[Ug.config({mode:"special",onRight:h(((e,t)=>wm(t.element)?E.none():m(e,t,d.HighlightSubmenu))),onLeft:h(((e,t)=>wm(t.element)?E.none():g(e,t))),onEscape:h(((t,n)=>g(t,n).orThunk((()=>e.onEscape(t,n).map((()=>t)))))),focusIn:(e,t)=>{o.getPrimary().each((t=>{Zo(e,t.element,Io())}))}}),gm.config({highlightClass:e.markers.selectedMenu,itemClass:e.markers.menu}),ad.config({find:e=>gm.getHighlighted(e)}),Tu.config({})]),eventOrder:e.eventOrder,apis:y,events:v}},extraApis:{tieredData:(e,t,n)=>({primary:e,menus:t,expansions:n}),singleData:(e,t)=>({primary:e,menus:Rn(e,t),expansions:{}}),collapseItem:e=>({value:Os(Gh()),meta:{text:e}})}}),Yh=v("sink"),Qh=v(bi({name:Yh(),overrides:v({dom:{tag:"div"},behaviours:xr([yu.config({useFixed:O})]),events:tr([sr(So()),sr(wo()),sr(ko())])})})),Jh=Bt([cn("isExtraPart",w),sn("fireEventInstead",[cn("event",$o())])]),Xh=e=>{const t=Kt("Dismissal",Jh,e);return{[S()]:{schema:Bt([Zt("target")]),onReceive:(e,n)=>{Oh.isOpen(e)&&(Oh.isPartOf(e,n.target)||t.isExtraPart(e,n.target)||t.fireEventInstead.fold((()=>Oh.close(e)),(t=>Qo(e,t.event))))}}}},Zh=Bt([sn("fireEventInstead",[cn("event",qo())]),("doReposition",en("doReposition",Ut))]);const ev=e=>{const t=Kt("Reposition",Zh,e);return{[C()]:{onReceive:e=>{Oh.isOpen(e)&&t.fireEventInstead.fold((()=>t.doReposition(e)),(t=>Qo(e,t.event)))}}}};var tv;!function(e){e[e.HighlightFirst=0]="HighlightFirst",e[e.HighlightNone=1]="HighlightNone"}(tv||(tv={}));const nv=(e,t)=>{const n=e.getHotspot(t).getOr(t),o="hotspot",r=e.getAnchorOverrides();return e.layouts.fold((()=>({type:o,hotspot:n,overrides:r})),(e=>({type:o,hotspot:n,overrides:r,layouts:e})))},ov=(e,t,n,o,r,s,a)=>{const i=((e,t,n,o,r,s,a)=>{const i=((e,t,n)=>(0,e.fetch)(n).map(t))(e,t,o),c=av(o,e);return i.map((e=>e.bind((e=>E.from(Kh.sketch({...s.menu(),uid:Ms(""),data:e,highlightImmediately:a===tv.HighlightFirst,onOpenMenu:(e,t)=>{const o=c().getOrDie();yu.position(o,t,{anchor:n}),Oh.decloak(r)},onOpenSubmenu:(e,t,n)=>{const o=c().getOrDie();yu.position(o,n,{anchor:{type:"submenu",item:t}}),Oh.decloak(r)},onRepositionMenu:(e,t,o)=>{const r=c().getOrDie();yu.position(r,t,{anchor:n}),j(o,(e=>{yu.position(r,e.triggeredMenu,{anchor:{type:"submenu",item:e.triggeringItem}})}))},onEscape:()=>(dd.focus(o),Oh.close(r),E.some(!0))}))))))})(e,t,nv(e,n),n,o,r,a);return i.map((e=>(e.fold((()=>{Oh.isOpen(o)&&Oh.close(o)}),(e=>{Oh.cloak(o),Oh.open(o,e),s(o)})),o)))},rv=(e,t,n,o,r,s,a)=>(Oh.close(o),et(o)),sv=(e,t,n,o,r,s)=>{const a=mh.getCoupled(n,"sandbox");return(Oh.isOpen(a)?rv:ov)(e,t,n,a,o,r,s)},av=(e,t)=>e.getSystem().getByUid(t.uid+"-"+Yh()).map((e=>()=>ot.value(e))).getOrThunk((()=>t.lazySink.fold((()=>()=>ot.error(new Error("No internal sink is specified, nor could an external sink be found"))),(t=>()=>t(e))))),iv=e=>{Oh.getState(e).each((e=>{Kh.repositionMenus(e)}))},cv=(e,t,n)=>{const o=(()=>{const e=Os(ih);return{id:e,link:t=>{Pr(t,ih,e)},unlink:e=>{Ur(e,ih)}}})(),r=av(t,e);return{dom:{tag:"div",classes:e.sandboxClasses,attributes:{id:o.id,role:"listbox"}},behaviours:Ba(e.sandboxBehaviours,[Sd.config({store:{mode:"memory",initialValue:t}}),Oh.config({onOpen:(r,s)=>{const a=nv(e,t);o.link(t.element),e.matchWidth&&((e,t,n)=>{const o=ad.getCurrent(t).getOr(t),r=nc(e.element);n?ca(o.element,"min-width",r+"px"):((e,t)=>{tc.set(e,t)})(o.element,r)})(a.hotspot,s,e.useMinWidth),e.onOpen(a,r,s),void 0!==n&&void 0!==n.onOpen&&n.onOpen(r,s)},onClose:(e,r)=>{o.unlink(t.element),void 0!==n&&void 0!==n.onClose&&n.onClose(e,r)},isPartOf:(e,n,o)=>ch(n,o)||ch(t,o),getAttachPoint:()=>r().getOrDie()}),ad.config({find:e=>Oh.getState(e).bind((e=>ad.getCurrent(e)))}),ap.config({channels:{...Xh({isExtraPart:w}),...ev({doReposition:iv})}})])}},lv=v([Zt("dom"),Zt("fetch"),Ua("onOpen"),ja("onExecute"),cn("getHotspot",E.some),cn("getAnchorOverrides",v({})),yl(),Ra("dropdownBehaviours",[zd,mh,Ug,dd]),Zt("toggleClass"),cn("eventOrder",{}),on("lazySink"),cn("matchWidth",!1),cn("useMinWidth",!1),on("role")].concat([cn("sandboxClasses",[]),Fa("sandboxBehaviours",[ad,ap,Oh,Sd])])),uv=v([fi({schema:[Wa()],name:"menu",defaults:e=>({onExecute:e.onExecute})}),Qh()]),dv=Ri({name:"Dropdown",configFields:lv(),partFields:uv(),factory:(e,t,n,o)=>{const r=e=>{Oh.getState(e).each((e=>{Kh.highlightPrimary(e)}))},s={expand:t=>{zd.isOn(t)||sv(e,f,t,o,p,tv.HighlightNone).get(p)},open:t=>{zd.isOn(t)||sv(e,f,t,o,p,tv.HighlightFirst).get(p)},isOpen:zd.isOn,close:t=>{zd.isOn(t)&&sv(e,f,t,o,p,tv.HighlightFirst).get(p)},repositionMenus:e=>{zd.isOn(e)&&(e=>{const t=mh.getCoupled(e,"sandbox");iv(t)})(e)}},a=(e,t)=>(Xo(e),E.some(!0));return{uid:e.uid,dom:e.dom,components:t,behaviours:Na(e.dropdownBehaviours,[zd.config({toggleClass:e.toggleClass,aria:{mode:"expanded"}}),mh.config({others:{sandbox:t=>cv(e,t,{onOpen:()=>zd.on(t),onClose:()=>zd.off(t)})}}),Ug.config({mode:"special",onSpace:a,onEnter:a,onDown:(e,t)=>{if(dv.isOpen(e)){const t=mh.getCoupled(e,"sandbox");r(t)}else dv.open(e);return E.some(!0)},onEscape:(e,t)=>dv.isOpen(e)?(dv.close(e),E.some(!0)):E.none()}),dd.config({})]),events:qd(E.some((t=>{sv(e,f,t,o,r,tv.HighlightFirst).get(p)}))),eventOrder:{...e.eventOrder,[Po()]:["disabling","toggling","alloy.base.behaviour"]},apis:s,domModification:{attributes:{"aria-haspopup":"true",...e.role.fold((()=>({})),(e=>({role:e}))),..."button"===e.dom.tag?{type:("type",ze(e.dom,"attributes").bind((e=>ze(e,"type")))).getOr("button")}:{}}}}},apis:{open:(e,t)=>e.open(t),expand:(e,t)=>e.expand(t),close:(e,t)=>e.close(t),isOpen:(e,t)=>e.isOpen(t),repositionMenus:(e,t)=>e.repositionMenus(t)}}),mv="alloy.base.behaviour",gv=Os("tc-kebab-action"),pv=(e,t)=>{const n=U(e,(e=>({type:"item",data:{value:e.eventName},dom:{tag:"div",classes:ed.kebabItem},components:[{dom:{tag:"span",classes:ed.kebabItemLabel},components:[Ca(t.universe.translate(e.textKey))]}],itemBehaviours:xr([Er("item-events",[dr((t=>{Jo(t,gv,{eventName:e.eventName}),Qo(t,Lo())}))]),...lp({disablingConfig:{disableClass:ed.kebabDisabledItem.join(" ")}})]),eventOrder:{[Po()]:[op.name(),mv,zd.name(),"typeaheadevents","item-events"]}})));return dv.sketch({dom:{tag:"button",attributes:{type:"button"},classes:ed.kebab},components:[{dom:{tag:"div",classes:ed.kebabIcon,innerHtml:'<svg width="24" height="24" data-name="icon-image-options"><g id="icon-image-options" stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z" id="Shape" fill-rule="nonzero"></path></g></svg>'}}],lazySink:e=>t.getSink(e).fold((()=>ot.error("Could not find sink for kebab")),ot.value),dropdownBehaviours:xr([...lp({}),kd.config({tabAttr:Kp})]),sandboxBehaviours:xr([Er("kebab-sandbox-events",[or(gv,((e,t)=>{const n=Sd.getValue(e);Qo(n,t.event.eventName)}))])]),parts:{menu:{dom:{tag:"div"},markers:td.kebab}},toggleClass:Zu.kebabOpen,layouts:{onLtr:()=>[el],onRtl:()=>[Zc]},fetch:()=>{const e=Os("kebab-id");return et(E.some(Kh.singleData(e,{value:Os(e),dom:{tag:"div",classes:ed.kebabMenu},components:[{dom:{tag:"div",classes:ed.kebabMenuGroup},components:[Uh.parts.items({})]}],items:n})))}})},hv=e=>{const t=T(e),n=ye(t),o=(e=>{const t=void 0!==e.dom.attributes?e.dom.attributes:[];return q(t,((e,t)=>"class"===t.name?e:{...e,[t.name]:t.value}),{})})(t),r=(e=>Array.prototype.slice.call(e.dom.classList,0))(t),s=0===n.length?{}:{innerHtml:Br(t)};return{tag:ce(t),classes:r,attributes:o,...s}},vv="overlay-button-events",fv=[kd.config({}),Er(vv,[or(wo(),((e,t)=>{t.event.prevent()}))])],bv=(e,t,n)=>{const o=t=>{Qo(t,Bp),Cp(e(),(()=>({stage:yp.Before})))(t)},r=(e,t,n)=>jg.sketch({dom:{tag:"button",classes:e?ed.button:ed.secondaryButton},components:[Ca(t)],eventOrder:{[wo()]:[mv,dd.name(),vv]},action:n,buttonBehaviours:xr(fv)}),s={setText:(e,s,a)=>{const i=((e,o)=>{const r=U(((e,t)=>{switch(t){case yp.QueryingDelete:return n?[Bu.tc_delete_prompts_conversation,1===e?Bu.tc_delete_prompts_conversation_detail_sing:{pattern:Bu.tc_delete_prompts_conversation_detail_pl,targets:[e]}]:[Bu.tc_delete_prompts_comment];case yp.QueryingResolve:return[Bu.tc_resolve_prompts_conversation,1===e?Bu.tc_resolve_prompts_conversation_detail_sing:{pattern:Bu.tc_resolve_prompts_conversation_detail_pl,targets:[e]}];default:return[]}})(e,o),(e=>"string"==typeof e?t.translate(e):t.translate([e.pattern].concat(e.targets)))),s=o===yp.QueryingDelete;return{lines:r,cancelText:t.translate(Bu.tc_delete_buttons_cancel),proceedText:t.translate(s?Bu.tc_delete_buttons_proceed:Bu.tc_resolve_buttons_proceed),proceedEvent:s?Ip:Vp}})(s,a);Tu.set(e,U(i.lines,(e=>({dom:{tag:"div"},components:[{dom:hv(`<p>${e}</p>`)}]}))).concat([{dom:{tag:"div",classes:ed.cardOverlayButtons},components:[r(!0,i.cancelText,o),r(!1,i.proceedText,(e=>{Qo(e,i.proceedEvent)}))]}]))}};return{dom:{tag:"div",styles:{display:"none"},classes:ed.cardOverlayText},components:[],apis:s,behaviours:xr([Tu.config({}),Er("card-delete-events",[or(Bo(),(t=>{Mr(t.element).fold((()=>{Cp(e(),(()=>({stage:yp.Before})))(t)}),p)}))]),Ug.config({mode:"cyclic",onEscape:e=>(o(e),E.some(!0))})])}},yv=(e,t,n)=>{n?(pa(t.element,"display"),t.hasConfigured(Ug)&&Ug.focusIn(t)):ca(t.element,"display","none")},_v="basecamp",xv="deleting",wv={textKey:Bu.tc_kebab_edit,eventName:Wp},Ov={textKey:Bu.tc_kebab_delete,eventName:Dp},Sv={textKey:Bu.tc_kebab_delete_conversation,eventName:Hp},Cv={textKey:Bu.tc_kebab_resolve_conversation,eventName:Pp},Ev=(e,t,n,o)=>{let r=e;const s=Y([n.deleteConversation?[Sv]:[],n.resolveConversation?[Cv]:[],n.editComment?[wv]:[],n.deleteComment?[Ov]:[]]),a=zi(((e,t)=>{const n=e=>[Ca(`${sh(Sn(e.createdAt),t)}`),{dom:{tag:"span",classes:[]},components:e.modifiedAt===e.createdAt?[]:[Ca(t.translate(Bu.tc_date_comment_edited))]}],o={updateWith:(e,t,o)=>{Tu.set(e,n(t))}};return{dom:{tag:"div",classes:ed.date},components:n(e),behaviours:xr([Tu.config({})]),apis:o}})(e,o.universe)),i={updateWith:(e,t,n)=>{r=t,l.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})})),u.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})})),((e,t,n)=>{const o=n.stage===yp.QueryingDelete||n.stage===yp.QueryingResolve;d.getOpt(e).each((e=>yv(0,e,o))),m.getOpt(e).each((e=>{e.getApis().setText(e,t,n.stage),yv(0,e,o)}))})(e,n.numComments,t),t.stage!==yp.PostDelete&&t.stage!==yp.PostResolve||Hd.getCurrentRoute(e).filter((e=>e.destination===xv)).fold((()=>{Hd.progressTo(e,xv)}),p),a.getOpt(e).each((e=>{e.getApis().updateWith(e,t,{})}))}},c={dom:{tag:"div",classes:ed.cardHead},components:Y([[{dom:{tag:"div",classes:ed.cardHeadMeta},components:[(e=>{const t=((e,t)=>({dom:{tag:"div",classes:ed.avatar},components:[{dom:{tag:"img",attributes:{alt:"",role:"presentation",src:od(e,t)}}}]}))(o.avatarCache,e),n={dom:{tag:"div",classes:ed.username},components:[Ca(e.authorName)]};return{dom:{tag:"div",classes:ed.user},components:[t,{dom:{tag:"div"},components:[n,a.asSpec()]}]}})(r)]}],s.length>0?[pv(s,o)]:[]])},l=zi((e=>{const t=vn(e),n={updateWith:(e,n,o)=>{switch(t.set(n),n.mode){case bp.None:ca(e.element,"display","none");break;case bp.Collapsed:pa(e.element,"display"),xe(e.element).each((e=>Dr(e,Bu.tc_comment_buttons_showmore)));break;case bp.Expanded:pa(e.element,"display"),xe(e.element).each((e=>Dr(e,Bu.tc_comment_buttons_showless)));break;case bp.ExpandOrNone:case bp.CollapsedOrNone:break;case bp.Edit:ca(e.element,"display","none")}}};return{dom:{tag:"div",classes:ed.showMoreLessContainer,styles:{display:"none"}},components:[jg.sketch({dom:{tag:"p",classes:ed.showMoreLess},components:[Ca(Bu.tc_comment_buttons_showmore)],action:e=>{Cp(t.get().uid,(()=>({mode:t.get().mode===bp.Collapsed?bp.Expanded:bp.Collapsed})))(e)},buttonBehaviours:xr([kd.config({tabAttr:Kp})])})],apis:n}})({uid:e.uid,mode:e.mode})),u=zi(((e,t)=>{const n=vn(e),o=e=>{Qo(e,Bp),Cp(n.get().uid,(e=>({mode:bp.ExpandOrNone})))(e)},r={updateWith:(e,t,o)=>{n.set(t),Fp({props:t,memCommands:s}).each((t=>{ta(e.element,Zu.bodyNotAnimating),t(e)}))}},s=zi(((e,t)=>({dom:{tag:"div",classes:ed.editActions},components:[mp({text:t.translate(Bu.tc_edit_buttons_cancel),eventName:E.some(pp),disableWhileSaving:!0}),dp({text:t.translate(Bu.tc_edit_buttons_save),eventName:E.some(gp),disableWhileSaving:!0})]}))(n.get(),t));return{dom:{tag:"div",classes:ed.cardBody},components:[nh(n.get().content)],behaviours:xr([Er("overflow-events",[cr((e=>{r.updateWith(e,n.get(),{})})),or(gp,(e=>{Qo(e,Lp)})),or(pp,o),ir(Ao(),((e,t)=>{"max-height"===t.event.raw.propertyName&&xe(e.element).each((t=>{e.getSystem().triggerEvent(Eo(),t,{})}))}))]),Yp({onEscape:e=>(o(e),E.some(!0))}),zd.config({toggleClass:Zu.bodyExpanded,selected:!1,toggleOnExecute:!1,aria:{mode:"expanded"}}),Sd.config({store:{mode:"manual",getValue:e=>xe(e.element).map(va).getOr(""),setValue:(e,t)=>{xe(e.element).each((e=>{fa(e,t)}))}}}),Tu.config({})]),apis:r}})(r,o.universe)),d=zi({dom:{tag:"div",classes:ed.cardOverlay,styles:{display:"none"}}}),m=zi(bv((()=>r.uid),o.universe,t));return{dom:{tag:"div",classes:ed.card,styles:{position:"relative"}},components:[c,u.asSpec(),d.asSpec(),m.asSpec(),l.asSpec()],behaviours:xr([dd.config({}),kd.config({}),Jp({escapeEvent:Bp}),Hd.config({initialState:_v,onTransition:e=>{var t;(t=r.uid,e=>{Jo(e,vp,{uid:t})})(e)},routes:{[_v]:{[xv]:{transition:{property:"opacity",transitionClass:Zu.disappearing}}}}}),Sd.config({store:{mode:"memory",initialValue:r.uid}}),Er("comment-events",[or(Up,(e=>Cp(r.uid,(()=>({mode:r.mode===bp.Collapsed?bp.Expanded:bp.Collapsed})))(e))),or(Bp,dd.focus),or(Dp,(e=>{Cp(r.uid,(()=>({stage:yp.QueryingDelete})))(e)})),or(Hp,(e=>{Cp(r.uid,(()=>({stage:yp.QueryingDelete})))(e)})),or(Pp,(e=>{Cp(r.uid,(()=>({stage:yp.QueryingResolve})))(e)})),or(Vp,(e=>{Jo(e,ah.resolveConversationEvent,{uid:r.uid})})),or(Wp,(e=>Cp(r.uid,(e=>({mode:bp.Edit})))(e))),or(Lp,(e=>{u.getOpt(e).each((t=>{const n=Sd.getValue(t);Jo(e,ah.editCommentEvent,{uid:r.uid,content:n})}))})),or(Ip,(e=>{Jo(e,t?ah.deleteConversationEvent:ah.deleteCommentEvent,{uid:r.uid})}))])]),apis:i}},kv=(e,t,n)=>U(e,((e,o)=>{const r=0===o;return Ev(e,r,{editComment:!0,deleteComment:o>0,deleteConversation:r,resolveConversation:r&&n},t)})),Tv=(e,t,n=!1)=>{const o={setComments:(e,o)=>{ad.getCurrent(e).each((e=>{Tu.set(e,kv(o,t,n))})),Ep(e)},updateWith:(e,o,r)=>{ad.getCurrent(e).each((r=>{const s=Tu.contents(r);(e=>oe(e).exists((e=>e.stage===yp.QueryingDelete)))(o)||(e=>oe(e).exists((e=>e.stage===yp.QueryingResolve)))(o)?ea(r.element,Zu.commentThreadOverlay):ta(r.element,Zu.commentThreadOverlay),s.length!==o.length?Tu.set(r,kv(o,t,n)):j(s,((e,t)=>{s[t].getApis().updateWith(s[t],o[t],{numComments:o.length})})),Ep(e)}))},scrollToEnd:e=>{ad.getCurrent(e).each((t=>{var n;(n=Tu.contents(t),ne(n,n.length-1)).each((t=>{const n=e.element.dom,o=n.getBoundingClientRect(),r=t.element.dom.getBoundingClientRect();r.top<o.top?n.scrollTop+=r.top-o.top:r.bottom>o.bottom&&(n.scrollTop+=r.bottom-o.bottom)}))}))}};return{dom:{tag:"div",classes:ed.outerScroll},components:[{dom:{tag:"div",classes:ed.commentList},components:kv(e,t,n),behaviours:xr([Xp({selector:Xu.card}),Tu.config({})])}],behaviours:xr([ad.config({find:e=>xe(e.element).bind((t=>e.getSystem().getByDom(t).toOptional()))})]),apis:o}},Av=e=>{return{dom:{tag:"div",classes:ed.conversationsHead},components:[(t=e.translate(Bu.tc_conversations_title),{dom:{tag:"div",classes:ed.conversationsTitle},components:[Ca(t)]})]};var t};var Mv;!function(e){e[e.Start=0]="Start",e[e.Reply=1]="Reply"}(Mv||(Mv={}));const Rv=Os("tc-clear-input"),Nv=Os("tc-submit-input"),Fv=(e,t)=>{const n=zi((e=>((e,t)=>Gp.sketch({tag:"textarea",inputClasses:ed.replyTextarea,inputAttributes:{...Zp,placeholder:t.translate(Bu.tc_reply_placeholders)},inputStyles:eh,inputBehaviours:xr([Qp({enterEvent:e}),kd.config({}),Er("reply-events",[or(Eo(),th)]),...lp({disableWhileSaving:!0})])}))(Nv,e))(t)),o={focusEditor:e=>{n.getOpt(e).each(dd.focus)},updateWith:(e,t,n)=>{L(t,(e=>e.mode===bp.Edit))?ca(e.element,"display","none"):pa(e.element,"display")}};return{dom:{tag:"div",classes:ed.replySection},behaviours:xr([Er("reply-events",[or(Rv,(e=>{n.getOpt(e).each((e=>{Sd.setValue(e,"")}))})),or(Nv,(t=>{n.getOpt(t).map(Sd.getValue).each((n=>{n.length>0&&Jo(t,ah.createCommentEvent,{content:n,mode:e})}))}))])]),components:[n.asSpec(),mp({text:t.translate(Bu.tc_reply_buttons_clear),eventName:E.some(Rv),disableWhileSaving:!0}),dp({text:t.translate(Bu.tc_reply_buttons_comment),eventName:E.some(Nv),disableWhileSaving:!0})],apis:o}},Bv=()=>{let e=Op();const t=t=>{e=t(e)};return{clearAll:()=>{e=Op()},recalibrate:e=>{t((t=>{return n=t,o=e.comments,{targetUid:n.targetUid,conversation:U(o,(e=>({uid:e.uid,props:{...e,stage:yp.Before,mode:mr(n.targetUid,e.uid)?bp.ExpandOrNone:bp.CollapsedOrNone}}))),queue:[]};var n,o}))},enqueuePatch:(e,n)=>{t((t=>((e,t)=>wp(e,[t]))(t,{uid:e,patch:n})))},enqueuePatches:e=>{t((t=>wp(t,e)))},setTargetUid:e=>{t((t=>xp(t,E.some(e))))},clearTargetUid:()=>{t((e=>xp(e,E.none())))},processQueue:()=>(e=>{if(e.queue.length>0){const t=(e=>{const t=U(e.conversation,(t=>G(e.queue,(e=>e.uid===t.uid)).fold((()=>t),(e=>{const n=void 0!==e.patch.content?{mode:bp.ExpandOrNone}:{};return{uid:t.uid,props:{...t.props,...e.patch,...n}}}))));return{targetUid:e.targetUid,conversation:t,queue:[]}})(e);return E.some({world:t,props:_p(t)})}return E.none()})(e).map((({world:t,props:n})=>(e=t,n))),purge:e=>{t((t=>{const n=z(t.conversation,(t=>t.uid!==e));return{...t,conversation:n}}))},getProps:()=>_p(e),adjust:e=>{t((t=>wp(t,U(e,(e=>({uid:e.uid,patch:"to-delete"===e.type?{stage:yp.PostDelete}:{}}))))))}}},Dv=e=>({type:"redraw-sidebar",view:e}),Hv=Os("tc-escapeInSidebar"),Pv=(e,t,n,o,r,s,a)=>{const i=e=>{v.get().each((t=>{"comments"===t.type&&oe(t.conversation.comments).each((({author:n,authorName:o,content:r,createdAt:s})=>{e(t.conversation.uid,{author:n,authorName:o},r,a(t.conversation.uid),s)}))}))},c=(e,t)=>{v.get().each((n=>{"comments"===n.type&&G(n.conversation.comments,(t=>t.uid===e)).each((({author:e,authorName:n,content:o})=>{t({author:e,authorName:n},o)}))}))},l=Bv(),u=(()=>{const e={};return{lookup:t=>ze(e,t),store:(t,n)=>e[t]=n}})(),d=()=>{l.processQueue().each((e=>{w(e),b.getOpt(p).each((t=>{t.getApis().updateWith(t,e,{})}))}))},m=(e,t)=>{i(((n,o,r,s,a)=>e(n).get((e=>{e.fold((e=>e()),(e=>{e(),t(n,o,r,s,a)}))}))))},g=(e,t)=>{e.get((e=>{e.fold((e=>e()),(e=>{l.setTargetUid(e.targetUid),e.fn(),t(e.targetUid)}))}))},p=Aa({dom:{tag:"div",classes:e,styles:{position:"relative"}},behaviours:xr([Tu.config({}),Yp({onEscape:e=>(Qo(e,Hv),E.some(!0))}),Er("sidebar-events",[or(hp,((e,t)=>{l.enqueuePatch(t.event.uid,t.event.patch)})),or(vp,((e,t)=>{l.purge(t.event.uid),b.getOpt(p).each((e=>{const t=l.getProps();w(t),e.getApis().updateWith(e,t,{})}))})),or(fp,(()=>{d()})),or(Hv,(()=>{t.onEscape()})),or(ah.deleteConversationEvent,(()=>{m((e=>n.deleteConversation(e)),((e,t,n,o,s)=>{r({type:"delete",timestamp:fn(),conversationUid:e,conversationContext:o,conversationContent:n,conversationAuthor:t,conversationCreatedAt:s})}))})),or(ah.deleteCommentEvent,((e,t)=>{const o=t.event.uid;m((e=>n.deleteComment(e,o)),((e,t,n,s,a)=>{c(o,((i,c)=>{r({type:"delete-comment",timestamp:fn(),conversationUid:e,commentUid:o,conversationContext:s,conversationContent:n,conversationCreatedAt:a,commentContent:c,commentAuthor:i,conversationAuthor:t})}))}))})),or(ah.resolveConversationEvent,(()=>{n.optResolveConversation.each((e=>{m((t=>e(t)),((e,t,n,o,s)=>{r({type:"resolve",timestamp:fn(),conversationUid:e,conversationContext:o,conversationContent:n,conversationCreatedAt:s,conversationAuthor:t})}))}))})),or(ah.editCommentEvent,((e,t)=>{const{uid:o,content:s}=t.event;i(((e,t,a,i,l)=>{g(n.editComment(e,o,s),(()=>{c(o,(n=>{r({type:"edit-comment",timestamp:fn(),conversationUid:e,commentUid:o,conversationContext:i,conversationContent:a,conversationCreatedAt:l,commentContent:s,commentAuthor:n,conversationAuthor:t})}))}))}))})),or(ah.createCommentEvent,((e,t)=>{const o=t.event.content;t.event.mode===Mv.Reply?i(((e,t,s,a,i)=>{g(n.reply(e,o),(n=>{r({type:"reply",timestamp:fn(),conversationUid:e,commentUid:n,conversationContext:a,conversationContent:s,conversationCreatedAt:i,commentContent:o,conversationAuthor:t})}))})):g(n.createConversation(o),(e=>{r({type:"create",timestamp:fn(),conversationUid:e,conversationContext:a(e),conversationContent:o})}))}))])])}),h=ji(p),v=vn(E.none()),f=e=>{Tu.set(p,[y.asSpec(),Av(o)].concat(e))},b=zi(Tv([],{getSink:e=>y.getOpt(e),universe:o,avatarCache:u},s.useResolveConversation)),y=zi({dom:{tag:"div",styles:{"z-index":"100"}},behaviours:xr([yu.config({})])}),_=zi(Fv(Mv.Start,o)),x=zi(Fv(Mv.Reply,o)),w=e=>{x.getOpt(p).each((t=>{t.getApis().updateWith(t,e,{})}))},O=e=>{"splash"===e.view.type?(l.clearAll(),f([_.asSpec()])):"comments"===e.view.type&&(l.recalibrate(e.view.conversation),f([b.asSpec(),x.asSpec()]),b.getOpt(p).each((e=>{const t=l.getProps();w(t),e.getApis().setComments(e,t),e.getApis().scrollToEnd(e)})))};return{system:h,root:p,element:h.element,update:e=>{b.getOpt(p).bind((e=>v.get().map((t=>({convUi:e,pview:t}))))).fold((()=>O(e)),(({pview:t})=>{const n=((e,t)=>e.type!==t.type?Dv(t):"splash"===t.type?{type:"no-change"}:((e,t)=>{if(e.conversation.uid===t.conversation.uid){const n=U(e.conversation.comments,(e=>e.uid)),o=U(t.conversation.comments,(e=>e.uid));return((e,t,n=H)=>D(n).eq(e,t))(n,o)?{type:"refresh-comments",comments:U(t.conversation.comments,(e=>({uid:e.uid,patch:{...e}})))}:0===Z(o,n).length?{type:"remove-comments",adjustments:U(n,(e=>({type:W(o,e)?"to-remain":"to-delete",uid:e})))}:Dv(t)}return Dv(t)})(e,t))(t,e.view);switch(n.type){case"add-comment":case"redraw-sidebar":O(e);break;case"no-change":break;case"remove-comments":l.adjust(n.adjustments),d();break;case"refresh-comments":l.enqueuePatches(n.comments),d()}})),v.set(E.some(e.view)),Au(p.element)&&e.grabFocus()&&x.getOpt(p).orThunk((()=>_.getOpt(p))).each((e=>{e.getApis().focusEditor(e)}))},hasFocus:()=>Mr(p.element).isSome(),sendGlobalUiState:e=>{e.readonly&&h.broadcastOn([S()],{target:h.element}),h.broadcastOn([En],e)},getSink:y.getOpt}},Iv=(e,t)=>{e.execCommand("tc-delete-conversation-at-cursor",null,{conversationUid:t})},Vv=(e,t,n,o)=>e.fold((e=>ot.error({message:t,error:e,refresh:o})),(e=>n(e).fold((e=>ot.error({message:e.permError,error:e.reason,refresh:o})),ot.value))),Wv=e=>ze(e,"reason").getOr("");tinymce.Resource.add("tinymce.plugins.tinycomments.sidebar",((e,t,n,o,s,a)=>{const i=((e,t,n)=>{const o=e=>()=>{n().showError(e.message,e.error),e.refresh&&e.refresh()};return{createConversation:r=>(n().setSaving(!0),it.wrap(e.create({content:r,createdAt:fn()}).map((e=>{const r=ot.value,s=p;return n().setSaving(!1),Vv(e,Bu.tc_create_problem,r,s).fold((e=>ot.error(o(e))),(e=>ot.value({targetUid:e.conversationUid,fn:()=>{n().refreshReadonly()?ze(e,"onError").each((e=>e(new Error("Unable to create a new conversation")))):(t.annotator.annotate(Ge(),{uid:e.conversationUid}),n().refreshSidebar(E.some(e.conversationUid),3),ze(e,"onSuccess").each((t=>t(e.conversationUid))))}})))})))),reply:(t,r)=>(n().setSaving(!0),it.wrap(e.reply({conversationUid:t,content:r,createdAt:fn()}).map((e=>{const r=ot.value,s=p;return n().setSaving(!1),Vv(e,Bu.tc_reply_problem,r,s).fold((e=>ot.error(o(e))),(e=>ot.value({targetUid:e.commentUid,fn:()=>{n().refreshSidebar(E.some(t),3)}})))})))),editComment:(t,r,s)=>(n().setSaving(!0),it.wrap(e.editComment({conversationUid:t,commentUid:r,content:s,modifiedAt:fn()}).map((e=>{const s=p;return n().setSaving(!1),Vv(e,Bu.tc_edit_problem_comment,(e=>e.canEdit?ot.value(e):ot.error({permError:Bu.tc_edit_unauthorised_comment,reason:Wv(e)})),s).fold((e=>ot.error(o(e))),(()=>ot.value({targetUid:r,fn:()=>{n().refreshSidebar(E.some(t),4)}})))})))),deleteComment:(t,r)=>it.wrap(e.deleteComment({conversationUid:t,commentUid:r}).map((e=>Vv(e,Bu.tc_delete_problem_comment,(e=>e.canDelete?ot.value(e):ot.error({permError:Bu.tc_delete_unauthorised_comment,reason:Wv(e)})),(()=>{n().refreshSidebar(E.some(t),4)})).fold((e=>ot.error(o(e))),(()=>ot.value((()=>{n().refreshSidebar(E.some(t),4)}))))))),deleteConversation:r=>it.wrap(e.deleteConversation({conversationUid:r}).map((e=>Vv(e,Bu.tc_delete_problem_conversation,(e=>e.canDelete?ot.value(e):ot.error({permError:Bu.tc_delete_unauthorised_conversation,reason:Wv(e)})),(()=>{n().refreshSidebar(E.some(r),4)})).fold((e=>ot.error(o(e))),(()=>ot.value((()=>{Iv(t,r),n().refreshSidebar(E.none(),2)}))))))),optResolveConversation:e.resolveConversation.map((e=>r=>it.wrap(e({conversationUid:r}).map((e=>Vv(e,Bu.tc_resolve_problem_conversation,(e=>e.canResolve?ot.value(e):ot.error({permError:Bu.tc_resolve_unauthorised_conversation,reason:Wv(e)})),(()=>{n().refreshSidebar(E.some(r),4)})).fold((e=>ot.error(o(e))),(()=>ot.value((()=>{Iv(t,r),n().refreshSidebar(E.none(),2)})))))))))}})(t,e,(()=>u)),c={useResolveConversation:t.resolveConversation.isSome()},l=Pv(ed.roots,{onEscape:()=>e.focus()},i,a,((e,t)=>n=>{const o=(e=>(t={})=>r(t.after)?Cn(e,t.after):Cn(e))(t);t.set(t.get().concat([n])),((e,t)=>{const n={getEventLog:t};e.dispatch("CommentChange",n)})(e,o)})(e,o),c,(t=>((e,t)=>ze(e.annotator.getAll(Ge()),t).map((t=>U(t,(t=>((e,t)=>{const n="SPAN"===t.nodeName;return e.serialize(t,{getInner:n,selection:!0})})(e.serializer,t))).join(" "))).getOr(""))(e,t))),u=hn(t,n,e,l),d=e=>{l.system.broadcastOn([S()],{target:R(e.target)})};e.on("ResizeEditor",(()=>{l.system.broadcastOn([kn],{})}));const m=Me(R(document),"mousedown",(e=>{l.system.broadcastOn([S()],{target:e.target})}));e.on("mousedown",d),e.on("remove",(()=>{e.off("mousedown",d),m.unbind()})),s({controller:u,attachTo:e=>{Fe(e,l.element)}})}))}();