/*!
 * Tiny Enhanced Media Embed plugin
 *
 * Copyright (c) 2022 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 3.0.4-60
 */

!function(){"use strict";const e=Object.getPrototypeOf,t=(e,t,r)=>{var o;return!!r(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},r=e=>r=>(e=>{const r=typeof e;return null===e?"null":"object"===r&&Array.isArray(e)?"array":"object"===r&&t(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":r})(r)===e,o=e=>t=>typeof t===e,n=r("string"),s=r("object"),a=r=>((r,o)=>s(r)&&t(r,o,((t,r)=>e(t)===r)))(r,Object),i=r("array"),l=o("boolean"),c=o("function"),u=o("number");class d{constructor(e,t){this.tag=e,this.value=t}static some(e){return new d(!0,e)}static none(){return d.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?d.some(e(this.value)):d.none()}bind(e){return this.tag?e(this.value):d.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:d.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?d.none():d.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}d.singletonNone=new d(!1);const m=(e,t)=>((e,t,r)=>""===t||e.length>=t.length&&e.substr(0,0+t.length)===t)(e,t),p=e=>parseInt(e,10),h=(e,t)=>{const r=e-t;return 0===r?0:r>0?1:-1},f=(e,t,r)=>({major:e,minor:t,patch:r}),g=e=>{const t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return t?f(p(t[1]),p(t[2]),p(t[3])):f(0,0,0)},y=e=>t=>t.options.get(e),v=y("mediaembed_content_css"),b=y("mediaembed_max_width"),w=y("mediaembed_inline_styles"),S=y("mediaembed_service_url"),x=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},E=(e,t)=>{const r=(t||document).createElement(e);return x(r)},T=x;"undefined"!=typeof window?window:Function("return this;")();const O=(1,e=>1===(e=>e.dom.nodeType)(e));const C=e=>t=>O(t)&&t.dom.nodeName.toLowerCase()===e,A=()=>{},k=e=>()=>e,N=e=>e,j=e=>e(),_=k(!1),R=k(!0),P=Array.prototype.slice,I=Array.prototype.indexOf,M=Array.prototype.push,F=(e,t)=>((e,t)=>I.call(e,t))(e,t)>-1,D=(e,t)=>{const r=e.length,o=new Array(r);for(let n=0;n<r;n++){const r=e[n];o[n]=t(r,n)}return o},q=(e,t)=>{for(let r=0,o=e.length;r<o;r++)t(e[r],r)},K=(e,t)=>{const r=[];for(let o=0,n=e.length;o<n;o++){const n=e[o];t(n,o)&&r.push(n)}return r},V=(e,t)=>((e,t,r)=>{for(let o=0,n=e.length;o<n;o++){const n=e[o];if(t(n,o))return d.some(n);if(r(n,o))break}return d.none()})(e,t,_),B=(e,t)=>(e=>{const t=[];for(let r=0,o=e.length;r<o;++r){if(!i(e[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+e);M.apply(t,e[r])}return t})(D(e,t)),J=c(Array.from)?Array.from:e=>P.call(e),L=e=>d.from(e.dom.parentNode).map(T),U=e=>d.from(e.dom.nextSibling).map(T),H=e=>D(e.dom.childNodes,T),W=e=>((e,t)=>{const r=e.dom.childNodes;return d.from(r[0]).map(T)})(e),z=Object.keys,$=Object.hasOwnProperty,Y=(e,t)=>{const r=z(e);for(let o=0,n=r.length;o<n;o++){const n=r[o];t(e[n],n)}},G=(e,t)=>X(e,t)?d.from(e[t]):d.none(),X=(e,t)=>$.call(e,t),Q=(e,t,r)=>{((e,t,r)=>{if(!(n(r)||l(r)||u(r)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")})(e.dom,t,r)},Z=e=>void 0!==e.style&&c(e.style.getPropertyValue),ee=(e,t,r)=>{if(!n(r))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);Z(e)&&e.style.setProperty(t,r)},te=(e,t,r)=>{const o=e.dom;ee(o,t,r)},re=(e,t)=>{U(e).fold((()=>{L(e).each((e=>{oe(e,t)}))}),(e=>{((e,t)=>{L(e).each((r=>{r.dom.insertBefore(t.dom,e.dom)}))})(e,t)}))},oe=(e,t)=>{e.dom.appendChild(t.dom)},ne=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},se=e=>{const t=E("div"),r=T(e.dom.cloneNode(!0));return oe(t,r),(e=>e.dom.innerHTML)(t)},ae=e=>((e,t)=>T(e.dom.cloneNode(!0)))(e),ie=(e,t)=>((e,r)=>K(H(e),(e=>((e,t)=>{const r=e.dom;if(1!==r.nodeType)return!1;{const e=r;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}})(e,t))))(e),le=(e,t)=>((e,t)=>{const r=void 0===t?document:t.dom;return 1!==(o=r).nodeType&&9!==o.nodeType&&11!==o.nodeType||0===o.childElementCount?[]:D(r.querySelectorAll(e),T);var o})(t,e);var ce=function(e){var t,r,o=e,n={a:0,b:0,c:0},s=[];return t=function(t,r){var a,i,l,c,u,d;if(t.test(o))for(i=0,l=(a=o.match(t)).length;i<l;i+=1)n[r]+=1,c=a[i],u=o.indexOf(c),d=c.length,s.push({selector:e.substr(u,d),type:r,index:u,length:d}),o=o.replace(c,Array(d+1).join(" "))},(r=function(e){var t,r,n,s;if(e.test(o))for(r=0,n=(t=o.match(e)).length;r<n;r+=1)s=t[r],o=o.replace(s,Array(s.length+1).join("A"))})(/\\[0-9A-Fa-f]{6}\s?/g),r(/\\[0-9A-Fa-f]{1,5}\s/g),r(/\\./g),function(){var e,t,r,n,s=/{[^]*/gm;if(s.test(o))for(t=0,r=(e=o.match(s)).length;t<r;t+=1)n=e[t],o=o.replace(n,Array(n.length+1).join(" "))}(),t(/(\[[^\]]+\])/g,"b"),t(/(#[^\#\s\+>~\.\[:\)]+)/g,"a"),t(/(\.[^\s\+>~\.\[:\)]+)/g,"b"),t(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,"c"),t(/(:(?!not|global|local)[\w-]+\([^\)]*\))/gi,"b"),t(/(:(?!not|global|local)[^\s\+>~\.\[:]+)/g,"b"),o=(o=(o=(o=(o=(o=o.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," ")).replace(/:not/g,"    ")).replace(/:local/g,"      ")).replace(/:global/g,"       ")).replace(/[\(\)]/g," "),t(/([^\s\+>~\.\[:]+)/g,"c"),s.sort((function(e,t){return e.index-t.index})),{selector:e,specificity:"0,"+n.a.toString()+","+n.b.toString()+","+n.c.toString(),specificityArray:[0,n.a,n.b,n.c],parts:s}},ue=e=>{const t=e.dom.styleSheets;return Array.prototype.slice.call(t)};const de=e=>{const t=e.selectorText,r=e.style.cssText;if(void 0===r)throw new Error("WARNING: Browser does not support cssText property");return{selector:t,style:r,raw:e.style}},me=e=>{const t=e.cssRules;return B(t,(e=>(e=>e.type===window.CSSRule.IMPORT_RULE)(e)?me(e.styleSheet):(e=>e.type===window.CSSRule.STYLE_RULE)(e)?[de(e)]:[]))},pe=e=>B(e,me),he=(e,t,r)=>{const o=e=>-1!==e.selector.indexOf(","),n=B(K(e,o),(e=>{const t=e.selector.split(",");return D(t,(t=>({selector:t.trim(),raw:e.raw})))})),s=K(e,(e=>!o(e))).concat(n);s.sort(((e,t)=>function(e,t){var r,o,n;if("string"==typeof e){if(-1!==e.indexOf(","))throw"Invalid CSS selector";r=ce(e).specificityArray}else{if(!Array.isArray(e))throw"Invalid CSS selector or specificity array";if(4!==e.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";r=e}if("string"==typeof t){if(-1!==t.indexOf(","))throw"Invalid CSS selector";o=ce(t).specificityArray}else{if(!Array.isArray(t))throw"Invalid CSS selector or specificity array";if(4!==t.filter((function(e){return"number"==typeof e})).length)throw"Invalid specificity array";o=t}for(n=0;n<4;n+=1){if(r[n]<o[n])return-1;if(r[n]>o[n])return 1}return 0}(e.selector,t.selector))).reverse(),((e,t,r)=>{const o=B(t,(t=>{const r=le(e,t.selector);return q(r,(e=>{const r=((e,t)=>{const r={};return q(e,(o=>{if(void 0!==e[o]){const n=t.dom.style;F(n,o)||(r[o]=e[o])}})),r})(t.raw,e);((e,t)=>{const r=e.dom;Y(t,((e,t)=>{ee(r,t,e)}))})(e,r)})),r}));r&&q(o,(e=>{e.dom.removeAttribute("class")}))})(t,s,r)},fe=(e,t,r,o)=>{const n=ue(e),s=pe(n).map((e=>{const t=e.selector;return{selector:r.hasOwnProperty(t)?r[t]:t,raw:e.raw}}));he(s,t,o)},ge=(e,t,r,o)=>{const n=ue(e),s=pe(n),a=K(s,(e=>m(e.selector,r)));he(a,t,o)},ye=(e,t,r,o)=>{const n=ue(e),s=pe(n),a=K(s,(e=>F(r,e.selector)));he(a,t,o)};var ve={inlineStyles:(e,t,r)=>{fe(e,t,r,!0)},inlineStylesKeepClasses:(e,t,r)=>{fe(e,t,r,!1)},inlinePrefixedStyles:(e,t,r)=>{ge(e,t,r,!0)},inlinePrefixedStylesKeepClasses:(e,t,r)=>{ge(e,t,r,!1)},inlineSelectorsStyles:(e,t,r)=>{ye(e,t,r,!0)},inlineSelectorsStylesKeepClasses:(e,t,r)=>{ye(e,t,r,!1)}},be={inlineStyles:ve.inlineStyles,inlineStylesKeepClasses:ve.inlineStylesKeepClasses,inlinePrefixedStyles:ve.inlinePrefixedStyles,inlinePrefixedStylesKeepClasses:ve.inlinePrefixedStylesKeepClasses,inlineSelectorsStyles:ve.inlineSelectorsStyles,inlineSelectorsStylesKeepClasses:ve.inlineSelectorsStylesKeepClasses};const we=e=>e.dom.textContent,Se=(e,t)=>{const r=t[t.length-1];return((e,t)=>{for(let t=0,s=e.length;t<s;t++)if(o=e[t],n=void 0,n=r,o.dom===n.dom)return d.some(t);var o,n;return d.none()})(e).getOrDie("how is it possible you can't find a br you just found?")},xe=e=>K(ie(e,"br"),(e=>U(e).isSome())),Ee=e=>{return t=(e,t)=>e+we(t),r="",q(e,((e,o)=>{r=t(r,e)})),r;var t,r},Te=e=>{const t=xe(e);if(t.length>0){const r=H(e),o=Se(r,t),n=r.slice(o+1);return Ee(n)}return d.from(we(e)).getOr("")},Oe=e=>O(e)?e:U(e).fold((()=>e),Oe),Ce=(e,t)=>{const r=e.parser.parse(t,{isRootContent:!0,forced_root_block:!1}),o=tinymce.html.Serializer({validate:!0},e.schema).serialize(r),n=T(e.dom.createFragment(o));return Re(e,n)},Ae=C("video"),ke=C("audio"),Ne=C("div"),je=C("a"),_e=(e,t)=>{const r=e.dom.createFragment(t);return Oe(T(r.firstChild))},Re=(e,t)=>{if(w(e)){const r=E("div");oe(r,t);const o=e.getDoc(),n=T(o);be.inlinePrefixedStyles(n,r,".ephox-summary-card");const s=le(r,"*[style]");return q(s,(e=>{var t;(t=e,"style",d.from(((e,t)=>{const r=e.dom.getAttribute("style");return null===r?void 0:r})(t))).each((t=>Q(e,"data-mce-style",t)))})),((e,t)=>{const r=document.createDocumentFragment();return q(e,(e=>{r.appendChild(e.dom)})),T(r)})(H(r))}return t},Pe=(e,t,r)=>{const o=ae(r);return((e,t)=>{const r=((e,t)=>Z(e)?e.style.getPropertyValue(t):"")(e.dom,t);return d.from(r).filter((e=>e.length>0))})(o,"max-width").isNone()&&te(o,"max-width",t+"px"),Q(o,"data-ephox-embed-iri",e),Q(o,"contentEditable",!1),o},Ie=(e,t,r)=>je(t)?t:((e,t,r)=>Ne(t)?Pe(e,r,t):Pe(e,r,(e=>{const t=E("div");return oe(t,ae(e)),t})((e=>((Ae(e)||ke(e))&&te(e,"width","100%"),ke(e)&&te(e,"min-width","100px"),e))(t))))(e,t,r),Me=(e,t,r)=>{const o=_e(e,r);return se(Ie(t,o,b(e)))},Fe=(e,t,r,o)=>{const n=Ie(r,_e(e,o),b(e));Ne(n)?((e,t,r)=>{const o=Ce(e,se(r));W(o).each((r=>{e.undoManager.transact((()=>{re(t,r),ne(t)}))}))})(e,t,n):((e,t,r)=>{const o=Ce(e,se(r));e.undoManager.transact((()=>{var e;(e=t).dom.textContent="",q(H(e),(e=>{ne(e)})),oe(t,o)}))})(e,t,n)},De=e=>{const t=(e=>{const t=e.split(" "),r={};return q(t,(e=>{r[e.toLowerCase()]=!0})),r})(e);return e=>!!e&&e.nodeName.toLowerCase()in t},qe=De("h1 h2 h3 h4 h5 h6 p span"),Ke=De("strong em b span a br"),Ve=e=>qe(e.dom)&&(e=>{return V((e=>e?J(e.querySelectorAll("*")):[])(e),(t=Ke,e=>!t(e))).isNone();var t})(e.dom),Be=e=>/^https?:\/\/\S+$/i.test(e.trim()),Je=e=>d.from(e).filter(Ve).map(Te).filter(Be),Le=(e,t,r,o)=>{const n=(s=T(e.newBlock),d.from(s.dom.previousSibling).map(T));var s;n.filter(O).bind(Je).map((e=>{r.getAndHandleResponse(e,(r=>{const o=r.recommended().html();((e,t,r,o)=>{t.filter((e=>L(e).isSome())).each((t=>{const n=xe(t);n.length>0?((e,t,r,o,n)=>{const s=H(t),a=Se(s,r),i=s.slice(a),l=s.slice(a+1);if(Ee(l)===o){const r=Ie(o,_e(e,n),b(e));Ne(r)?((e,t,r,o)=>{const n=Ce(e,se(o));W(n).each((o=>{e.undoManager.transact((()=>{re(t,o),q(r,ne)}))}))})(e,t,i,r):((e,t,r,o)=>{const n=Ce(e,se(o));e.undoManager.transact((()=>{q(r,ne),oe(t,n)}))})(e,t,l,r)}})(e,t,n,r,o):Fe(e,t,r,o)}))})(t,n,e,o)}),o.logError)}))},Ue=e=>{q(e,(e=>{const t=new tinymce.html.Node("span",1);t.attr("class","mce-shim"),t.attr("data-mce-bogus","1"),e.append(t),e.attr("contenteditable","false")}))},He=e=>{q(e,(e=>{e.attr("contenteditable",null)}))},We="media_url_resolver",ze=[{code:404,message:"The specified url was not found."},{code:600,message:"The specified service did not respond correctly."},{code:601,message:"The specified service did not respond correctly."}],$e=(e,t)=>V(ze,(e=>e.code===t)).fold((()=>"Server didn't produce a valid result. ("+t+")"),(e=>e.message)),Ye=e=>{const t=t=>t(e),r=k(e),o=()=>n,n={tag:!0,inner:e,fold:(t,r)=>r(e),isValue:R,isError:_,map:t=>Xe.value(t(e)),mapError:o,bind:t,exists:t,forall:t,getOr:r,or:o,getOrThunk:r,orThunk:o,getOrDie:r,each:t=>{t(e)},toOptional:()=>d.some(e)};return n},Ge=e=>{const t=()=>r,r={tag:!1,inner:e,fold:(t,r)=>t(e),isValue:_,isError:R,map:t,mapError:t=>Xe.error(t(e)),bind:t,exists:_,forall:R,getOr:N,or:N,getOrThunk:j,orThunk:j,getOrDie:(o=String(e),()=>{throw new Error(o)}),each:A,toOptional:d.none};var o;return r},Xe={value:Ye,error:Ge,fromOption:(e,t)=>e.fold((()=>Ge(t)),Ye)};var Qe;!function(e){e[e.Error=0]="Error",e[e.Value=1]="Value"}(Qe||(Qe={}));const Ze=(e,t,r)=>e.stype===Qe.Error?t(e.serror):r(e.svalue),et=e=>({stype:Qe.Value,svalue:e}),tt=e=>({stype:Qe.Error,serror:e}),rt=Ze,ot=e=>s(e)&&z(e).length>100?" removed due to size":JSON.stringify(e,null,2),nt=(e,t)=>tt([{path:e,getErrorInfo:t}]),st=(at=(e,t)=>a(e)&&a(t)?st(e,t):t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let r=0;r<e.length;r++){const o=e[r];for(const e in o)X(o,e)&&(t[e]=at(t[e],o[e]))}return t});var at;const it=(e,t,r)=>{switch(e.tag){case"field":return t(e.key,e.newKey,e.presence,e.prop);case"custom":return r(e.newKey,e.instantiator)}},lt=e=>({extract:(t,r)=>{return o=e(r),n=e=>((e,t)=>nt(e,k(t)))(t,e),o.stype===Qe.Error?n(o.serror):o;var o,n},toString:k("val")}),ct=lt(et),ut=(e,t,r,o)=>o(G(e,t).getOrThunk((()=>r(e)))),dt=(e,t,r,o,n)=>{const s=e=>n.extract(t.concat([o]),e),a=e=>e.fold((()=>et(d.none())),(e=>{const r=n.extract(t.concat([o]),e);return s=r,a=d.some,s.stype===Qe.Value?{stype:Qe.Value,svalue:a(s.svalue)}:s;var s,a}));switch(e.tag){case"required":return((e,t,r,o)=>G(t,r).fold((()=>((e,t,r)=>nt(e,(()=>'Could not find valid *required* value for "'+t+'" in '+ot(r))))(e,r,t)),o))(t,r,o,s);case"defaultedThunk":return ut(r,o,e.process,s);case"option":return((e,t,r)=>r(G(e,t)))(r,o,a);case"defaultedOptionThunk":return((e,t,r,o)=>o(G(e,t).map((t=>!0===t?r(e):t))))(r,o,e.process,a);case"mergeWithThunk":return ut(r,o,k({}),(t=>{const o=st(e.process(r),t);return s(o)}))}},mt=e=>({extract:(t,r)=>((e,t,r)=>{const o={},n=[];for(const s of r)it(s,((r,s,a,i)=>{const l=dt(a,e,t,r,i);rt(l,(e=>{n.push(...e)}),(e=>{o[s]=e}))}),((e,r)=>{o[e]=r(t)}));return n.length>0?tt(n):et(o)})(t,r,e),toString:()=>{const t=D(e,(e=>it(e,((e,t,r,o)=>e+" -> "+o.toString()),((e,t)=>"state("+e+")"))));return"obj{\n"+t.join("\n")+"}"}}),pt=(e,t,r)=>{return o=((e,t,r)=>((e,t)=>e.stype===Qe.Error?{stype:Qe.Error,serror:t(e.serror)}:e)(t.extract([e],r),(e=>({input:r,errors:e}))))(e,t,r),Ze(o,Xe.error,Xe.value);var o},ht=e=>"Errors: \n"+(e=>{const t=e.length>10?e.slice(0,10).concat([{path:[],getErrorInfo:k("... (only showing first ten failures)")}]):e;return D(t,(e=>"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()))})(e.errors).join("\n")+"\n\nInput object: "+ot(e.input),ft=e=>{let t=d.none(),r=[];const o=e=>{n()?s(e):r.push(e)},n=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{n()||(t=d.some(e),q(r,s),r=[])})),{get:o,map:e=>ft((t=>{o((r=>{t(e(r))}))})),isReady:n}},gt={nu:ft,pure:e=>ft((t=>{t(e)}))},yt=e=>{setTimeout((()=>{throw e}),0)},vt=e=>{const t=t=>{e().then(t,yt)};return{map:t=>vt((()=>e().then(t))),bind:t=>vt((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>vt((()=>e().then((()=>t.toPromise())))),toLazy:()=>gt.nu(t),toCached:()=>{let t=null;return vt((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},bt=e=>vt((()=>new Promise(e))),wt=e=>vt((()=>Promise.resolve(e))),St=e=>({...e,toCached:()=>St(e.toCached()),bindFuture:t=>St(e.bind((e=>e.fold((e=>wt(Xe.error(e))),(e=>t(e)))))),bindResult:t=>St(e.map((e=>e.bind(t)))),mapResult:t=>St(e.map((e=>e.map(t)))),mapError:t=>St(e.map((e=>e.mapError(t)))),foldResult:(t,r)=>e.map((e=>e.fold(t,r))),withTimeout:(t,r)=>St(bt((o=>{let n=!1;const s=setTimeout((()=>{n=!0,o(Xe.error(r()))}),t);e.get((e=>{n||(clearTimeout(s),o(e))}))})))}),xt=e=>St(bt(e)),Et=e=>St(wt(Xe.value(e))),Tt={nu:xt,wrap:St,pure:Et,value:Et,error:e=>St(wt(Xe.error(e))),fromResult:e=>St(wt(e)),fromFuture:e=>St(e.map(Xe.value)),fromPromise:e=>xt((t=>{e.then((e=>{t(Xe.value(e))}),(e=>{t(Xe.error(e))}))}))},Ot=()=>(new Date).getTime();var Ct;!function(e){e.JSON="json",e.Blob="blob",e.Text="text",e.FormData="formdata",e.MultipartFormData="multipart/form-data"}(Ct||(Ct={}));const At=e=>bt((t=>{const r=new FileReader;r.onload=e=>{const r=e.target?e.target.result:"";t(r)},r.readAsText(e)})),kt=e=>{try{const t=JSON.parse(e);return Xe.value(t)}catch(e){return Xe.error("Response was not JSON.")}},Nt=e=>wt(e.response),jt=(e,t)=>t.map((t=>{const r=((e,t)=>{const r=[];return Y(e,((e,t)=>{var o;r.push((o=e,encodeURIComponent(t)+"="+encodeURIComponent(o)))})),r})(t),o=("?",-1!==e.indexOf("?")?"&":"?");return r.length>0?e+o+r.join("&"):e})).getOr(e),_t=e=>Tt.nu((t=>{const r=new XMLHttpRequest;r.open(e.method,jt(e.url,d.from(e.query)),!0);const o=(e=>{const t=(r=e.body,d.from(r).bind((e=>{switch(e.type){case Ct.JSON:return d.some("application/json");case Ct.FormData:return d.some("application/x-www-form-urlencoded; charset=UTF-8");case Ct.MultipartFormData:return d.none();case Ct.Text:default:return d.some("text/plain")}})));var r;const o=!0===e.credentials?d.some(!0):d.none(),n=(e=>{switch(e){case Ct.Blob:return"application/octet-stream";case Ct.JSON:return"application/json, text/javascript";case Ct.Text:return"text/plain";default:return""}})(e.responseType)+", */*; q=0.01",s=void 0!==e.headers?e.headers:{};return{contentType:t,responseType:(e=>{switch(e){case Ct.JSON:return d.none();case Ct.Blob:return d.some("blob");case Ct.Text:return d.some("text");default:return d.none()}})(e.responseType),credentials:o,accept:n,headers:s,progress:c(e.progress)?d.some(e.progress):d.none()}})(e);((e,t)=>{t.contentType.each((t=>e.setRequestHeader("Content-Type",t))),e.setRequestHeader("Accept",t.accept),t.credentials.each((t=>e.withCredentials=t)),t.responseType.each((t=>e.responseType=t)),t.progress.each((t=>e.upload.addEventListener("progress",(e=>t(e.loaded,e.total))))),Y(t.headers,((t,r)=>e.setRequestHeader(r,t)))})(r,o);const n=()=>{((e,t,r)=>((e,t)=>{switch(e){case Ct.JSON:return kt(t.response).fold((()=>Nt(t)),wt);case Ct.Blob:return(e=>d.from(e.response).map(At).getOr(wt("no response content")))(t);case Ct.Text:default:return Nt(t)}})(t,r).map((t=>({message:0===r.status?"Unknown HTTP error (possible cross-domain request)":`Could not load url ${e}: ${r.statusText}`,status:r.status,responseText:t}))))(e.url,e.responseType,r).get((e=>t(Xe.error(e))))};var s;r.onerror=n,r.onload=()=>{0!==r.status||m(e.url,"file:")?r.status<100||r.status>=400?n():((e,t)=>{const r=e=>Tt.error({message:e,status:t.status,responseText:t.responseText});switch(e){case Ct.JSON:return kt(t.response).fold(r,Tt.pure);case Ct.Blob:case Ct.Text:return Tt.pure(t.response);default:return r("unknown data type")}})(e.responseType,r).get(t):n()},(s=e.body,d.from(s).map((e=>e.type===Ct.JSON?JSON.stringify(e.data):e.type===Ct.FormData||e.type===Ct.MultipartFormData?(e=>{const t=new FormData;return Y(e,((e,r)=>{t.append(r,e)})),t})(e.data):e.data))).fold((()=>r.send()),(e=>{r.send(e)}))})),Rt=e=>{const t=e.responseText;return s(t)?t:e.message},Pt=(e,t,r=Rt)=>{const o=(e=>G(e,"tiny-api-key").orThunk((()=>G(e,"tinymce-api-key"))).orThunk((()=>G(e,"textbox-api-key"))).getOrUndefined())(t);return{execute:n=>{const s=(a=e=>l(e)?String(e):e,((e,t)=>{const r={};return Y(e,((e,o)=>{const n=t(e,o);r[n.k]=n.v})),r})(n,((e,t)=>({k:t,v:a(e)}))));var a;const i=((e,t)=>{const r=-1===e.indexOf("?")?"?":"&";return t?e+r+"apiKey="+encodeURIComponent(t):e})((u=s,e.replace(/\$\{([^{}]*)\}/g,((e,t)=>{const r=u[t];return(e=>{const t=typeof e;return"string"===t||"number"===t})(r)?r.toString():e}))),o),c=(d={url:i,responseType:Ct.JSON,credentials:!0,headers:t},_t({...d,method:"get",body:{type:Ct.Text,data:""}})).mapError(r);var u,d;return Tt.wrap(c)},cancelCurrent:A}};(e=>{if(!i(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");const t=[],r={};q(e,((o,n)=>{const s=z(o);if(1!==s.length)throw new Error("one and only one name per case");const a=s[0],l=o[a];if(void 0!==r[a])throw new Error("duplicate key detected:"+a);if("cata"===a)throw new Error("cannot have a case named cata (sorry)");if(!i(l))throw new Error("case arguments must be an array");t.push(a),r[a]=(...r)=>{const o=r.length;if(o!==l.length)throw new Error("Wrong number of arguments to case "+a+". Expected "+l.length+" ("+l+"), got "+o);return{fold:(...t)=>{if(t.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+t.length);return t[n].apply(null,r)},match:e=>{const o=z(e);if(t.length!==o.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+o.join(","));if(!((e,t)=>{for(let t=0,n=e.length;t<n;++t)if(!0!==(r=e[t],F(o,r)))return!1;var r;return!0})(t))throw new Error("Not all branches were specified when using match. Specified: "+o.join(", ")+"\nRequired: "+t.join(", "));return e[a].apply(null,r)},log:e=>{console.log(e,{constructors:t,constructor:a,params:r})}}}}))})([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const It=k(ct),Mt=(e,t,r,o)=>({tag:"field",key:e,newKey:t,presence:r,prop:o}),Ft=e=>Mt(e,e,{tag:"required",process:{}},It()),Dt="iframely",qt="oembed",Kt="fallback",Vt="wikipedia",Bt=e=>"["+e.join(", ")+"]",Jt=[Dt,qt,Kt],Lt=(e,t,r)=>((t,r)=>{for(let r=0,n=t.length;r<n;r++)if(o=t[r],F(e,o))return!0;var o;return!1})(t)?Xe.error("Embed response source: "+Bt(e)+" contains more than one of "+Bt(Jt)):Xe.value(r),Ut=mt([Ft("url"),Ft("maxWidth"),((e,t)=>Mt(e,e,{tag:"defaultedThunk",process:k(!1)},It()))("fresh")]),Ht=mt([Ft("status_code"),Ft("sub_code"),Ft("msg")]),Wt=mt([Ft("html"),(zt="rels",$t=[Mt("source","source",{tag:"required",process:{}},(Yt=e=>i(e)?(e=>F(e,Dt)?Lt(e,[qt,Kt,Vt],Dt):F(e,qt)?Lt(e,[Dt,Kt,Vt],qt):F(e,Kt)?Lt(e,[Dt,qt,Vt],Kt):F(e,Vt)?Lt(e,[Dt,qt,Kt],Vt):Xe.error("Embed response source: "+Bt(e)+" did not contain any of: "+Bt(Jt)))(e):Xe.error("Sources was not an array: "+e),lt((e=>Yt(e).fold(tt,et)))))],Mt(zt,zt,{tag:"required",process:{}},mt($t)))]);var zt,$t,Yt,Gt=e=>pt("EmbedResponse.failure",Ht,e).fold((e=>Xe.error({code:k(600),subcode:k(0),msg:()=>ht(e)})),(e=>Xe.error({code:k(e.status_code),subcode:k(e.sub_code),msg:k(e.msg)}))),Xt=e=>pt("EmbedResponse.success",Wt,e).fold((e=>Xe.error({code:k(601),subcode:k(0),msg:()=>ht(e)})),(e=>Xe.value({recommended:()=>({html:k(e.html),source:k(e.rels.source)})})));const Qt=(e,t,r)=>{const o=((e,t=36e5)=>{const r={},o=(e,t,o)=>{r[e]={result:t,timestamp:o}},n=(e,r)=>e-r<t,a=k(r);return s(e)&&(e=>{const t=Ot();Y(e,((e,r)=>{n(t,e.timestamp)&&o(r,e.result,e.timestamp)}))})(e),{set:o,get:(e,t)=>d.from(r[t]).filter((t=>n(e,t.timestamp))).map((e=>e.result)),dump:a}})(r),n=Pt(e+"/1/embed?url=${url}&maxWidth=${maxWidth}",t);return{checkOne:(e,t,r=!1)=>{const s=Ot(),a=((r,o,s,a,i)=>(i?d.none():o.get(a,s)).fold((()=>((r,o)=>{const s={url:encodeURIComponent(e),maxWidth:t,fresh:o},a=(i="ephox.media.service.one.ajax.service.get",l=Ut,c=s,pt(i,l,c).fold((e=>{throw new Error(ht(e))}),N));var i,l,c;return n.execute(a)})(0,i).mapResult((e=>(o.set(s,e,a),e)))),(e=>Tt.pure(e))))(0,o,t+"&"+e,s,r);return Tt.wrap(a.map((e=>e.fold(Gt,Xt))))},dumpCache:o.dump}},Zt=(e,t)=>{((e,t)=>{const r=e.options.register;r("mediaembed_content_css",{processor:"string",default:t+"/content.min.css"}),r("mediaembed_max_width",{processor:"number",default:650}),r("mediaembed_inline_styles",{processor:"boolean",default:!1}),r("mediaembed_service_url",{processor:"string",default:""}),r("mediaembed_api_key",{processor:"string"})})(e,t);const r=(e=>{let t;const r=t=>{const r=(e=>{if("string"==typeof e)return{message:e};{const t=e.code();return{message:$e(e.msg(),t),code:t}}})(t);((e,t)=>{e.dispatch("MediaEmbedError",t)})(e,r),console.error(`Media embed error: ${r.message}`)};return{formatMessage:$e,logDialogError:e=>{const o=e.msg();o!==t&&r(e),t=o},logError:r}})(e),o=(e=>{const t=(r=S(e),o=(e=>{var t;return null!==(t=e.options.get("mediaembed_api_key"))&&void 0!==t?t:e.options.get("api_key")})(e),Qt(r,o?{"tinymce-api-key":o}:{}));var r,o;const n=(e,r,o)=>t.checkOne(e,r,o),s={};return{getOne:n,dumpCache:()=>{t.dumpCache()},getAndHandleResponse:(t,r,o)=>{void 0!==s[t]?s[t]=s[t].concat(r):(s[t]=[r],n(t.trim(),b(e)).get((e=>e.fold((e=>{o(e),delete s[t]}),(e=>{q(s[t],(t=>{t(e)})),delete s[t]})))))}}})(e);(e=>{e.on("click keyup touchend",(()=>{const t=e.selection.getNode();t&&e.dom.getAttrib(t,"data-ephox-embed-iri")&&e.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")})),e.on("PreInit",(()=>{e.parser.addAttributeFilter("data-ephox-embed-iri",Ue),e.serializer.addAttributeFilter("data-ephox-embed-iri",He)}))})(e),(e=>{const t=v(e);e.on("PreInit",(()=>{e.contentCSS.push(e.documentBaseURI.toAbsolute(t))}))})(e),e.on("SkinLoaded",(()=>{S(e).length>0?(((e,t,r)=>{e.on("NewBlock",(o=>{Le(o,e,t,r)}))})(e,o,r),((e,t,r)=>{const o=e.options;o.isRegistered(We)&&!o.isSet(We)&&o.set(We,((e,t,r)=>(o,n,s)=>{Be(o.url)?t.getAndHandleResponse(o.url,(t=>{const r=t.recommended().html();n({html:Me(e,o.url,r)})}),(e=>{r.logDialogError(e),s({msg:r.formatMessage(e.msg(),e.code())})})):n({html:""})})(e,t,r))})(e,o,r)):r.logError("You need to specify the mediaembed_service_url setting")}))};tinymce.PluginManager.add("mediaembed",((e,t)=>{((e,t)=>!!e&&-1===((e,t)=>{const r=h(e.major,t.major);if(0!==r)return r;const o=h(e.minor,t.minor);if(0!==o)return o;const n=h(e.patch,t.patch);return 0!==n?n:0})((e=>g((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),g(t)))(tinymce,"6.0.0")?console.error("The mediaembed plugin requires at least version 6.0.0 of TinyMCE."):Zt(e,t)}))}();